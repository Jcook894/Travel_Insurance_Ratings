jreviews=jreviews||{},function(e,t,i){var a=e("div.jr-page"),n=e("div.jr-main");e(document).ajaxStop(function(){setTimeout(function(){t.addOnloadAjax("datepicker",t.datepicker),t.addOnloadAjax("popup",t.popup),t.addOnloadAjax("tabs",t.tabs),t.addOnloadAjax("listing-manager",t.listing.manager),t.addOnloadAjax("pagenav-ajax",t.pageNav.disableSelects),e.each(t._onloadFnAjax,function(e,t){t!==i&&t()})},10)}),t=e.extend(t,{lang:t.lang||{},_onloadFn:[],_onloadFnAjax:[],_onloadFnKeys:[],_onloadFnAjaxKeys:[]}),t.addOnload=function(i,a){-1==e.inArray(i,t._onloadFnKeys)&&(t._onloadFn.push(a),t._onloadFnKeys.push(i))},t.addOnloadAjax=function(i,a){-1==e.inArray(i,t._onloadFnAjaxKeys)&&(t._onloadFnAjax.push(a),t._onloadFnAjaxKeys.push(i))},t.onload=function(){a=a.length>0?a:e("div.jr-page"),n=n.length>0?n:e("div.jr-main"),t.addOnload("datepicker",t.datepicker),t.addOnload("popup",t.popup),t.addOnload("showmore",t.showmore),t.addOnload("calendar",t.calendar.init),t.addOnload("lightbox",t.lightbox),t.addOnload("favorite",t.listing.favorite),t.addOnload("tabs",t.tabs),t.addOnload("login",t.login.init),t.addOnload("social-sharing",t.socialSharing),t.addOnload("pagenav",t.pageNav.init),t.addOnload("listing-create",t.listing.formSetup),t.addOnload("listing-manager",t.listing.manager),t.addOnload("listing-widgets",t.listing.widgets),t.addOnload("listing-claim",t.claim.init),t.addOnload("listing-inquiry",t.inquiry.init),t.addOnload("listing-masonry",t.masonry),t.addOnload("review-init",t.review.init),t.addOnload("review-edit",t.review.edit),t.addOnload("review-vote",t.review.vote),t.addOnload("review-reply",t.review.reply),t.addOnload("report",t.report.init),t.addOnload("comment-manager",t.discussion.manager),t.addOnload("comment-new",t.discussion.init),t.addOnload("comment-reply",t.discussion.reply),t.addOnload("comment-earlier",t.discussion.earlierComment),t.addOnload("media-init",t.media.init),t.addOnload("media-thumbs",t.media.generateThumbs),t.addOnload("media-manager",t.media.manager),t.addOnload("media-download",t.media.download),t.addOnload("search-simple",t.search.simple),t.addOnload("search-adv-page",t.search.advancedPage),t.addOnload("search-adv-module",t.search.advancedModule),t.addOnload("fields-module",t.fieldsModule),t.addOnload("directory-tree",t.directoryTree),t.addOnload("facebook",t.facebook.load),t.addOnload("comparison",t.compare),t.addOnload("module-slider",t.module.init),t.addOnload("trix-editor",t.trix),t.addOnload("jreviews-formbuilder",t.formbuilder),e.each(t._onloadFn,function(e,t){t!==i&&t()})},"function"==typeof head?head.ready(function(){t.onload()}):e(function(){t.onload()}),t.getScript=function(t,a){return e.ajax({type:"GET",url:t,success:function(){i!==a&&a()},dataType:"script",cache:!0})},t.__t=function(i,a){var n={add_ul:!0};if(a=e.extend(n,a),"string"==typeof i)return t.lang[i]||i;var r=[];return e.each(i,function(e,i){var a,n,o;"string"==typeof i?a=t.lang[i]||i:(o=i.shift(),n=t.lang[o]||o,i.unshift(n),a=window.sprintf.apply(null,i)),r.push("<li>"+a+"</li>")}),a.add_ul?"<ul>"+r.join("")+"</ul>":r.join("")},t.dispatch=function(t){t=t||{};var a=t.form_id!==i||t.form!==i?"POST":"GET";i!==t.method&&(a=t.method);var n="";t.controller!==i&&(n=e.param("post"==a.toLowerCase()?{"data[controller]":t.controller,"data[action]":t.action}:{url:t.controller+"/"+t.action}));t.type||"json";if(i!==t.form_id||i!==t.form){var r=t.form||e("#"+t.form_id);i!==t.controller&&r.find("input[name=data\\[controller\\]], input[name=data\\[action\\]]").remove(),n=r.serialize()+"&"+n}t.data&&(n=n+"&"+e.param(t.data));var o={type:a,url:s2AjaxUri,data:n,dataType:t.type};return"get"==a.toLowerCase()&&t.cache!==i?o.cache=t.cache:"get"!=a.toLowerCase()&&(o.headers={"Cache-Control":"no-cache"}),e.ajax(o)},t.compare=function(){"undefined"!=typeof jreviewsCompare&&jreviewsCompare.init()},t.datepicker=function(){if(e().datepicker){try{t.datepickerClear()}catch(i){}e.datepicker.setDefaults({showOn:"both",buttonImage:t.calendar_img,showButtonPanel:!0,buttonImageOnly:!0,buttonText:"Calendar",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),e('.jr-date:not(".jr_ready")').addClass("jr-ready").each(function(){e(this).datepicker({yearRange:e(this).data("yearrange"),minDate:e(this).data("mindate"),maxDate:e(this).data("maxdate")})})}},t.datepickerClear=function(){var i=e.datepicker._updateDatepicker;e.datepicker._updateDatepicker=function(a){i.call(this,a);var n=e(this).datepicker("widget").find(".ui-datepicker-buttonpane");0===n.find(".clearDate").length&&e("<button class='clearDate' type='button' class='ui-datepicker-clean ui-state-default ui-priority-primary ui-corner-all'>"+t.__t("CLEAR_DATE")+"</button>").appendTo(n).click(function(){e.datepicker._clearDate(a.input)})}},t.fieldsModule=function(){e(".jr-fields-module").each(function(){var i=e(this),a=i.data("showLimit")||5,n=i.find("li"),r=e('<a href="javascript:;" class="jrFieldsShowAll">'+t.__t("FILTERS_SHOW_ALL")+"</a>").hide(),o=e('<a href="javascript:;" class="jrFieldsShowLess">'+t.__t("FILTERS_SHOW_LESS")+"</a>").hide();1==i.data("showAll")&&n.length>a&&(i.after(r,o),r.on("click",function(t){t.preventDefault(),e(this).hide(),o.show(),n.removeClass("jrOptionHidden")}).show(),o.on("click",function(t){t.preventDefault(),e(this).hide(),i.find("li:gt("+(a-1)+")").addClass("jrOptionHidden"),r.show()}))})},t.directoryTree=function(){e().treeview&&e(".jr-directory-tree").treeview({animated:"fast",unique:!0,collapsed:!1}).each(function(){var t=e(this),i=t.data("cat-id"),a=t.data("dir-id"),n=t.data("show-dir"),r=null;i?r=e(".jr-tree-cat-"+i):a&&n&&(r=e(".jr-tree-dir-"+a)),null!==r&&(r.removeClass("closed").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea").swapClass("lastExpandable","lastCollapsable"),r.parents("ul, li").show().removeClass("closed").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea").swapClass("lastExpandable","lastCollapsable"),r.children("ul, li").show().removeClass("closed"),r.children("div").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea"),r.parents("ul, li").children("div").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea"))})},t.tabs=function(t){if("undefined"!=typeof e().tabs){t=t||e('div.jr-page .jr-tabs:not(".jr-ready")');var a=e("base").attr("href");a!==i&&a.length&&t.find("ul:eq(0) li a").each(function(){e(this).attr("href",e(location).attr("href").split("#")[0]+e(this).attr("href"))}),t.addClass("jr-ready").tabs()}},t.pageNav={init:function(){e(window).on("popstate",function(a){var n=a.originalEvent.state,r=e("form");null!==n&&""!=n.url&&(n.form&&(r=e('form[data-module-id="'+n.form.id+'"]'),e.each(n.form.data,function(t,a){var n=r.find('[name="'+a.name+'"]'),o=e._data(n[0],"events");o!==i&&e._data(n[0],"events").updateFilterNoChange!==i&&n.val(a.value).trigger("updateFilterNoChange")})),t.pageNav.loadUrl(n.url,{scroll:r.data("update-scroll")||0}))}),t.pageNav.disableSelects(),n.on("click",'div.jr-pagenav[data-ajax="1"] a, div.jr-list-layout[data-ajax="1"] a',function(t){t.preventDefault(),e(this).trigger("jrPageNav")}),n.on("change",'div.jr-pagenav[data-ajax="1"] select.jr-pagenav-limit, div.jr-pagenav[data-ajax="1"] select.jr-list-sort',function(t){t.preventDefault(),e(this).trigger("jrPageNav")}),n.on("jrPageNav",'div.jr-pagenav[data-ajax="1"] a, div.jr-pagenav[data-ajax="1"] select, div.jr-list-layout[data-ajax="1"] a',function(i){i.preventDefault();var n=null,r=e(this),o=r.closest("form"),s=a.find("div.jr-pagenav");if(0==o.length){if(r.is("a")?n=r.attr("href"):r.is("select")&&(r.hasClass("jr-pagenav-limit")||r.hasClass("jr-list-sort"))&&(n=r.val()),n){var d=(r.closest(".jr-page"),r.parents(".jrPaginationBottom").length?!0:!1);t.pageNav.loadUrl(n,{push:!0,scroll:d})}}else{var l=Number(e("div.jr-pagenav select.jr-pagenav-limit").first().find(":selected").text()),c=1,u=Number(s.find("a.jr-pagenav-page").last().html()),f=[],p=o.find('input[name="data[controller]"]').val(),m=o.find('input[name="data[action]"]').val()||"index";0===l&&(l=o.find('input[name="data[limit]"]').val()||10),r.hasClass("jr-pagenav-page")?c=Number(r.html()):r.hasClass("jr-pagenav-next")?(c=Number(r.siblings("span.jr-pagenav-current").html())+1,c=c>u?c:c):r.hasClass("jr-pagenav-prev")&&(c=Number(r.siblings("span.jr-pagenav-current").html())-1,c=0>c?1:c),f.push({name:t.qvars.pg,value:c}),f.push({name:"limit",value:l});var h=t.dispatch({method:"get",type:"html",controller:p,action:m,data:f});h.done(function(e){r.closest(".jr-page-inner, .jr-page").first().html(e)})}})},disableSelects:function(){n.find('div.jr-pagenav[data-ajax="1"] select.jr-pagenav-limit, div.jr-pagenav[data-ajax="1"] select.jr-list-sort').removeAttr("onchange")},loadUrl:function(i,a){var a=e.extend({push:!1,scroll:!1},a);a.refUrl=i,i+=-1===i.indexOf("?")?"?":"&",i+="format=raw";var r=e.ajax({type:"get",url:i,dataType:"html"});n.addClass("jrIsLoading"),e(document).trigger("jreviews-onBeforeAjaxUpdate"),r.done(function(e){t.pageNav.updatePage(e,a)})},updatePage:function(a,r){var r=e.extend({push:!1,scroll:!1,form:{}},r);$html=e("<div>"+a+"</div>");var o=$html.find('meta[name="title"]').detach(),s=o.attr("content"),d=$html.find('meta[name="url"]').detach();if(refUrl=d.attr("content"),s!==i?e("title").html(s):s=e("title").html(),r.refUrl==i&&refUrl!==i&&(r.push=!0,r.refUrl=d.attr("content")),n.html($html.html()),r.scroll){var l=n.find(".jr-pagenav");l.length&&l.jrScrollTo({duration:350,offset:-150})}r.push&&r.refUrl&&window.history.pushState({url:r.refUrl,form:r.form},null,r.refUrl),e(document).trigger("jreviews-onAfterAjaxUpdate",[r.refUrl]),0===n.find(".jr-map-canvas").length&&(t.masonry(),n.removeClass("jrIsLoading")),"function"==typeof ga&&(ga("set",{page:r.refUrl.replace(/^.*\/\/[^\/]+/,""),title:s}),ga("send","pageview"))}},t.socialSharing=function(){a.find(".jr-tweet").length&&(window.twttr=function(e,t,i){var a,n=e.getElementsByTagName(t)[0],r=window.twttr||{};return e.getElementById(i)?r:(a=e.createElement(t),a.id=i,a.src="//platform.twitter.com/widgets.js",n.parentNode.insertBefore(a,n),r._e=[],r.ready=function(e){r._e.push(e)},r)}(document,"script","twitter-wjs"));var e=a.find(".jr-gplusone");e.length&&(e.remove(),function(e,t,i){var a,n=e.getElementsByTagName(t)[0];e.getElementById(i)||(a=e.createElement(t),a.id=i,a.src="//apis.google.com/js/plusone.js",n.parentNode.insertBefore(a,n))}(document,"script","google-jssdk"));var t=a.find(".jr-linkedin");t.length&&(t.remove(),function(e,t,i){var a,n=e.getElementsByTagName(t)[0];e.getElementById(i)||(a=e.createElement(t),a.id=i,a.src="//platform.linkedin.com/in.js",n.parentNode.insertBefore(a,n))}(document,"script","linkedin-jssdk")),a.find(".jr-pinterest").length&&!function(e,t,i){var a,n=e.getElementsByTagName(t)[0];e.getElementById(i)||(a=e.createElement(t),a.id=i,a.src="//assets.pinterest.com/js/pinit.js",n.parentNode.insertBefore(a,n))}(document,"script","pinterest-jssdk")},t.login={init:function(){e("body").on("click",".jr-show-login",function(){e("#jr-login-form").toggle()})}},t.discussion={init:function(){var i=e("div.jr-form-comment-outer"),a=i.find('form[id^="jr-form-comment"]'),n=a.attr("id"),r=(a.data("discussion-id"),a.find(".jr-buttons")),o=a.find(".jr-validation"),s=e("button.jr-comment-add");s.on("click",function(t){t.preventDefault();var a=e(this);i.slideDown(),a.fadeOut()}),s.one("click",function(){t.common.initForm(n,!0),t.common.validateUsername(a),t.common.validateEmail(a)}).trigger("click"),a.on("click","button.jr-comment-cancel",function(e){e.preventDefault(),i.slideUp(),s.fadeIn()}),a.on("click","button.jr-comment-submit",function(n){n.preventDefault();var s=e(".jr-review-comments");r.find("button").prop("disabled",!0),r.append('<span class="jrLoadingSmall">'),o.hide();var d=t.dispatch({form:a});d.done(function(e){if(e.success){i.slideUp().remove();var n='<div class="jr-message jrSuccess">'+t.__t(e.moderation?"DISCUSSION_SUBMIT_MODERATED":"DISCUSSION_SUBMIT_NEW")+"</div>";s.prepend('<div class="jr-new-comment jrHidden">'+n+e.html+"</div>").jrScrollTo({duration:500,offset:-50}).delay().find(".jr-new-comment").slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500),t.discussion.manager(),t.discussion.earlierComment()}else e.str.length&&(o.html(t.__t(e.str)).show(),t.captcha.reset(a.find(".g-recaptcha").data("id")))}),d.always(function(){r.find(".jrLoadingSmall").remove(),r.find("button").prop("disabled",!1)})})},reply:function(){e('button.jr-comment-reply:not(".jr-ready")').on("click",function(i){i.preventDefault();var a=e(this),n=a.find("span").eq(1),r=a.data("discussion-id"),o=a.data("review-id"),s=t.dispatch({method:"get",type:"html",controller:"discussions",action:"reply",data:{discussion_id:r,review_id:o}});s.done(function(i){var r={},o=function(){var i=e(this),a=i.find("form").last();t.common.initForm(a.attr("id"),!0),t.common.validateUsername(a),t.common.validateEmail(a),i.on("click",".jr-show-login",function(){i.find(".jr-login-form").toggle()})};r[t.__t("SUBMIT")]=function(){t.discussion.submitReply(a,e(this))},r[t.__t("CANCEL")]=function(){e(this).dialog("close")};var s=e.jrDialog(i,{buttons:r,title:n.html(),open:o,width:"640px"});s.find(".jr-form-comment-outer").show()})}).addClass("jr-ready")},manager:function(){var i=e('ul.jr-comment-manager:not(".jr-ready")').addClass("jr-ready");i.on("click","a.jr-comment-edit",function(){var i=e(this),a=i.find("span").eq(1),n=i.data("discussion-id"),r=t.dispatch({method:"get",type:"html",controller:"discussions",action:"edit",data:{discussion_id:n}});r.done(function(n){var r={};r[t.__t("SUBMIT")]=function(){t.discussion.submitEdit(i,e(this))},r[t.__t("CANCEL")]=function(){e(this).dialog("close")};var o=e.jrDialog(n,{buttons:r,title:a.html(),width:"640px",minHeight:"300"});o.find(".jr-form-comment-outer").show()})}),i.on("click","a.jr-comment-delete",function(){var i=e(this),a=i.data("discussion-id"),n=i.data("token"),r=i.find("span").eq(1),o=new e.Deferred;o.done(function(e){var r={id:a,token:n},o=t.dispatch({method:"get",type:"json",controller:"discussions",action:"_delete",data:r});o.done(function(a){a.success?(e.dialog("close"),i.closest(".jr-layout-outer").html('<div class="jrSuccess">'+t.__t("DISCUSSION_DELETED")+"</div>").jrScrollTo()):(e.dialog("option","buttons",[]),a.str.length&&e.html(t.__t(a.str)))})});var s={};s[r.html()]=function(){o.resolve(e(this))},s[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(t.__t("DISCUSSION_DELETE_CONFIRM"),{buttons:s,title:r.html(),width:"640px"})})},submitReply:function(i,a){var n=a.find("form").last(),r=(n.attr("id"),n.find(".jr-validation"));r.hide();var o=t.dispatch({form:n});o.done(function(n){if(n.success){a.dialog("close");var o='<div class="jr-message jrSuccess">'+t.__t(n.moderation?"DISCUSSION_SUBMIT_MODERATED":"DISCUSSION_SUBMIT_NEW")+"</div>",s=e('<div class="jr-new-comment jrHidden">'+o+n.html+"</div>");i.closest(".jr-layout-outer").after(s),s.jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500)}else n.str.length&&r.html(t.__t(n.str)).show();t.discussion.manager()})},submitEdit:function(i,a){var n=a.find("form"),r=(n.attr("id"),n.find(".jr-validation"));r.hide();var o=t.dispatch({form:n});o.done(function(n){if(n.success){a.dialog("close");var o=e('<div class="jr-message jrSuccess" style="margin-top:10px;">'+t.__t(n.moderation?"DISCUSSION_SUBMIT_MODERATED":"DISCUSSION_SUBMIT_EDIT")+"</div>"),s=e('<div class="jr-new-comment jrClear jrHidden">'+n.html+"</div>"),d=i.closest(".jr-layout-inner");d.html(o).prepend(s),s.jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500)}else n.str.length&&r.html(t.__t(n.str)).show();t.discussion.manager(),t.discussion.earlierComment()})},earlierComment:function(){e(".jr-earlier-comment").each(function(){var i=e(this),a=i.data("post-id"),n=i.next(".jr-earlier-comment-content"),r=e.Deferred();r.done(function(){var e=t.dispatch({method:"get",type:"html",controller:"discussions",action:"getPost",data:{id:a}});e.done(function(e){n.html(e)})}),i.jrPopup({className:"jrPopup",delay:500,onBeforeShow:function(){""===n.html()&&(n.html('<span class="jrLoadingMedium"></span>'),r.resolve())}})})}},t.module={init:function(){e("div.jr-module-slider, div.jr-plugin-slider").not(".jr-ready").addClass("jr-ready").each(function(){var t=e(this),i=t.height(),a=t.find(".jrModuleItems"),n=t.data("options");if(!(n.page_count<2)){i>0&&t.css({"max-height":i+"px",overflow:"hidden"}),t.removeClass("jrSliderSinglePage"),"vertical"==n.orientation&&t.addClass("jrSliderVertical"),"side"==n.nav_position&&t.addClass("jrSliderSideArrows");var r,o,s,d={mode:n.orientation,speed:600,easing:"swing",oneToOneTouch:!0,auto:parseInt(n.slideshow,10),pause:1e3*n.slideshow_interval,autoHover:!0,pager:!0,onSliderLoad:function(){t.css({"max-height":"100%",overflow:"visible"})}},l={},c=t.closest(".jr-tabs"),u=t.closest(".tab-pane"),f=t.closest('[data-ui-object="joms-tabs"]');c.length?(r=c.find("li a").eq(0).attr("href").split("#")[1],s=c.find(".ui-tabs-panel").index(a.closest(".ui-tabs-panel")),r&&a.parents("#"+r).length?a.bxSlider(d):c.find(".ui-tabs-nav > li > a").eq(s).one("click",function(){a.bxSlider(d)})):u.length?setTimeout(function(){if(o=u.parent().prev("ul").find("li a").eq(0).attr("href"),r=o?o.split("#")[1]:null,r&&a.parents("#"+r).length)a.bxSlider(d);else{e('a[data-toggle="tab"]').on("shown.bs.tab",function(){"function"==typeof l.redrawSlider?l.redrawSlider():l=a.bxSlider(d)});var t=u.attr("id").match(/[\d]+$/);t&&e("#cbtabnav"+t+" a").one("click",function(){a.bxSlider(d)})}},550):f.length?(r=f.find(".joms-tab__bar a").eq(0).attr("href").split("#")[1],s=f.find(".joms-tab__content").index(a.closest(".joms-tab__content")),r&&a.parents("#"+r).length?a.bxSlider(d):f.find(".joms-tab__bar a").eq(s).one("click",function(){a.bxSlider(d)})):"function"==typeof a.bxSlider&&a.not(".jr-slider-ready").addClass("jr-slider-ready").bxSlider(d)}})}},t.lightbox=function(){e(".jrPage a.fancyvideo").length>0&&e("a.fancyvideo").magnificPopup({type:"iframe",callbacks:{elementParse:function(e){e.src=e.src+"&lightbox=1&tmpl=component"}}}),e(".jrPage a.fancybox").length>0&&(e(".jrPage").magnificPopup({delegate:'a.fancybox[rel="gallery"]',type:"image",mainClass:"mfp-fade",zoom:{enabled:!0,duration:300},gallery:{enabled:!0,preload:[0,2],navigateByImgClick:!0,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',tCounter:'<span class="mfp-counter">%curr% of %total%</span>'}}),e(".jrReviewContainer .jrMediaContainer").each(function(){e(this).magnificPopup({delegate:"a.fancybox",type:"image",mainClass:"mfp-fade",zoom:{enabled:!0,duration:150},gallery:{enabled:!0,preload:[0,2],navigateByImgClick:!0,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',tCounter:'<span class="mfp-counter">%curr% of %total%</span>'}})}))},t.media={init:function(){if("undefined"==typeof jreviewsMedia)return!1;t.media.formSetup();var i=e("div.jr-listing-media"),n=i.find(".jr-tabs-media"),r=["photo","photo_owner","photo_user","video","video_owner","video_user","audio","attachment"];i.find("div.jr-media-sortable").sortable({axis:"y",containment:"parent",handle:".jr-sort-handle",cursor:"move",stop:jreviewsMedia.reorder}),e(r).each(function(e,t){i.find("div#"+t).length?i.find('a[href="#'+t+'"]').closest("li").show():i.find('a[href="#'+t+'"]').closest("li").remove()}),t.tabs(n),jreviewsMedia.photoFunction(a),jreviewsMedia.videoGallery.init(),jreviewsMedia.photoGallery.init(),jreviewsMedia.audioPlayer()},generateThumbs:function(){e('img[data-thumbnail="1"]').not(".jr-ready").each(function(){var i=e(this);i.addClass("jr-ready");var a={"data[media_id]":e(this).data("media-id"),"data[size]":e(this).data("size"),"data[mode]":e(this).data("mode")},n=t.dispatch({method:"post",type:"json",controller:"media_upload",action:"generateThumb",data:a});n.done(function(e){if(e.success&&""!==e.url){var t=i.closest("div");i.css("none"!=t.css("max-width")?{width:t.css("max-width"),height:"auto"}:{width:e.width+"px",height:e.height+"px"}),i.attr("src",e.url)}})})},formSetup:function(){var i=e("div.jr-media-upload"),a=i.find("#jr-media-uploader"),n=a.data("android");if(i.length){var r=i.find("form#jr-user-info");try{if(t.paid.plan.plan_selected){var o=e('<input type="hidden" name="data[plan_id]">').val(t.paid.plan.plan_selected);i.find("form").append(o)}}catch(s){}t.common.validateUsername(r),t.common.validateEmail(r),t.common.initForm("jr-user-info",!0);var d=i.find("form#jr-form-media-upload"),l=d.data("file-validation");jreviewsMedia.initUploader("jr-media-uploader",{fileValidation:l,multiple:n?!1:!0});var c=i.find(".jr-upload-button"),u=c.find("input"),f=i.find(".jr-upload-mobile-options");f.length&&(c.hide(),f.on("change",function(){var t=e(this).val();u.removeAttr("multiple"),"multiple"==t&&u.attr("multiple","multiple"),""!==t&&u.trigger("click")}).buttongroup())}},manager:function(){var i=n.length?n:a;i.on("click",".jr-media-edit",function(){var i=e(this),a=i.data("media-id"),n=i.find("span").eq(1),r=t.dispatch({method:"get",type:"html",controller:"media",action:"_edit",data:{media_id:a}});r.done(function(a){var r={};r[t.__t("SUBMIT")]=function(){t.media.editSubmit(i,e(this))},r[t.__t("CANCEL")]=function(){e(this).find("#jr-video-player").trigger("jrVideoDestroy"),e(this).find("#jr-audio-player").remove(),e(this).dialog("close")};{var o=function(){e(this).find("#jr-video-player").trigger("jrVideoDestroy"),e(this).find("#jr-audio-player").remove()},s=function(){var i=e(this),a=i.find("div.jr-video-gallery"),n=i.find("#jr-audio-player"),r=i.find(".jr-thumbnails");r.length&&r.find(".jr-thumb-del").on("click",function(){var i=e(this);if(1==i.data("delete")){i.data("delete",0);var a={id:i.data("id"),size:i.data("size")},n=i.data("token");n&&(a[n]=1);var r=t.dispatch({method:"get",type:"json",controller:"media",action:"_deleteThumb",data:a});r.done(function(a){a.success?i.fadeOut(500):a.str.length&&e.jrAlert(t.__t(a.str))})}}).on("mouseenter",function(){var t=(e(this),e('<span class="jrIconDelete jrIconOnly">'));e(this).data("delete",1).data("contents",e(this).html()).html(t)}).on("mouseleave",function(){e(this).data("delete",0).html(e(this).data("contents"))}),a.length&&jreviewsMedia.videoGallery.init(),n.length&&jreviewsMedia.audioPlayer(),t.common.userAutocomplete(i.find("form"))};e.jrDialog(a,{buttons:r,title:n.html(),open:s,close:o,width:"800px"})}})}),i.on("click",".jr-media-delete",function(){var i=e(this),a=i.data("media-id"),n=i.data("token"),r=(i.data("lang"),i.find("span").eq(1)),o={},s=new e.Deferred;s.done(function(r){o[n]=1,o["data[Media][media_id]"]=a;var s=t.dispatch({method:"get",type:"json",controller:"media",action:"_delete",data:o});s.done(function(a){a.success?(r.dialog("close"),i.closest(".jr-layout-outer").css("background-image","none").animate({backgroundColor:"#f7f1ac"},600).promise().done(function(){e(this).slideUp(600,function(){e(this).remove()})})):(r.dialog("option","buttons",[]),r.html(t.__t(a.str)))})});var d={};d[t.__t("DELETE")]=function(){s.resolve(e(this))},d[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(t.__t("MEDIA_DELETE_CONFIRM"),{buttons:d,title:r.html(),width:"640px"})}),i.on("click",".jr-media-publish",function(){var i=e(this),a=i.find("span").eq(0),n=i.data("media-id"),r=i.data("token"),o=i.data("states"),s={on:t.__t("PUBLISHED"),off:t.__t("UNPUBLISHED")},d={media_id:n};d[r]=1;var l=t.dispatch({method:"get",type:"json",controller:"media",action:"_publish",data:d});l.done(function(i){i.success?(a.attr("class",1==i.state?o.on:o.off),a.next().is("span")?a.next().html(1==i.state?s.on:s.off):a.attr("title",1==i.state?s.on:s.off)):e.jrAlert(t.__t(i.str))})}),i.on("click","button.jr-media-main",function(a){a.preventDefault();var n=e(this),r=n.find("span").eq(0),o=n.data("listing-id"),s=n.data("media-id"),d=n.data("token"),l=n.data("states"),c={listing_id:o,media_id:s,state:n.data("mainMedia")};c[d]=1,n.prop("disabled",!0);var u=t.dispatch({method:"get",type:"json",controller:"media",action:"setMainMedia",data:c});u.done(function(t){if(t.success===!0){var a=function(){i.find("button.jr-media-main").not(n).each(function(){e(this).data("mainMedia",0),e(this).find("span").eq(0).attr("class",l.off)})};e.when(a()).done(function(){n.data("mainMedia",1===c.state?0:1),r.attr("class",1===c.state?l.off:l.on),n.prop("disabled",!1)})}})})},editSubmit:function(e,i){var a=i.find("form"),n=t.dispatch({form:a});n.done(function(a){a.success?(i.dialog("close"),e.closest(".jr-layout-inner").find(".jr-media-title a").html(a.title)):(i.dialog("option","buttons",[]),i.html(t.__t(a.str)))})},download:function(){e(".jr-page").on("click",".jr-media-download",function(){var i=e(this),a=i.data("media-id"),n=i.data("token-s"),r=i.data("token-i");if(t.iOS)window.open(s2AjaxUri+"&url=media/download&"+t.qvars.mc+"="+a+"&"+n+"=1&"+r+"=1");else{e("#jr-download-"+a).remove();var o=e('<iframe id="jr-download-'+a+'" style="display:none;"></iframe>');o.attr("src",s2AjaxUri+"&url=media/download&"+t.qvars.mc+"="+a+"&"+n+"=1&"+r+"=1").appendTo("body")}})}},t.inquiry={init:function(){var i=e("button.jr-send-inquiry-embedded,a.jr-send-inquiry-embedded");i.length&&(t.common.initForm("jr-form-inquiry"),i.on("click",function(e){e.preventDefault(),t.inquiry.submit()})),e("body").on("click","button.jr-send-inquiry,a.jr-send-inquiry",function(i){i.preventDefault();var a=e(this),n=a.data("listing-id"),r=a.find("span").eq(1),o=t.dispatch({method:"get",type:"html",controller:"inquiry",action:"create",data:{id:n}});o.done(function(i){var a={};a[t.__t("SUBMIT")]=function(){t.inquiry.submit(e(this))},a[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(i,{buttons:a,title:r.html(),width:"640px"}),t.common.initForm("jr-form-inquiry",!0)})})},submit:function(i){var a,n=e("#jr-form-inquiry-outer"),r=n.find(".jr-validation");a=i?i.find("form"):n.find("form"),n.find(".jr-validation").hide(),r.hide().html("");var o=t.dispatch({form:a});o.done(function(o){o.success?(i&&i.dialog("option","buttons",[]),n.html(t.__t("INQUIRY_SUBMIT"))):(o.str.length&&r.html(t.__t(o.str)).show(),t.captcha.reset(a.find(".g-recaptcha").data("id")),n.find("#jr-form-inquiry").find(".jr-validation-input").hide(),e.each(o.inputs,function(e,t){n.find("#jr-inquiry-"+t).siblings("label").find(".jr-validation-input").show()}),i&&i.trigger("failedValidation"))})}},t.masonry=function(){var t,i,a,r,o,s=function(){t=d.parent().width(),i=Math.floor(l>150?t/l:t/150),a=12*(i-1),r=2*i,o=(t-a-r)/i,d.find(".jrListItem").css({width:o})},d=n.find(".jr-masonry-results"),l=d.find(".jrListItem:first").data("thumbwidth"),c=d.find(".jrListItem:first").data("rtl");d.length&&e().jrMasonry&&(s(),d.jrMasonry({itemSelector:".jrListItem",columnWidth:function(e){return e/i},gutterWidth:0,isFitWidth:!0,isResizable:!0,isRTL:c,isAnimated:!0,animationOptions:{duration:300}}),e(window).on("resize",function(){s(),d.jrMasonry("reload")}))},t.claim={init:function(){e("button.jr-listing-claim,a.jr-listing-claim").on("click",function(i){i.preventDefault();var a=e(this),n=a.data("listing-id"),r=a.data("state"),o=a.find("span").eq(1);if("no-access"==r)e.jrAlert(t.__t("CLAIM_REGISTER"));else{var s=t.dispatch({method:"get",type:"html",controller:"claims",action:"create",data:{listing_id:n}});s.done(function(i){var a={};a[t.__t("SUBMIT")]=function(){t.claim.submit(e(this))},a[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(i,{buttons:a,title:o.html(),width:"640px"})})}})},submit:function(e){var i=e.find("form"),a=i.find(".jr-validation");a.html("").hide();var n=t.dispatch({form:i});n.done(function(n){n.success?(e.dialog("option","buttons",[]),i.html(t.__t("CLAIM_SUBMIT"))):n.str.length?a.html(t.__t(n.str)).show():(e.trigger("failedValidation"),a.html(t.__t("CLAIM_VALIDATE_MESSAGE")).show())})}},t.listing={favorite:function(){e("body").on("click",".jr-listing-favorite",function(i){i.preventDefault();var a=e(this),n=a.find("span").eq(0),r=a.find("span").eq(1),o=a.data("states"),s=a.data("listing-id");switch(a.attr("disabled","disabled"),a.data("state")){case"favored":var d=t.dispatch({method:"get",type:"json",controller:"listings",action:"_favoritesDelete",data:{"data[listing_id]":s}});d.done(function(i){i.success?(a.data("state","not_favored"),n.attr("class",o.not_favored),r.html(t.__t("FAVORITE_ADD")),e(".jr-favorite-"+s).html(i.count).effect("highlight",{},1e3)):e.jrAlert(t.__t(i.str))}),d.always(function(){a.removeAttr("disabled")});break;case"not_favored":var l=t.dispatch({method:"get",type:"json",controller:"listings",action:"_favoritesAdd",data:{"data[listing_id]":s}});l.done(function(i){i.success?(a.data("state","favored"),n.attr("class",o.favored),r.html(t.__t("FAVORITE_REMOVE")),e(".jr-favorite-"+s).html(i.count).effect("highlight",{},1e3)):e.jrAlert(t.__t(i.str))}),l.always(function(){a.removeAttr("disabled")});break;case"no_access":e.jrAlert(t.__t("FAVORITE_REGISTER"))}})},manager:function(){var i=e('ul.jr-listing-manager:not(".jr-ready")').addClass("jr-ready");i.on("click","a.jr-listing-publish,a.jr-listing-feature",function(){var i,a,n=e(this),r=n.find("span").eq(0),o=n.find("span").eq(1),s=n.data("states"),d=n.data("listing-id"),l=n.data("token"),c={id:d};switch(c[l]=1,n.attr("class")){case"jr-listing-publish":i="_publish",a={on:t.__t("PUBLISHED"),off:t.__t("UNPUBLISHED")};break;case"jr-listing-feature":i="_feature",a={on:t.__t("FEATURED"),off:t.__t("NOT_FEATURED")}}var u=t.dispatch({method:"get",type:"json",controller:"listings",action:i,data:c});u.done(function(i){i.success?(r.attr("class",1==i.state?s.on:s.off),o.html(1==i.state?a.on:a.off)):e.jrAlert(t.__t(i.str))})}),i.on("click","a.jr-listing-delete",function(){var i=e(this),a=i.find("span").eq(1),n=i.data("listing-id"),r=i.data("token"),o={id:n};o[r]=1;var s=new e.Deferred;s.done(function(e){var a=t.dispatch({method:"get",type:"json",controller:"listings",action:"_delete",data:o});a.done(function(a){if(a.success){e.dialog("close");try{i.closest(".jr-layout-outer").html('<div class="jrSuccess">'+t.__t("LISTING_DELETED")+"</div>").jrScrollTo()}catch(n){}}else e.dialog("option","buttons",[]),e.html(t.__t(a.str))})});var d={};d[a.html()]=function(){s.resolve(e(this))},d[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(t.__t("LISTING_DELETE_CONFIRM"),{buttons:d,title:a.html(),width:"640px"})})},formSetup:function(){var n=e("#jr-form-listing"),r=n.find(".jr-form-categories-outer"),o=n.find(".jr-form-listing-fields"),s=r.find(".jr-cat-select"),d=n.data("listing-id"),l=parseInt(n.data("cat-id"),10);if(d){var c=e('<span class="jrLoadingSmall">'),u=n.jreviewsFields({entry_id:e("#listing_id","#jr-form-listing").val()||"",value:!1,page_setup:!0,referrer:"listing"});r.append(c),u?u.done(function(){o.show().find(".jr-wysiwyg-editor").tinyMCE(),a.trigger("onListingFormLoaded"),o.jrApplyFieldOptionLayout(),c.remove()}):(o.show().find(".jr-wysiwyg-editor").tinyMCE(),c.remove())}if(t.listing.submitCategory(n),l){{s.last().removeAttr("disabled").trigger("change")}d||s.attr("disabled","disabled")}n.on("change","input#jr-review-optional",function(){a.find(".jr-form-review").slideToggle()}),n.on("click","button.jr-cancel-listing",function(e){e.preventDefault(),history.go(-1)}),n.on("click","button.jr-submit-listing",function(a){a.preventDefault();var o=e(this),s=n.closest(".jr-form-listing-outer"),c=n.find(".jr-buttons"),u=n.find(".jr-wysiwyg-editor"),f=n.find(".jr-validation"),p=0,m=[];e("select[id^=cat_id]").each(function(){var t=e(this).val();t>0&&m.push(e(this))}),p=m.length,1==p?n.find("#category").val(m[0].find("option:selected").text().replace(/(- )+/,"")):p>1&&(n.find("#category").val(m[p-1].find("option:selected").text().replace(/(- )+/,"")),n.find("#parent_category").val(m[p-2].find("option:selected").text().replace(/(- )+/,"")));
try{u.SaveTinyMCE()}catch(h){}n.jrSetValidFields().join(","),c.find("button").attr("disabled","disabled"),c.append('<span class="jrLoadingSmall">'),f.hide(),(l||d)&&r.find("select").removeAttr("disabled");var v=t.dispatch({form:n});v.done(function(e){if(e.success===!0){if(e.facebook&&e.moderation===!1){var a={id:e.listing_id};a[e.token]=1,t.facebook.addTokenAndPost("_postListing","html",a)}if(e.plgBeforeRenderListingSave)return o.trigger("plgBeforeRenderListingSave",e),!1;s.jrScrollTo({duration:400,offset:-100},function(){s.html(function(){var t="",a="";return t=e.html,e.mediaForm!==i&&(a=e.mediaForm),t+a}),t.tabs(s.find(".jr-tabs")),t.media.formSetup()})}else e.str&&(e.str.length&&f.html(t.__t(e.str)).show(),t.captcha.reset(n.find(".g-recaptcha").data("id")))}),v.always(function(){(l||d)&&r.find("select").attr("disabled","disabled"),n.find("#valid_fields").remove(),c.find(".jrLoadingSmall").remove(),n.find("button").removeAttr("disabled")})})},submitCategory:function(n){var r=e('<div class="jrRoundedPanel" style="text-align:center;"><span class="jrLoadingMedium" style="display:inline;padding:20px;"></span>'+t.__t("LOADING")+"</div>");n.on("change",".jr-cat-select",function(){var o=e(this);formChooser=n.find(".jr-form-categories-outer"),formFields=n.find(".jr-form-listing-fields"),formCategories=n.find(".jr-form-categories"),listing_id=parseInt(n.data("listing-id"),10)||"",selected_cat_id=parseInt(n.find(".jr-cat-select").last().val(),10),editing=listing_id>0?!0:!1;var s=formCategories.find("select").index(o)+1;if(editing)return!1;n.find(".jr-wysiwyg-editor").RemoveTinyMCE();var d=[];e(".jr-form-categories").find('select[disabled="disabled"]').each(function(){d.push(e(this))});var l=formChooser.find("select,input").removeAttr("disabled").serializeArray();e(d).each(function(){e(this).attr("disabled","disabled")}),l.push({name:"data[level]",value:s}),l.push({name:"data[catid]",value:o.val()});var c=t.dispatch({method:"get",type:"json",controller:"listings",action:"_loadForm",data:l});r.insertAfter(formChooser);var u=new e.Deferred;u.done(function(e,t){try{e.jreviewsFields(t)}catch(i){}}),u.always(function(){a.trigger("onListingFormLoaded")});var f=new e.Deferred;f.done(function(e){formFields.jreviewsFields(e)}),f.always(function(){t.common.initForm(n.attr("id"),!0),t.common.validateUsername(n),t.common.validateEmail(n);var e=n.find("fieldset.jr-form-review");e.length?u.resolve(e,{fieldLocation:"Review",entry_id:0,value:!1,page_setup:!0,referrer:"review"},selected_cat_id,"listingFormReview"):a.trigger("onListingFormLoaded"),r.remove(),formFields.show(),formFields.jrApplyFieldOptionLayout()}),c.done(function(a){if(a.level!==i){var o=formCategories.children("select");o.each(function(t){t>a.level&&e(this).remove()})}switch(a.select!==i&&formCategories.append(a.select),a.action){case"show_form":formFields.html(a.html);try{formFields.find(".jr-wysiwyg-editor").tinyMCE()}catch(s){}f.resolve({entry_id:listing_id,value:!1,page_setup:!0,referrer:"listing",res:a}),t.facebook.init(n),t.review.starRating(n),setTimeout(function(){t.captcha.init(n)},200);var d=n.find(".jr-listing-title");d.length&&t.search.liveSearch(d,{id:"submitListing"});break;case"hide_form":r.remove(),formFields.hide();break;case"no_access":r.remove(),formFields.html(t.__t("LISTING_SUBMIT_DISALLOWED")).show()}})})},widgets:function(){var n=a.filter(".jr-listing-detail"),r=[];n.length&&(n.find(".jr-tabs").find("li>a").each(function(t,i){var a=e(i).attr("href"),n=a.substring(a.indexOf("#")+1);r["#"+n]=e(i).parent("li")}),"undefined"!=typeof jrRelatedWidgets&&jrRelatedWidgets.length&&e(jrRelatedWidgets).each(function(a,n){var o;o=n.favorites?"module_favorite_users":"relatedreviews"==n.type?"module_reviews":"module_listings";var s=t.dispatch({method:"get",type:"html",controller:o,action:"index",data:n});s.done(function(a){var o=""!==n.target_class?n.target_class:n.target_id,s=e(""!==n.target_class?"."+n.target_class:"#"+n.target_id);if(""!==a.trim()){var d=e('<div id="'+o+"Widget"+n.key+'"></div>').addClass("jrWidget");n.title&&d.append('<h3 class="jrHeading">'+n.title+"</h3>"),d.append(a),s.append(d);for(var l=[0,1,2,3,4,5,6,7,8,9],c=0;c<l.length;c++)l[c]=e("#"+o+"Widget"+l[c]);for(var c=0;c<l.length;c++)l[c].length>0&&s.append(l[c]);r["#"+o]!==i&&""!==s.html()&&r["#"+o].show()}else r["#"+o]!==i&&""===s.html()&&r["#"+o].hide();t.module.init(),t.media.generateThumbs()})}))}},t.review={setup:function(n,r){var o=e("form#"+n),s=o.closest("div.jr-form-review-outer");if(o.data("initialized")==i){o.data("initialized",1),t.review.starRating(s),t.common.validateUsername(o),t.common.validateEmail(o),t.common.initForm(n,!0),t.facebook.init(o);var d=o.jreviewsFields({fieldLocation:"Review",entry_id:r,value:!1,page_setup:!0,referrer:"review"});d&&d.done(function(){0===r&&s.slideDown().delay().jrScrollTo({duration:500,offset:-50}),a.trigger("onReviewFormLoaded"),o.jrApplyFieldOptionLayout()})}},init:function(){var i=document.URL;if(e("body").on("click",".jr-page .jr-review-add",function(i){i.preventDefault();var a,n,r=e(this),o=e("#userReviews"),s=e("#editorReviews");if(o.length)a=o.parents(".jr-page"),n=o.find(".jr-login-box");else{if(!s.length)return!1;a=s.parents(".jr-page"),n=s.find(".jr-login-box")}var d=a.find(".jr-tabs"),l=a.find("div.jr-form-review-outer"),c=l.find('form[id^="jr-form-review"]'),u=c.attr("id"),f=c.data("review-id");d.length&&d.tabs("select","#reviewsTab"),c.length&&!n.length?(t.review.setup(u,f),a.find('button.jr-review-add:not(".jr-listing-info")').fadeOut(),l.slideDown("fast").jrScrollTo({duration:500,offset:-50})):o.jrScrollTo(),n.length&&!r.hasClass("jr-listing-info")&&n.slideToggle(100)}),e("body").on("click",'form[id^="jr-form-review"] .jr-review-cancel',function(t){t.preventDefault(),e(this).closest(".jr-form-review-outer").slideUp(),e(this).closest(".jr-page").find('button.jr-review-add:not(".jr-listing-info")').fadeIn().delay().jrScrollTo({duration:500,offset:-50})}),e("body").on("click",'form[id^="jr-form-review"] .jr-review-submit',function(i){i.preventDefault();var a=e(this),n=e(".jr-user-reviews"),r=a.closest("div.jr-form-review-outer"),o=r.find('form[id^="jr-form-review"]'),s=o.find(".jr-buttons"),d=o.find("div.jr-validation");o.jrSetValidFields().join(","),s.find("button").attr("disabled","disabled"),s.append('<span class="jrLoadingSmall">'),d.hide();var l=t.dispatch({form:o});l.done(function(e){if(e.success){if(r.slideUp().remove(),e.facebook&&e.moderation===!1){var i={id:e.review_id};i[e.token]=1,t.facebook.addTokenAndPost("_postReview","html",i)}var a="";e.moderation===!1&&(a='<div class="jr-message jrSuccess">'+t.__t("user"==e.review_type?"REVIEW_SUBMIT_NEW":"REVIEW_SUBMIT_NEW_REFRESH")+"</div>"),n.prepend('<div class="jr-new-review jrHidden">'+a+e.html+"</div>").jrScrollTo({duration:500,offset:-50}).delay().find(".jr-new-review").slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500),t.review.edit(),t.review.vote(),t.popup()}else e.str.length&&(d.html(t.__t(e.str)).show(),t.captcha.reset(o.find(".g-recaptcha").data("id")))}),l.always(function(){o.find("#jr-valid_fields").remove(),s.find(".jrLoadingSmall").remove(),s.find("button").removeAttr("disabled")})}),e("body").on("click",".jr-page .jr-owner-reply-del",function(i){i.preventDefault();var a=e(this),n=a.data("review-id"),r=a.data("token"),o=a.find("span").eq(1),s=new e.Deferred;s.done(function(e){var i={id:n};i[r]=1;var o=t.dispatch({method:"get",type:"json",controller:"owner_replies",action:"_delete",data:i});o.done(function(i){i.success?(e.dialog("close"),a.closest(".jr-owner-reply-outer").replaceWith('<div class="jrSuccess">'+t.__t("OWNER_REPLY_DELETED")+"</div>")):(e.dialog("option","buttons",[]),i.str.length&&e.html(t.__t(i.str)))})});var d={};d[t.__t("DELETE")]=function(){s.resolve(e(this))},d[t.__t("CANCEL")]=function(){e(this).dialog("close")};e.jrDialog(t.__t("OWNER_REPLY_DELETE_CONFIRM"),{buttons:d,title:o.html(),width:"640px"})}),i.match("#reviewForm$")||i.match("#userReviews$")){var n=a.find(".jr-tabs");n.length&&e(".jr-tabs").tabs("select","#reviewsTab").jrScrollTo({duration:500,offset:-100}),i.match("#reviewForm$")&&a.find(".jr-review-add").first().trigger("click")}},edit:function(){e("body").on("click",'.jr-page .jr-review-edit:not(".jr-ready")',function(i){i.preventDefault();var a=e(this),n=a.find("span").eq(1),r=a.data("review-id"),o=a.data("referrer"),s="jr-form-review-"+r,d=e("#jr-form-review-0"),l=e('<div id="jr-form-review-placeholder" class="jrHidden"></div>');d.before(l);var c=d.detach(),u=t.dispatch({method:"get",type:"html",controller:"reviews",action:"_edit",data:{review_id:r}});u.done(function(i){var d={};d[t.__t("SUBMIT")]=function(){t.review.editSubmit(a,e(this),l,c)},d[t.__t("CANCEL")]=function(){l.after(c),l.remove(),e(this).dialog("close")};var u=e.jrDialog(i,{buttons:d,title:n.html(),width:"800px",height:600});u.find("form").append('<input name="data[referrer]" type="hidden" value='+o+">"),t.review.setup(s,r),t.common.userAutocomplete(u)})}).addClass("jr-ready")},editSubmit:function(i,a,n,r){var o=i.closest(".jr-layout-inner"),s=a.find("form"),d=(s.attr("id"),e(".ui-dialog-buttonpane")),l=s.find(".jr-validation").clone();d.find(".jr-validation").fadeOut().remove(),s.jrSetValidFields().join(",");var c=t.dispatch({form:s});c.done(function(e){if(e.success){n.after(r),n.remove(),a.dialog("close");var i="";o.hide(0).html(function(){return e.moderation===!1&&(i='<div class="jr-message jrSuccess">'+t.__t("user"==e.review_type?"REVIEW_SUBMIT_EDIT":"REVIEW_SUBMIT_EDIT_REFRESH")+"</div>"),i+e.html}).jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500)}else e.str.length&&(l.html(t.__t(e.str)),d.prepend(l),l.fadeIn());t.review.edit(),t.review.vote(),t.popup()}),c.always(function(){s.find("#jr-valid_fields").remove()})},starRating:function(t){t.find(".jr-rating-stars").each(function(){function t(){s.html(o.find("option:selected").text()),o.val()>0&&u.find(".ui-slider-handle").toggleClass("ui-slider-on",!0),p.removeClass("ui-stars-star-on")}function i(){p.addClass("ui-stars-star-on"),o.val("na"),f.css("left","0%").removeClass("ui-slider-on"),s.html(o.find('[value="na"]').text())}var a=e(this),n=a.data("selector"),r=a.data("inc"),o=a.find("select"),s=a.closest(".jrRow").find(".jrRatingCaption"),d=o.data("style")||1,l=o.data("color")||"orange";if("stars"==n){var c=1/r;a.stars({starColor:l,starStyle:d,split:c,captionEl:a.parent().next()})}else if("slider"==n){var u,f,p,m;m=o.find('[value="na"]').length,p=e(m?'<div class="ui-stars-cancel"><a>na</a></div>':'<div class="ui-stars-cancel-placeholder"></div>'),e.ui.slider.prototype.widgetEventPrefix="slider",u=e('<div class="jrSliderInput">').slider({min:1,max:o.children("option").last().val(),step:r,value:"na"!==o.val()?o.val():0,start:function(){f.addClass(l).toggleClass("ui-slider-on",!0)},slide:function(e,i){o.val(i.value),t()}}),f=u.find(".ui-slider-handle").on("click mousedown",function(){u.slider("enable"),s.html(o.find("option:selected").text()),p.removeClass("ui-stars-star-on")}),p.on("click",function(e){e.preventDefault(),i()}),"na"!==o.val()?t():i(),a.hide().after(p,u)}})},reply:function(){e("body").on("click",'.jr-page .jr-owner-reply:not(".jr-ready")',function(){var i=e(this),a=i.find("span").eq(1),n=i.data("review-id"),r=t.dispatch({method:"get",type:"html",controller:"owner_replies",action:"create",data:{review_id:n}});r.done(function(n){var r={};r[t.__t("SUBMIT")]=function(){t.review.replySubmit(i,e(this))},r[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(n,{buttons:r,title:a.html(),width:"640"})})})},replySubmit:function(e,i){var a=i.find("form"),n=a.find(".jr-validation"),r=t.dispatch({form:a});n.hide(),r.done(function(a){a.success?(i.html(t.__t(a.str)),i.dialog("option","buttons",[]),e.attr("disabled","disabled")):(i.trigger("failedValidation"),n.html(t.__t(a.str)).show())})},vote:function(){e("body").on("click",'div.jr-review-vote:not(".jr-ready") button',function(i){i.preventDefault();var a=e(this),n=a.data("vote"),r=a.closest(".jr-review-vote"),o=r.data("state"),s=r.data("review-id"),d=(a.find("span").eq(0),a.find("span").eq(1));if(r.unbind("click").find("button").attr("disabled","distabled"),"access"!=o)e.jrAlert(t.__t("register"==o?"REVIEW_VOTE_REGISTER":"ACCESS_DENIED"));else{var l={"data[Vote][review_id]":s,"data[type]":n},c=t.dispatch({method:"get",type:"json",controller:"votes",action:"_save",data:l});c.done(function(i){if(i.success){if(d.html(parseInt(d.html(),10)+1),i.facebook&&"yes"==n){var a={id:s};a[i.token]=1;var r=e.Deferred();r.done(function(){var e=function(e){try{"object"==typeof e&&FB.ui(e)}catch(t){console.log(t)}};t.facebook.addTokenAndPost("_postVote","json",a,e)}),FB.getLoginStatus(function(t){"connected"===t.status?FB.api("/me/permissions",function(t){var i=!1;t&&!t.error&&(e.each(t.data,function(e,t){"publish_actions"==t.permission&&"granted"==t.status&&(i=!0)}),i?r.resolve():FB.login(function(e){e.authResponse&&r.resolve()},{scope:"publish_actions"}))}):FB.login(function(e){e.authResponse&&r.resolve()},{scope:"publish_actions"})})}}else i.str.length&&e.jrAlert(t.__t(i.str))})}}).addClass("jr-ready")}},t.report={init:function(){e("body").off("click",".jr-page button.jr-report").on("click",".jr-page button.jr-report",function(i){i.preventDefault();var a=e(this),n={listing_id:a.data("listing-id"),review_id:a.data("review-id"),post_id:a.data("post-id"),m:a.data("media-id"),extension:a.data("extension")},r=t.dispatch({method:"get",type:"html",controller:"reports",action:"create",data:n});r.done(function(i){var a={};a[t.__t("SUBMIT")]=function(){t.report.submit(e(this))},a[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(i,{buttons:a,title:t.__t("REPORT_INAPPROPRIATE"),width:"640"})})})},submit:function(e){var i=e.find("form"),a=i.find(".jr-validation");a.html("").hide();var n=t.dispatch({form:i});n.done(function(n){n.success?(e.dialog("option","buttons",[]),i.html(t.__t("REPORT_SUBMIT"))):(e.trigger("failedValidation"),a.html(t.__t(n.str)).show())})}},t.facebook={buttons_class:"jr-buttons",enable:!1,permissions:!1,uid:null,load:function(){var i=t.fb.appid||null,n=a.find(".jr-fb-like").length||a.find(".jr-fb-share").length;(t.fb.xfbml||t.fb.post||n)&&(e("#fb-root").length?n&&"object"==typeof FB?FB.XFBML.parse(a.get(0)):n&&"function"!=typeof window.fbAsyncInit&&(window.fbAsyncInit=function(){FB.XFBML.parse(a.get(0))}):(e("body").append('<div class="jrHidden" id="fb-root"></div>'),window.fbAsyncInit=function(){FB.init({appId:i,status:!0,cookie:!0,xfbml:n?!0:!1,version:"v2.3"})}),function(e,i,a){var n,r=e.getElementsByTagName(i)[0];e.getElementById(a)||(n=e.createElement(i),n.id=a,n.async=!0,n.src="//connect.facebook.net/"+t.locale+"/sdk.js",r.parentNode.insertBefore(n,r))}(document,"script","facebook-jssdk"))},init:function(e){t.fb.post&&(t.facebook.form=e,t.facebook.checkPermissions())},login:function(){null!==t.facebook.uid&&t.facebook.permissions||FB.login(function(i){i.authResponse?(t.facebook.uid=i.authResponse.userID,t.facebook.permissions||FB.api("/me/permissions",function(i){i&&!i.error&&e.each(i.data,function(e,i){"publish_actions"==i.permission&&"granted"==i.status&&(t.facebook.permissions=!0)}),t.facebook.permissions||e("#jr-fb-publish").prop("checked",!1)})):e("#jr-fb-publish").prop("checked",!1)},{scope:"publish_actions"})},checkPermissions:function(i){var a={};a=e.extend(a,i),t.facebook.FBInit=setInterval(function(){"object"==typeof FB&&FB.getLoginStatus(function(i){"connected"===i.status?(t.facebook.uid=i.authResponse.userID,FB.api("/me/permissions",function(i){var a=!1;i&&!i.error&&(e.each(i.data,function(e,t){"publish_actions"==t.permission&&"granted"==t.status&&(a=!0)}),t.facebook.addButton(a?!0:!1))})):t.facebook.addButton(!1)})},450)},addButton:function(a){if(clearInterval(t.facebook.FBInit),t.facebook.permissions=a,t.facebook.form===i)return!1;var n=t.facebook.form.find("."+t.facebook.buttons_class);if(a!==!0||t.fb.optout){var r=e('<div class="jrFacebookPublish"><input id="jr-fb-publish" name="data[fb_publish]" value="1" type="checkbox"><div class="jrButton jrBlue"><span class="fb_button_text"><label for="jr-fb-publish">'+t.__t("FACEBOOK_PUBLISH")+"</label></span></div></div>").on("click","input",function(){this.checked&&t.facebook.login()});0===n.find("#jr-fb-publish").length&&n.prepend(r),a&&t.fb.optout&&r.find("input").attr("checked","checked")}else n.prepend('<input id="jr-fb-publish" name="data[fb_publish]" value="1" type="hidden" />')},addTokenAndPost:function(e,i,a,n){FB.getLoginStatus(function(r){if("connected"==r.status){a.accessToken=r.authResponse.accessToken;var o=t.dispatch({method:"get",type:i,controller:"facebook",action:e,data:a});o.done(function(e){"function"==typeof n&&n(e)})}})}},t.captcha={init:function(e){if(e.find(".jr-captcha").length&&"object"==typeof grecaptcha){var i=e.find(".g-recaptcha"),a=grecaptcha.render(i[0],{sitekey:i.data("sitekey"),theme:i.data("theme"),"expired-callback":t.captcha.reset});i.data("id",a)}},reset:function(e){e!==i&&"object"==typeof grecaptcha&&grecaptcha.reset(e)}},t.common={initForm:function(a,n){var r="string"==typeof a?e("#"+a):a,o=r.find("div.jr-captcha");r.on("click",".jr-user-forget",function(i){var a=e(this);i.preventDefault();var n=t.dispatch({cache:!1,method:"get",controller:"users",action:"_clearUserInfo"});n.done(function(){r.find(".jr-user-name, .jr-user-username, .jr-user-email").val("").prop("disabled",!1),a.closest("span").remove()})}),r.one("mouseover",function(){var n=t.dispatch({cache:!1,method:"get",type:"json",controller:"common",action:"_initForm",data:{"data[form_id]":a,"data[captcha]":o.length}});n.done(function(a){r.find("span.jr_token :input").attr("name",a.token),a.captcha&&(o.html(a.captcha),setTimeout(function(){t.captcha.init(r)},750)),r.find("input.jr-user-name").val(a.name);var n=r.find("input.jr-user-username");n.val(a.username).on("focus mouseover",function(){e(this).closest("div").find(".jr-more-info").trigger("mouseover")}).on("blur mouseout",function(){e(this).closest("div").find(".jr-more-info").trigger("mouseout")}),n.data!=i&&1==n.data("replace-placeholder")&&n.attr("placeholder",t.__t("USERNAME_CREATE_ACCOUNT")),r.find("input.jr-user-email").val(a.email),r.find("input.jr-user-name, input.jr-user-username, input.jr-user-email").each(function(){var t=e(this).val();""!==t?e(this).prop("disabled",!0):e(this).prop("disabled",!1)})})}),n===!0&&r.trigger("mouseover")},validateUsername:function(e){t.common.validateUserData(e,"username")},validateEmail:function(e){t.common.validateUserData(e,"email")},validateUserData:function(i,a){var n,r,o,s;switch(a){case"username":emailInput="input.jr-email-check",n="input.jr-user-username",o=e('<input class="jr-valid-username" type="hidden" name="data[valid_username]" value="0" />'),s="_validateUsername";break;case"email":r="input.jr-user-username",n="input.jr-email-check",o=e('<input class="jr-valid-email" type="hidden" name="data[valid_email]" value="0" />'),s="_validateEmail"}var d=i.find(n),l=e('<span class="jrSuccess" style="padding:3px 8px;"></span>'),c=e('<span class="jrError" style="padding:3px 8px;"></span>');""!==d.val()&&d.data("default",d.val()),i.off("focusout",n).on("focusout",n,function(){var n=e(this),d={value:n.val()},u=e('<span class="jrLoadingSmall"></span>');o.remove(),l.remove(),c.remove(),n.next("span").remove(),"email"==a&&i.find(r).length&&""==i.find(r).val()||("username"==a&&i.find(emailInput).length&&""!==i.find(emailInput).val()&&i.find(emailInput).trigger("focusout"),""!==n.val()&&""!==n.data("default")&&n.val()!==n.data("default")&&(n.after(u),t.dispatch({method:"get",type:"json",controller:"users",action:s,data:d}).done(function(e){u.remove(),e.success?(n.after(l.html(e.text)),i.append(o.val(1))):(n.after(c.html(e.text)),i.append(o.val(0)))})))})},userAutocomplete:function(i){var a=i.find("input.jr-user-autocomplete"),n={target_userid:"jr-user-id-ac",target_name:"jr-user-name-ac",target_username:"jr-user-username-ac",target_email:"jr-user-email-ac"};if(""===a.val()){var r=i.find("."+n.target_userid).val();if(Number(r)>0){var o=t.dispatch({method:"get",type:"text",controller:"users",action:"_getUsername",data:{id:r}});o.done(function(e){a.val(e)})}}a.autocomplete({source:function(e,i){var n=a.data("cache")||{},r=e.term;if(r in n)return void i(n[r]);var o=t.dispatch({method:"get",type:"json",controller:"users",action:"_getList",data:{q:r}});o.done(function(e){n[r]=e,a.data("cache",n),i(e)})},select:function(e,t){i.find("."+n.target_userid).val(t.item.id),i.find("."+n.target_email).val(t.item.email),i.find("."+n.target_name).val(t.item.name),i.find("."+n.target_username).val(t.item.username)},minLength:2}),e(".ui-autocomplete").addClass("jrAutoComplete")},listingAutocomplete:function(i,a){var n=a.acfield||i.find("input.jr-listing-autocomplete"),r={target_listingid:"jr-listing-id-ac",target_title:"jr-listing-title-ac",target_alias:"jr-listing-alias-ac",target_url:"jr-listing-url-ac",target_cat:"jr-listing-cat-ac",target_type:"jr-listing-type-ac",target_dir:"jr-listing-dir-ac"},o=i.find("."+r.target_listingid).val(),s=i.find("."+r.target_dir).val(),d=i.find("."+r.target_cat).val(),l=i.find("."+r.target_type).val();if(""===n.val()&&Number(o)>0){var c=t.dispatch({frontend:!0,method:"get",type:"json",controller:"listings",action:"_getList",data:{id:o}});c.done(function(e){a.onSelect?a.onSelect(n,e[0]):n.val(e[0].value)})}n.on("blur",function(){""===n.val()&&i.find("."+r.target_listingid+", ."+r.target_title+", ."+r.target_alias+", ."+r.target_url).val("")}).autocomplete({source:function(e,i){var a=n.data("cache")||{},r=e.term;if(r in a)return void i(a[r]);var o=t.dispatch({frontend:!0,method:"get",type:"json",controller:"listings",action:"_getList",data:{search:r,dir:s,cat:d,type:l}});o.done(function(e){a[r]=e,n.data("cache",a),i(e)})},select:function(e,t){i.find("."+r.target_listingid).val(t.item.id),i.find("."+r.target_title).val(t.item.value),i.find("."+r.target_alias).val(t.item.alias),i.find("."+r.target_url).val(t.item.url),a.onSelect&&a.onSelect(n,t)},minLength:2}),e(".ui-autocomplete").addClass("jrAutoComplete")}},t.search={submit_delay:150,submit_delay_enter:600,liveSearch_timer:null,liveSearch_timeout:200,pageUpdateRequest:null,simple:function(){e("form.jr-simple-search").on("click","button.jr-search",function(){e(this).closest("form").attr("action",s2AjaxUri).submit()})},advancedPage:function(){var i=e("#jr-form-adv-search"),a=i.find(".jr-listing-type-outer"),n=e('<div class="jrRoundedPanel" style="text-align:center;"><span class="jrLoadingMedium" style="display:inline;padding:20px;"></span>'+t.__t("LOADING")+"</div>");i.attr("action",s2AjaxUri).on("click","button.jr-search",function(a){a.preventDefault(),e(this).trigger("jrBeforeSearch"),setTimeout(function(){i.submit()},t.search.submit_delay)}),t.search.searchRange(i),i.on("change","select.jr-listing-type,input.jr-listing-type",function(i){i.preventDefault();var r=e(this),o=r.closest("form"),s=r.val(),d=o.find("div.jr-search-fields");return 0===parseInt(s,10)?(d.fadeOut(),!1):(n.insertAfter(a),submittingAction=t.dispatch({method:"get",type:"html",controller:"search",action:"_loadForm",data:{criteria_id:s}}),void submittingAction.done(function(e){d.html(e);var t=d.jreviewsFields({page_setup:!0,referrer:"adv_search"});t?t.done(function(){n.remove(),o.trigger("jrSearchFormLoaded"),d.show(),d.jrApplyFieldOptionLayout()}):n.remove()}))});var r=i.find("input.jr-listing-type").val();r>0&&i.find("input.jr-listing-type").trigger("change")},requestResults:function(a,n,r){return clearTimeout(t.search.liveSearch_timer),""!==e.jrGetSelected()?!1:void(t.search.liveSearch_timer=setTimeout(function(){if(r&&n.html('<div class="jrLoadingMedium"></div>').show(),t.search.loadingResults!==i&&t.search.loadingResults.abort(),a.is("input")&&""==a.val())n.hide();else{var e=a.is("input")?[{name:"data[keywords]",value:a.val()},{name:"data[referrer]",value:"submitListing"}]:a.find(':not([name="data[controller]"],[name="data[action]"])').serializeArray();t.search.loadingResults=t.dispatch({method:"get",controller:"categories",action:"liveSearch",data:e}),t.search.loadingResults.done(function(e){""!=e?n.html(e).show():n.hide()})}},t.search.liveSearch_timeout))},advancedModule:function(){"function"==typeof e().jrFiltersPanel&&e(".jr-list-show-filters").length>0&&e(".jr-filters-module").jrFiltersPanel(),e("form.jr-form-adv-search-module").each(function(){var a,r=e(this),o=r.data("module-id"),s=1==r.data("filters");t.search.searchRange(r),r.attr("action",s2AjaxUri).on("click","button.jr-search",function(i){i.preventDefault(),e(this).trigger("jrBeforeSearch"),setTimeout(function(){r.submit()},t.search.submit_delay)}).find("input[type=text]").on("keydown",function(i){if(13==i.keyCode&&(i.preventDefault(),1!==r.data("live-search"))){e(this).trigger("jrBeforeSearch");var a=e(this).data("jrGeolocation")===!0?t.search.submit_delay_enter:t.search.submit_delay;setTimeout(function(){r.submit()},a)}});try{var d=r.jreviewsFields({page_setup:!0,recallValues:!1,context:{dir:r.find('[name="data[dir]"]').val()||"",cat:r.find('[name="data[categories]"]').val()||"",listing_type:r.find('[name="data[Search][criteria_id"]').val()||""},referrer:s?"filtering":"adv_search_module",autocomplete:1==s?0:1});d.done(function(){s||r.jrApplyFieldOptionLayout()})}catch(l){console.log("JReviews fields.js not loaded")}if(s){r.find("[data-display-as]").not('[name^="data[Field]"]').jrFilterTransformer(),r.find(".jr-filters-reset").on("click",function(e){e.preventDefault(),r.find('[data-display-as]:not([name="data[categories]"],[name="data[Search][criteria_id]"])').jrFilterTransformer("reset"),r.trigger("onAdvancedFiltering")});var c=!0,u=[];r.on("jrListingFieldsLoaded",function(){r.find(':input:not([type="hidden"])').each(function(){e(this).attr("name")!==i&&u.push({name:e(this).attr("name"),value:r.find('[name="'+e(this).attr("name")+'"]').val()})})}),r.on("onAdvancedFiltering",function(o,s){var d=s!==i&&1==s.data("reload")?!0:!1,l=1==r.data("live-search")&&!d&&e(".jr-page.jrListings").length;c&&(c=!1,window.history.replaceState({url:document.location.href,form:{id:r.data("moduleId"),data:u}},null,document.location.href)),l?(r.find('[name="data[order]"]').val(t.search.getSortValue()),n.addClass("jrIsLoading"),e(this).trigger("jrBeforeSearch"),setTimeout(function(){t.search.pageUpdateRequest&&t.search.pageUpdateRequest.abort(),a=r.find(':not([name="data[controller]"],[name="data[action]"])').serializeArray(),t.search.pageUpdateRequest=t.dispatch({method:"get",controller:"categories",action:"liveFilter",data:a}),t.search.pageUpdateRequest.done(function(a){var n=[];r.find(':input:not([type="hidden"])').each(function(){e(this).attr("name")!==i&&n.push({name:e(this).attr("name"),value:r.find('[name="'+e(this).attr("name")+'"]').val()})}),t.pageNav.updatePage(a,{push:!1,scroll:r.data("update-scroll")||0,form:{id:r.data("moduleId"),data:n}})})},t.search.submit_delay)):(e(this).trigger("jrBeforeSearch"),setTimeout(function(){r.submit()},t.search.submit_delay))}),r.find('select,input[type="text"],input[type="number"]').on("change",function(t){var i=e(t.target);i.data("isControlled")===!0&&i.data("isActive")===!1||r.trigger("onAdvancedFiltering",[i])})}else t.search.liveSearch(r,{id:o})})},getSortValue:function(){for(var e=window.location.search.substring(1),t=e.split("&"),i=0;i<t.length;i++){var a=t[i].split("=");if("order"==a[0])return a[1]}},liveSearch:function(a,n){var r=n.id||"";inputs=a.is("input")?a:a.find("input[type=text]"),SelectsRadiosCheckboxes=a.find("select,input[type=radio],input[type=checkbox]"),beforeDiv=null;var o={enabled:1,auto_hide:1,popup:1,display_event:"keyup",show_loading:!0};e.extend(o,a.data("searchSettings")||{});var s=e(e(".jrAdvSearchSuggest.jr-live-search"+r).length?".jrAdvSearchSuggest.jr-live-search"+r:'<div class="jrAdvSearchSuggest jr-live-search'+r+'"></div>');a.on("onLiveSearch",function(){function n(){var e=c.offset(),t=c.outerWidth();e.top+=c.outerHeight()+1,s.css(e),s.css("width",t)}var r=a.data("live-search")!==i?a.data("live-search"):o.enabled,d=a.data("live-search-hide")!==i?a.data("live-search-hide"):o.auto_hide;if(!r)return!1;var l=e(this),c=l.parent();o.popup?s.appendTo("body"):s.insertAfter(a),o.popup&&(n(),window.onresize=n),t.search.requestResults(l,s,o.show_loading),d&&e(document).on("mousedown",function(e){c.is(e.target)||0!==c.has(e.target).length||s.is(e.target)||0!==s.has(e.target).length||s.hide()}),s.on("click",".jr-close-live-results",function(){s.hide()})}),a.is("input")&&a.on("focusin",function(){s.hide()}),inputs.on(o.display_event,function(){a.trigger("onLiveSearch")}),a.on("change",".jr-date",function(){a.trigger("onLiveSearch")}),SelectsRadiosCheckboxes.on("change",function(){a.trigger("onLiveSearch")})},searchRange:function(t){t.on("change","select.jr-search-range",function(){var t=e(this),i=t.parent().find("span").last();"between"==t.val()?i.show():i.hide().find("input").val("")})}},t.popup=function(){e(".jr-more-info").not("jr-ready").jrPopup({className:"jrPopup",delay:150}).addClass("jr-ready")},t.showmore=function(){e(".jr-show-more").not("jr-ready").jrShowMore().addClass("jr-ready")},t.trix=function(){document.addEventListener("trix-file-accept",function(e){e.preventDefault()})},t.formbuilder=function(){a.on("onListingFormLoaded onReviewFormLoaded",function(){try{console.log("Bootstrapping FormBuilder Field"),a.find("[jr-formbuilder]").each(function(){new jreviewsFormBuilder(e(this)).initialize()})}catch(t){console.log("FormBuilder bootstrapping failed.")}})},t.calendar={init:function(){e(".jr-module-calendar").not(".jr-ready").addClass("jr-ready").each(function(){var i=e(this),a=i.find(".jr-module-calendar-container"),n=i.data("options"),r={start_field:n.start_field,end_field:n.end_field,start_date:n.start_date,end_date:n.end_date,hide_past:n.hide_past};moment.locale(t.locale);var o=t.dispatch({method:"get",type:"json",controller:"module_calendar",action:"_getEvents",data:r});o.done(function(o){if(!o.success||!o.results.length)return!1;var s=[];e.each(o.results,function(e,t){s.push("0000-00-00 00:00:00"!==t.Field[n.end_field]?{start:t.Field[r.start_field],end:t.Field[r.end_field],id:t.Listing.id}:{date:t.Field[r.start_field],id:t.Listing.id})});var d=Hogan.compile(e("#jr-module-calendar-template-"+n.module_id).html());a.clndr({events:s,multiDayEvents:{startDate:"start",endDate:"end",singleDay:"date"},ready:function(){parseInt(n.autoload)&&i.find(".today.event").trigger("click")},clickEvents:{click:function(e){e.events.length&&t.calendar.listings(i,n,e.events)}},render:function(e){return d.render(e)},constraints:{startDate:r.start_date,endDate:r.end_date},adjacentDaysChangeMonth:!1,forceSixRows:!1})})})},listings:function(i,a,n){listing_ids=[],e.each(n,function(e,t){listing_ids.push(t.id)}),listing_ids=listing_ids.join(","),params={module_id:Math.floor(1e4*Math.random()),referrer:"calendar",ajax_init:!0,module:{listing_order:a.listing_order,summary:a.summary,summary_words:a.summary_words,show_category:a.show_category,fields:a.fields,editor_rating:a.editor_rating,user_rating:a.user_rating,columns:a.columns,show_numbers:a.show_numbers,tmpl_suffix:a.listings_tmpl_suffix,tn_show:a.tn_show,tn_position:a.tn_position,tn_mode:a.tn_mode,tn_size:a.tn_size,listing:listing_ids,module_total:50,module_limit:50}};var r=t.dispatch({method:"get",type:"html",controller:"module_listings",action:"index",data:params});r.done(function(e){i.find(".jr-module-calendar-listings").html("").append(e)})}}}(jQuery,jreviews),function(e){e.jrGetSelected=function(){var e="";return window.getSelection?e=window.getSelection().toString():document.getSelection?e=document.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),e}}(jQuery),function(e){e.jrDialog=function(t,i){e("div.jr-dialog").dialog("destroy").remove();var a={},n=e('<div class="jr-dialog jrDialogContent jrHidden"></div>');a={title:"",width:"640px",height:"auto",dialogClass:"jrDialog",resizable:!1,modal:!0,autoOpen:!0,position:"center",lightbox:!1},a=e.extend(a,i),1==jreviews.mobi&&(a.maxWidth=a.width,a.width="95%",a.position="center top"),""===e.trim(t)&&(t=jreviews.__t("PROCESS_REQUEST_ERROR"),a.buttons={}),n.html(t),n.dialog(a),1==a.lightbox&&(n.closest(".ui-dialog").find(".ui-dialog-titlebar").remove(),e("body").on("click",function(t){0==e(t.target).closest(".ui-dialog").length&&e("div.jr-dialog").dialog("destroy").remove()
}));var r=e(".ui-dialog-buttonpane");"function"==typeof jQuery().button&&r.find("button").button("destroy"),1==jreviews.mobi&&r.find(".ui-dialog-buttonset").css("float","left");var o=r.find("button:contains("+jreviews.__t("DELETE")+")"),s=r.find("button:contains("+jreviews.__t("SUBMIT")+")"),d=r.find("button:contains("+jreviews.__t("CANCEL")+")");return o.addClass("jr-submit jrButton").prepend('<span class="jrIconDelete"></span>'),s.addClass("jr-submit jrButton").prepend('<span class="jrIconSave"></span>').on("click",function(){e(this).prop("disabled",!0).find("span").removeClass("jrIconSave").addClass("jrButtonSpinner")}),d.addClass("jr-cancel jrButton").prepend('<span class="jrIconCancel"></span>'),n.on("failedValidation",function(){s.prop("disabled",!1).find("span").removeClass("jrButtonSpinner").addClass("jrIconSave")}),n},e.jrAlert=function(t,i){e("div.jr-alert").dialog("destroy").remove();var a=e('<div class="jr-alert">'+t+"</div>"),n={title:"",width:"400px",height:"auto",dialogClass:"jrDialog",resizable:!1,modal:!0,autoOpen:!0,position:"center",buttons:{}};i=e.extend(n,i),i.buttons[jreviews.__t("CLOSE")]=function(){e(this).dialog("close")},1==jreviews.mobi&&(i.maxWidth=i.width,i.width="95%",i.position="center top"),a.dialog(i)}}(jQuery),function(e){e.getCSS=function(t,i){e(document.createElement("link")).attr({href:t,media:i||"screen",type:"text/css",rel:"stylesheet"}).appendTo("head")}}(jQuery),function(e){e.fn.jrScrollTo=function(t,i){var a=e.extend({},e.fn.jrScrollTo.defaults,t),n=e(this).offset().top+a.offset;return e("html,body").animate({scrollTop:n},a.duration,a.easing,i),e(this)},e.fn.jrScrollTo.defaults={offset:-30,duration:1e3,easing:"swing"}}(jQuery),function(e){e.fn.tinyMCE=function(){var t=this,i=1e3;try{setTimeout(function(){if("object"==typeof tinyMCE){if("object"!=typeof tinyMCEPreInit||e.isEmptyObject(tinyMCEPreInit))return"undefined"==typeof WFEditor&&"object"==typeof tinyMCE.settings&&(tinyMCE.settings.height=null),t.each(function(){tinyMCE.execCommand("mceAddEditor",!1,this.id)});var i="mceInit"in tinyMCEPreInit?tinyMCEPreInit.mceInit["jr-editor"]:!1,a="qtInit"in tinyMCEPreInit?tinyMCEPreInit.qtInit["jr-editor"]:!1;e(".jr-wysiwyg-editor").each(function(){var t=e(this).attr("id");if(a){var n=e.extend({},a,{id:t});tinyMCEPreInit.qtInit[t]=n,quicktags(n),QTags._buttonsInit()}if(i){var r=e.extend({},i,{selector:"#"+t});tinyMCEPreInit.mceInit[t]=r,tinyMCE.init(r)}})}},i)}catch(a){console(a)}},e.fn.RemoveTinyMCE=function(){var e=this;try{if("object"==typeof tinyMCE)return e.each(function(){tinyMCE.execCommand("mceRemoveEditor",!0,this.id)})}catch(t){}},e.fn.SaveTinyMCE=function(){var e=this;try{if("object"==typeof tinyMCE)return e.each(function(){tinyMCE.get(this.id).save()})}catch(t){}}}(jQuery),function(e){var t=function(t,i){this.elem=t,this.$elem=e(t),this.options=e.extend({},e.fn.jrShowMore.options,i),this.init()};t.prototype={init:function(){var t=this,i=t.$elem.data("characters"),a=t.$elem.data("separator");void 0!==i&&parseInt(i,10)>0&&(t.options.characters=i),void 0!==a&&(t.options.separator=a),t.elemTextOrig=t.$elem.html().trim(),t.elemText=t.$elem.text().trim(),t.elemLength=t.elemText.length,t.elemLength>t.options.characters+t.options.separator.length&&(t.elemTextMain=t.elemText.substring(0,t.options.characters),t.elemTextMainHTML='<span class="jrShowMain">'+t.elemTextMain+"</span>",t.elemTextSeparatorHTML='<span class="jrShowMoreSeparator">'+t.options.separator+"</span>",t.elemTextMoreHTML='<span class="jrShowMore" style="display: none;">'+t.elemTextOrig+"</span>",t.elemTextMoreLink='<a class="jrShowLink" href="#">'+t.options.showMoreText+"</a>",t.$elem.html(t.elemTextMainHTML+t.elemTextSeparatorHTML+t.elemTextMoreHTML+" "+t.elemTextMoreLink),t.$elem.on("click","a",function(i){i.preventDefault();var a=e(this);a.hasClass("jrShowLink")?a.html(t.options.hideMoreText).removeClass("jrShowLink").addClass("jrHideLink"):a.html(t.options.showMoreText).removeClass("jrHideLink").addClass("jrShowLink"),t.$elem.find(".jrShowMain, .jrShowMoreSeparator, .jrShowMore").toggle()}))}},e.fn.jrShowMore=function(e){return this.each(function(){new t(this,e)})},e.fn.jrShowMore.options={showMoreText:jreviews.__t("SHOW_MORE"),hideMoreText:jreviews.__t("HIDE_MORE"),separator:"...",characters:250}}(jQuery),function(e){var t=function(t,i){this.elem=t,this.$elem=e(t),this.options=e.extend({},e.fn.jrPopup.options,i),this.init()};t.prototype={init:function(){var t=this;t.popupDiv=t.$elem.next("."+t.options.className),t.popupDiv.length&&(""!==e.trim(t.popupDiv.html())||t.popupDiv.hasClass("jr-ajax"))&&(t.$popupDiv=e(t.popupDiv),t.$elem.hover(function(){t.show()},function(){t.hide()}),t.$elem.click(function(){t.hide()}),t.$popupDiv.hover(function(){t.show()},function(){t.hide()}))},show:function(){var e=this;e.options.onBeforeShow&&e.options.onBeforeShow();var t=e.getPosition();e.$popupDiv.stop(!0,!0),e.clearTimeouts(),e.showTimeout=setTimeout(function(){e.$popupDiv.appendTo("body").css({top:t.top,left:t.left}),e.$popupDiv.fadeIn(100)},300)},hide:function(){var t=this;t.clearTimeouts(),t.showTimeout=setTimeout(function(){e(t.popupDiv).fadeOut(100,function(){t.$elem.after(e(this))})},t.options.delay)},clearTimeouts:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0),this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0)},getPosition:function(){{var e=this.$elem.offset().top,t=this.$elem.offset().left,i=this.$elem.outerWidth();this.$elem.outerHeight()}return{left:t+i/2-this.$popupDiv.outerWidth()/2+"px",top:e-this.$popupDiv.outerHeight()-20+"px"}}},e.fn.jrPopup=function(e){return this.each(function(){new t(this,e)})},e.fn.jrPopup.options={className:"jrPopup",delay:300}}(jQuery),function(e){var t=function(e){if("string"!=typeof e)throw"sprintf: The first arguments need to be a valid format string.";for(var t=new RegExp(/%(\+)?([0 ]|'(.))?(-)?([0-9]+)?(\.([0-9]+))?([%bcdfosxX])/g),i=[],a=1;part=t.exec(e);){if(a>=arguments.length)throw"sprintf: At least one argument was missing.";i[i.length]={begin:part.index,end:part.index+part[0].length,sign:"+"==part[1],negative:parseInt(arguments[a])<0?!0:!1,padding:void 0==part[2]?" ":"'"==part[2].substring(0,1)?part[3]:part[2],alignLeft:"-"==part[4],width:void 0!=part[5]?part[5]:!1,precision:void 0!=part[7]?part[7]:!1,type:part[8],data:"%"!=part[8]?String(arguments[a++]):!1}}for(var n="",r=0,o=0;o<i.length;++o){n+=e.substring(r,i[o].begin),r=i[o].end;var s="";switch(i[o].type){case"%":s="%";break;case"b":s=Math.abs(parseInt(i[o].data)).toString(2);break;case"c":s=String.fromCharCode(Math.abs(parseInt(i[o].data)));break;case"d":s=String(Math.abs(parseInt(i[o].data)));break;case"f":s=0==i[o].precision?String(Math.abs(parseFloat(i[o].data))):Math.abs(parseFloat(i[o].data)).toFixed(i[o].precision);break;case"o":s=Math.abs(parseInt(i[o].data)).toString(8);break;case"s":s=i[o].data.substring(0,i[o].precision?i[o].precision:i[o].data.length);break;case"x":s=Math.abs(parseInt(i[o].data)).toString(16).toLowerCase();break;case"X":s=Math.abs(parseInt(i[o].data)).toString(16).toUpperCase();break;default:throw'sprintf: Unknown type "'+i[o].type+'" detected. This should never happen. Maybe the regex is wrong.'}if("%"!=i[o].type){if(0!=i[o].width&&i[o].width>s.length)for(var d=s.length,l=0;l<i[o].width-d;++l)s=1==i[o].alignLeft?s+i[o].padding:i[o].padding+s;("b"==i[o].type||"d"==i[o].type||"o"==i[o].type||"f"==i[o].type||"x"==i[o].type||"X"==i[o].type)&&(1==i[o].negative?s="-"+s:1==i[o].sign&&(s="+"+s)),n+=s}else n+=s}return n+=e.substring(r,e.length)};e.sprintf=t,String.prototype.printf=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(String(this)),t.apply(void 0,e)}}(window),function(e){e.widget("jreviews.buttongroup",{buttons:{},classes:{buttonGroup:"jrButtonGroup",button:"jrButton",selected:"jrBlue"},_create:function(){var t=this,i=t.element,a=t.classes;i.hide();var n=e('<div class="'+a.buttonGroup+'">');i.find("option").each(function(r){var o=e(this),s=e('<div class="'+a.button+'">').html(o.text()).data("index",r),d=o.data("icon");d&&s.prepend('<span class="'+d+'">'),s.on("click",function(){i.find("option:eq("+e(this).data("index")+")").prop("selected",!0),o.trigger("change")}),t.buttons[r]=s,""!==o.val()&&n.append(s)}),i.on("change",function(){n.find("."+a.button).removeClass(a.selected),t.buttons[i.find("option:selected").index()].addClass(a.selected)}),n.insertBefore(i)},_init:function(){var e=this,t=e.element;t.trigger("change")},destroy:function(){e.Widget.prototype.destroy.call(this)}})}(jQuery);