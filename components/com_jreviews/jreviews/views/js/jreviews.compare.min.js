!function(e){jreviewsCompare={numberOfListingsPerPage:3,maxNumberOfListings:15,compareURL:"index.php?option=com_jreviews&url=categories/compare/id:listing_ids/",lang:{compare_heading:jreviews.__t("COMPARE_HEADING"),compare_all:jreviews.__t("COMPARE_COMPARE_ALL"),remove_all:jreviews.__t("COMPARE_REMOVE_ALL"),select_more:jreviews.__t("COMPARE_SELECT_MORE"),select_max:jreviews.__t("COMPARE_SELECT_MAX")},listingTypeID:null,init:function(){jreviewsCompare.set({numberOfListingsPerPage:jreviews.comparison.numberOfListingsPerPage,maxNumberOfListings:jreviews.comparison.maxNumberOfListings,compareURL:jreviews.comparison.compareURL}),jreviewsCompare.initComparePage(),jreviewsCompare.initCompareDashboard(),jreviewsCompare.initListingsSelection(),e(document).on("jreviews-onAfterAjaxUpdate",function(e,i){jreviewsCompare.refresh(i)})},refresh:function(i){var r=e(".jrCompareTabs");r.data("ui-tabs")&&r.find("ul.jrTabsNav li a").each(function(){var r=e(this),t=r.attr("href"),a=t.substring(t.indexOf("#"));r.attr("href",i+a)})},set:function(i){void 0!==i&&e.extend(jreviewsCompare,i)},initComparePage:function(){var i,r,t=e(".jr-compareview"),a=e(".jr-compare-slider"),s=a.find(".jr-compare-slider-items"),o=e(".jr-compare-slider-secondary"),n=o.find(".jr-compare-slider-items2"),l=s.find(".jr-compare-slider-item"),p=e(".jrScrollbarArea"),m=e(".jr-compare-slider-item").length;t.width(t.parent().width()),i=m>=jreviewsCompare.numberOfListingsPerPage?a.width()/jreviewsCompare.numberOfListingsPerPage:a.width()/m,r=i*m,l.width(i),s.width(r),n.width(r),a.scroll(function(){o.scrollLeft(a.scrollLeft())}),o.scroll(function(){a.scrollLeft(o.scrollLeft())}),m>jreviewsCompare.numberOfListingsPerPage&&(p.removeClass("jrHidden"),a.removeClass("jrSliderDisabled"),o.removeClass("jrSliderDisabled"),t.hasClass("jrCompareViewMenu")||e(".removeComparedListing").removeClass("jrHidden"),a.find(".jr-compare-slider-item").hover(function(){{var r=e(this),t=r.data("listingid");r.width()}r.on("click","img.removeListing",function(){r.fadeOut("slow",function(){r.remove();var l=i*e("div.jr-compare-slider-item").length,m=e(".jr-compare-slider-item").length;s.width(l),n.width(l),m<=jreviewsCompare.numberOfListingsPerPage&&(p.addClass("jrHidden"),a.addClass("jrSliderDisabled"),o.addClass("jrSliderDisabled"),a.find(".removeComparedListing").addClass("jrHidden")),e("span#removelisting"+t).trigger("click")})})})),jreviewsCompare.fixCompareAlignment()},fixCompareAlignment:function(){function i(i){tallest=0,i.each(function(){thisHeight=e(this).height(),thisHeight>tallest&&(tallest=thisHeight)}),i.height(tallest)}function r(r){r.each(function(){var r=e(this).attr("class").split(" ").slice(0,1);i(e("div."+r))})}var t=e("div.jr-compare-slider-item div.jrCompareField");r(t)},initCompareDashboard:function(){e("body").append('<div class="jrCompareDashboard"><div class="jrCompareHeader"><div class="jrCompareArrow"></div></div><div class="jrCompareTabs"></div></div>'),e(".jrCompareTabs").append('<div class="jrCompareTitle">'+jreviewsCompare.lang.compare_heading+'</div><ul class="jrTabsNav"></ul><div class="jrTabsContainer"></div>'),e(".jrCompareHeader, .jrCompareTitle, ul.jrTabsNav").hover(function(){e(this).css("cursor","pointer")}).click(function(){e(".jrCompareTabs .jrTabsContainer").slideToggle("slow",function(){var i=e(".jrCompareArrow");e(this).is(":visible")?i.addClass("down"):i.removeClass("down")})});var i=e(".jrCompareDashboard"),r=jreviewsCompare.getListingsFromStorage();e.isEmptyObject(r)||(i.slideDown("slow"),e.each(r,function(i){var t=!1,a=i.substring(11);e.each(r[i],function(e,i){t||(jreviewsCompare.insertTab(i),t=!0),jreviewsCompare.insertListingIntoComparison(i),jreviewsCompare.updateCompareAllUrl(i)}),e("#tabLT"+a+" li.ltItem").length>4&&e("#tabLT"+a+" a.compareNext").css("visibility","visible")})),i.on("click","span.removeItem",function(){var i=e(this).attr("id"),r={id:i.substring(13),typeId:e(this).text()};e("input.listing"+r.id).prop("checked",!1),jreviewsCompare.removeListingFromComparison(r)}),i.on("click","a.removeListings",function(i){i.preventDefault();var r=e(this).parent().attr("id"),t=r.substring(9),a=e("#tabLT"+t+" li.ltItem:first-child span.removeItem").attr("id").substring(13),s={id:a,typeId:t},o=e('.jrCheckListing[data-listingtypeid="'+t+'"]');o.prop("checked",!1),jreviewsCompare.removeTab(s)}),i.on("click","a.compareListings",function(i){i.preventDefault();var r=e(this).parent().attr("id").substring(9),t=e("div#tabLT"+r+" ul.ltList li").length;if(2>t)""!==e("p.comparisonMessage."+r).val()&&(e("div#tabLT"+r).append('<p class="comparisonMessage '+r+' jrPopup">'+jreviewsCompare.lang.select_more+"</p>"),e("p.comparisonMessage").hide().fadeIn("slow",function(){setTimeout(function(){e("p.comparisonMessage").fadeOut("slow",function(){e(this).remove()})},3e3)}));else{var a=e(this).attr("href");window.location.href=a}}),e("ul.jrTabsNav").on("click","a",function(i){i.stopPropagation();var r=e(".jrTabsContainer");r.is(":hidden")&&r.slideDown("slow")})},insertTab:function(i){var r=i.typeId,t=i.typeTitle,a=e(".jrCompareTabs");a.data("ui-tabs")&&a.tabs("destroy"),e(".jrCompareTabs ul.jrTabsNav").append('<li><a href="#tabLT'+r+'" class="listingTypeCompare jrCompare'+r+'">'+t+' <span class="numSelected">(0)</span></a></li>'),e(".jrCompareTabs .jrTabsContainer").append('<div id="tabLT'+r+'" class="ui-helper-clearfix"><div class="jrCompareScroll"><ul class="ltList"></ul></div></div>'),compareURL=jreviewsCompare.compareURL.replace("listing_ids",i.id);var s='<a rel="nofollow" href="'+compareURL+'" class="compareListings jrButton jrSmall listingType'+r+'"><span class="jrIconCompare"></span>'+jreviewsCompare.lang.compare_all+"</a>",o='<a href="#" class="removeListings jrButton jrSmall listingType'+r+'"><span class="jrIconRemove"></span>'+jreviewsCompare.lang.remove_all+"</a>";e(".jrTabsContainer #tabLT"+r).append('<div id="jrCompare'+r+'" class="jrCompareButtons">'+s+o+"</div>");var n=e(".jrCompareTabs ul.jrTabsNav li").length,l=e("base").attr("href");void 0!==l&&l.length&&a.find('ul.jrTabsNav li a:not(".jrBaseUpdated")').each(function(){e(this).addClass("jrBaseUpdated").attr("href",e(location).attr("href")+e(this).attr("href"))}),a.tabs({selected:n-1})},removeTab:function(i){var r=e(".jrCompareDashboard"),t=e(".jrCompareTabs"),a=t.tabs("option","selected"),s=t.tabs("length");s>1?(e("ul.jrTabsNav li.ui-tabs-active").fadeOut("slow",function(){t.tabs("remove",a)}),t.tabs("destroy"),t.tabs(a>0?{selected:a-1}:{selected:0})):r.slideUp("slow",function(){t.tabs("remove",a),t.tabs("destroy")}),jreviewsCompare.removeListingTypeFromStorage(i)},insertListingIntoComparison:function(i){i.thumb=i.thumbSrc.length?'<div class="compareThumb"><a href="'+i.url+'"><img src="'+i.thumbSrc+'" /></a></div>':"",i.titleUrl='<a href="'+i.url+'">'+i.title+"</a>",e("div#tabLT"+i.typeId+" ul").append('<li id="listing'+i.id+'" class="ltItem"><span id="removelisting'+i.id+'" data-jricon="&#xe018;" class="removeItem">'+i.typeId+"</span>"+i.thumb+'<span class="compareItemTitle">'+i.titleUrl+"</span></li>"),e("input.listing"+i.id).prop("checked",!0);var r=jreviewsCompare.getNumberOfSelectedListings(i.typeId);r++,e(".jrCompareTabs a.jrCompare"+i.typeId+" span.numSelected").html("("+r+")")},removeListingFromComparison:function(i){e(".jrCompareTabs");e("li#listing"+i.id).siblings().length>0?(e("li#listing"+i.id).fadeOut("slow",function(){e(this).remove()}),jreviewsCompare.updateNumberOfSelectedListings(i.typeId,-1),jreviewsCompare.removeListingFromStorage(i),jreviewsCompare.updateCompareAllUrl(i)):jreviewsCompare.removeTab(i)},initListingsSelection:function(){e("body").on("click","input.jrCheckListing",function(){var i={id:e(this).attr("value"),title:e(this).data("listingtitle"),url:e(this).data("listingurl"),thumbSrc:e(this).data("thumburl"),typeId:e(this).data("listingtypeid"),typeTitle:e(this).data("listingtypetitle"),location:e(this).data("location")};i.thumbSrc.length?i.thumb='<div class="compareThumb"><a href="'+i.url+'"><img src="'+i.thumbSrc+'" /></a></div>':(thumb=e("img[data-listingid='"+i.id+"']"),thumb.length?(thumbSrc=thumb.attr("src"),i.thumbSrc=thumbSrc,i.thumb='<div class="compareThumb"><a href="'+i.url+'"><img src="'+thumbSrc+'" /></a></div>'):i.thumb=""),i.titleUrl='<a href="'+i.url+'">'+i.title+"</a>",i.data='<li id="listing'+i.id+'" class="ltItem">'+i.thumb+'<span class="compareItemTitle">'+i.titleUrl+'</span><span id="removelisting'+i.id+'" data-jricon="&#xe018;" class="removeItem">'+i.typeId+"</span></li>";var r,t=e(".jrCompareDashboard"),a=e(".jrCompareTabs"),s=e(".jrTabsContainer"),o=e(".jrCompareArrow");if(e(this).is(":checked")){if(r=e("input.listing"+i.id+":not(:checked)"),e.each(r,function(){e(this).prop("checked",!0)}),e("div#tabLT"+i.typeId).length>0){s.is(":hidden")&&(s.slideDown("slow"),o.addClass("down"));var n=jreviewsCompare.getNumberOfSelectedListings(i.typeId);if(n>=jreviewsCompare.maxNumberOfListings)return""!==e("p.comparisonMessageMax."+i.id).val()&&(e(this).parent().append('<p class="comparisonMessageMax '+i.id+' jrPopup">'+jreviewsCompare.lang.select_max+"</p>"),e("p.comparisonMessageMax").hide().fadeIn("slow",function(){setTimeout(function(){e("p.comparisonMessageMax").fadeOut("slow",function(){e(this).remove()})},3e3)})),!1;e(i.data).appendTo("div#tabLT"+i.typeId+" ul.ltList").hide().fadeIn("slow"),a.tabs("select","#tabLT"+i.typeId)}else s.is(":hidden")&&(s.show(),o.addClass("down")),jreviewsCompare.insertTab(i),e(i.data).appendTo("div#tabLT"+i.typeId+" ul.ltList").hide().fadeIn("slow"),t.is(":hidden")&&t.slideDown("slow");jreviewsCompare.updateNumberOfSelectedListings(i.typeId,1),jreviewsCompare.saveListingToStorage(i),jreviewsCompare.updateCompareAllUrl(i)}else r=e("input.listing"+i.id+":checked"),e.each(r,function(){e(this).prop("checked",!1)}),a.tabs("select","#tabLT"+i.typeId),jreviewsCompare.removeListingFromComparison(i)})},getNumberOfSelectedListings:function(i){var r=e(".jrCompareTabs a.jrCompare"+i+" span.numSelected").html().slice(1,-1);return parseInt(r,10)},updateNumberOfSelectedListings:function(i,r){var t=jreviewsCompare.getNumberOfSelectedListings(i);t+=r,e(".jrCompareTabs a.jrCompare"+i+" span.numSelected").html("("+t+")")},updateCompareAllUrl:function(i){var r=e("a.compareListings.listingType"+i.typeId),t=(r.attr("href"),jreviewsCompare.getListingsFromStorage(i.typeId)),a=[];e.each(t,function(e,i){a.push(i.id)}),a=a.toString();var s=jreviewsCompare.compareURL.replace("listing_ids",a);r.attr("href",s)},saveListingToStorage:function(i){var r=i.typeId,t=i.id,a={};a["listingType"+r]={},a["listingType"+r]["listing"+t]=i;var s=jreviewsCompare.getListingsFromStorage();if(e.isEmptyObject(s))localStorage.setItem("jrCompare",JSON.stringify(a));else{var o=e.extend({},s);o["listingType"+r]=e.extend({},o["listingType"+r],a["listingType"+r]),localStorage.setItem("jrCompare",JSON.stringify(o))}},getListingsFromStorage:function(e){var i={},r="";return r=localStorage.getItem("jrCompare"),""!==r&&"{}"!==r&&(i=JSON.parse(r),void 0!==e&&(i=i["listingType"+e])),i},removeListingFromStorage:function(e){var i=jreviewsCompare.getListingsFromStorage();delete i["listingType"+e.typeId]["listing"+e.id],localStorage.setItem("jrCompare",JSON.stringify(i))},removeListingTypeFromStorage:function(e){var i=jreviewsCompare.getListingsFromStorage();delete i["listingType"+e.typeId],localStorage.setItem("jrCompare",JSON.stringify(i))}}}(jQuery);