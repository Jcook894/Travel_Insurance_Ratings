function clearSelect(e){var t=document.getElementById(e),a=t.length;for(i=0;a>i;i++)t.options[i].selected=""}var jreviews=jreviews||{},jrPage,jrAdmin;jreviews.admin=!0,function(e){e(document).ajaxSend(function(){e("div.jr-page-spinner").show()}).ajaxComplete(function(){e("div.jr-page-spinner").fadeOut()}).ajaxStop(function(){jreviews.addOnloadAjax("selectwidget",jreviews.selectwidget),jreviews.addOnloadAjax("datepicker",jreviews.datepicker),jreviews.addOnloadAjax("images",jreviews.page.loadImages),jreviews.addOnloadAjax("group-location",jreviews.group.changeLocation),jreviews.addOnloadAjax("installer-addon-upload",jreviews.installer.upload),e.each(jreviews._onloadFnAjax,function(e,t){void 0!==t&&t()})}),jreviews.apply=!1,jreviews=e.extend(jreviews,{lang:jreviews.lang||{},_onloadFn:[],_onloadFnAjax:[],_onloadFnKeys:[],_onloadFnAjaxKeys:[]}),jreviews.addOnload=function(t,i){-1===e.inArray(t,jreviews._onloadFnKeys)&&(jreviews._onloadFn.push(i),jreviews._onloadFnKeys.push(t))},jreviews.addOnloadAjax=function(t,i){-1===e.inArray(t,jreviews._onloadFnAjaxKeys)&&(jreviews._onloadFnAjax.push(i),jreviews._onloadFnAjaxKeys.push(t))},jreviews.onload=function(){jreviews.addOnload("trial-expires",jreviews.trialCountdown),jreviews.addOnload("stats",jreviews.stats),jreviews.addOnload("news-feed",jreviews.newsFeed),jreviews.addOnload("version-check",jreviews.versionCheck),jreviews.addOnload("menus",jreviews.menu.init),jreviews.addOnload("license",jreviews.license.init),jreviews.addOnload("installer",jreviews.installer.init),jreviews.addOnload("datepicker",jreviews.datepicker),jreviews.addOnload("popup",jreviews.popup),jreviews.addOnload("tabs",jreviews.tabs),jreviews.addOnload("form-checkall",jreviews.tools.checkAll),jreviews.addOnload("open-site-url",jreviews.openSiteUrl),jreviews.addOnload("image-delayed",jreviews.imageDelayed),jreviews.addOnload("about",jreviews.about.init),jreviews.addOnload("moderation",jreviews.moderation.init),jreviews.addOnload("listing-browse",jreviews.listing.browse),jreviews.addOnload("review-browse",jreviews.review.browse),jreviews.addOnload("media-browse",jreviews.media.browse),jreviews.addOnload("media-submit",jreviews.media.init),jreviews.addOnload("moderation",jreviews.moderation.init),jreviews.addOnload("configuration",jreviews.config.init),jreviews.addOnload("group",jreviews.group.init),jreviews.addOnload("field",jreviews.field.init),jreviews.addOnload("listing-type",jreviews.listing_type.init),jreviews.addOnload("theme",jreviews.theme.init),jreviews.addOnload("page-init",jreviews.page.init),e.each(jreviews._onloadFn,function(e,t){void 0!==t&&t()})},head.ready(function(){jrPage=e("div.jr-page"),jrAdmin=e("#jr-admin"),e(".subhead-collapse").hide();var t=e("#toolbar-options button");t.length&&jrAdmin.find(".jr-admin-acl").show().on("click",function(){t.trigger("click")}),jreviews.onload()}),jreviews.__t=function(t,i){var a={add_ul:!0};if(i=e.extend(a,i),"string"==typeof t)return jreviews.lang[t]||t;var n=[];return e.each(t,function(e,t){var i,a;"string"==typeof t?i=jreviews.lang[t]||t:(a=jreviews.lang[t.shift()],t.unshift(a),i=window.sprintf.apply(null,t)),n.push("<li>"+i+"</li>")}),i.add_ul?"<ul>"+n.join("")+"</ul>":n.join("")},jreviews.dispatch=function(t){t=t||{};var i=void 0!==t.form_id||void 0!==t.form?"POST":"GET";void 0!==t.method&&(i=t.method);var a=void 0!==t.controller?e.param({"data[controller]":t.controller,"data[action]":t.action}):"",n=(t.type||"json",s2AjaxUri);if(t.frontend&&(n=n.replace(/administrator\//,"",n),n=n.replace(/&side=admin/,"",n)),void 0!==t.form_id||void 0!==t.form){var r=t.form||e("#"+t.form_id);void 0!==t.controller&&r.find("input[name=data\\[controller\\]], input[name=data\\[action\\]]").remove(),a=r.serialize()+"&"+a}return t.data&&(a=a+"&"+e.param(t.data)),e.ajax({type:i,url:n,data:a,dataType:t.type})},jreviews.versionCheck=function(){var t=jreviews.dispatch({method:"get",controller:"admin/common",action:"getVersion"});t.done(function(t){if(t.isNew){var i=e('<button class="jrButton jrGreen">'+jreviews.__t("NEW_VERSION_AVAILABLE")+"</a>");i.on("click",function(e){e.preventDefault(),jreviews.menu.load("admin_updater","index")}),e("#jr-version").html(i).fadeIn()}})},jreviews.openSiteUrl=function(){jrPage.on("click","a.jr-site-url, button.jr-site-url",function(t){t.preventDefault();var i=e(this),a=i.data("ids"),n=jreviews.dispatch({method:"get",type:"text",controller:"admin/admin_reports",action:"_getSiteUrl",data:a});n.done(function(e){if(""!==e){var t=window.open(e,"siteWindow","width=800,height=640");"object"==typeof t&&t.focus()}})})},jreviews.imageDelayed=function(){jrPage.find("img").attr("src",e(this).data("src"))},jreviews.selectwidget=function(){console.log("Initializing selec2 widgets"),jrPage.find(".jr-select-widget").each(function(){var t=e(this);if(t.attr("multiple"))t.select2({width:"80%"});else{var i={},a=t.data("width");a&&(i.width=a),t.select2(i)}})},jreviews.datepicker=function(){if(e().datepicker){try{jreviews.datepickerClear()}catch(t){}e.datepicker.setDefaults({showOn:"both",buttonImage:jreviews.calendar_img,showButtonPanel:!0,buttonImageOnly:!0,buttonText:"Calendar",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),e('.jr-date:not(".jr_ready")').addClass("jr-ready").each(function(){e(this).datepicker({yearRange:e(this).data("yearrange"),minDate:e(this).data("mindate"),maxDate:e(this).data("maxdate")})})}},jreviews.datepickerClear=function(){var t=e.datepicker._updateDatepicker;e.datepicker._updateDatepicker=function(i){t.call(this,i);var a=e(this).datepicker("widget").find(".ui-datepicker-buttonpane");0===a.find(".clearDate").length&&e("<button class='clearDate' type='button' class='ui-datepicker-clean ui-state-default ui-priority-primary ui-corner-all'>"+jreviews.__t("CLEAR_DATE")+"</button>").appendTo(a).click(function(){e.datepicker._clearDate(i.input)})}},jreviews.newsFeed=function(){var e=jrPage.find("div#jr-news-feed");if(e.length){var t=e.find("#news-spinner"),i=jreviews.dispatch({method:"get",type:"html",controller:"admin/common",action:"feed"});i.done(function(i){t.hide(),e.find("#news-content").html(i).slideDown("slow")})}},jreviews.trialCountdown=function(){function t(e){var t=parseInt(e,10)-Date.parse(new Date),i=Math.floor(t/1e3%60),a=Math.floor(t/1e3/60%60),n=Math.floor(t/36e5%24),r=Math.floor(t/864e5);return{total:t,days:r,hours:n,minutes:a,seconds:i}}function i(e,i){var a=setInterval(function(){var n=t(i);e.find(".days").html(n.days),e.find(".hours").html(n.hours),e.find(".minutes").html(n.minutes),n.total<=0&&clearInterval(a)},1e3)}var a=e("#jr-trial"),n=a.data("expires");a.length&&i(a,n)},jreviews.stats=function(){var t=jreviews.dispatch({method:"get",type:"json",controller:"admin/common",action:"getStats"});t.done(function(t){e.each(t,function(e,t){jrPage.find(".jr-stats-"+e).html(t)}),jrPage.find('span[class^="jr-stats-"]').fadeIn()})},jreviews.search={resultsPanel:e('<div class="jrSearchResultsPanel">'),overlay:e('<div class="jrSearchResultsOverlay">'),searchInput:e("input[name=data\\[search_term\\]]"),searching:void 0,init:function(){function t(t){return""!=t.val()?(jreviews.search.searching=jreviews.dispatch({type:"html",method:"post",controller:"admin/admin_search",action:"liveSearch",data:{term:t.val()}}),jreviews.search.searching.done(function(t){if(""!=t){var i=e(".jrAdminContentWrapper");jreviews.search.overlay.prependTo(i).show(),jreviews.search.resultsPanel.html(t).find(".jrTabsVertical").tabs(),jreviews.search.resultsPanel.find('[name="type_id"]').on("change",function(){var t=jreviews.search.resultsPanel.find("#tabs-overrides a");""!=e(this).val()?t.removeClass("jrDisabled"):t.addClass("jrDisabled")}),jreviews.search.resultsPanel.prependTo(i).show(),jreviews.search.resultsPanel.find("a.jrSetting").on("click",function(){var t=e(this),a=t.data("override"),n=t.data("url").split("/");if(a){var r=e(jreviews.search.resultsPanel).find('[name="type_id"]').val();jreviews.menu.load("listing_types","index").done(function(i){var a=e(i).find(".jr-edit").filter('[data-id="'+r+'"]');jreviews.search.resultsPanel.hide(),jreviews.listing_type.edit(a,jrPage).done(function(){jreviews.search.inputFocus(jrPage,t.data("name")),jreviews.search.overlay.hide()})})}else jreviews.menu.load(n[0],n[1]).done(function(){jreviews.search.resultsPanel.hide(),jreviews.search.overlay.hide(),jreviews.search.inputFocus(i,t.data("name"))})})}})):void 0}var i=function(){var e=0;return function(t,i){clearTimeout(e),e=setTimeout(t,i)}}();jreviews.search.searchInput.on("click focus",function(){"undefined"!=typeof jreviews.search.searching&&jreviews.search.searching.abort(),""!=e(this).val()&&jrAdmin.find(jreviews.search.resultsPanel.length)?(jreviews.search.overlay.show(),jreviews.search.resultsPanel.show()):jreviews.search.searching=t(e(this))}).on("keyup",function(){var a=e(this);"undefined"!=typeof jreviews.search.searching&&jreviews.search.searching.abort(),""==a.val()?(jreviews.search.resultsPanel.hide(),jreviews.search.overlay.hide()):i(function(){jreviews.search.searching=t(a)},350)}),e(document).mouseup(function(e){jreviews.search.searchInput.is(e.target)||jreviews.search.resultsPanel.is(e.target)||0!==jreviews.search.resultsPanel.has(e.target).length||(jreviews.search.resultsPanel.hide(),jreviews.search.overlay.hide())})},inputFocus:function(t,i){var a=t.find('[data-setting-name="'+i+'"]'),n=[];jreviews.search.tabFocus(t,a,n),e.each(n.reverse(),function(e,t){console.log(t),t.element.tabs("option","active",t.index)}),a.length&&a.jrScrollTo({offset:-200,duration:500}).effect("highlight",{},5e3)},tabFocus:function(e,t,i){var a=t.parent().closest(".jr-tabs");if(a.length){var n=t.closest(".jrTabPanel"),r=n.eq(0).attr("id"),o=jrPage.find('[href="#'+r+'"]'),s=a.find(".ui-tabs-anchor").index(o);i.push({element:a,index:s}),jreviews.search.tabFocus(e,a,i)}}},jreviews.page={init:function(){function t(e,t){var i,a=e.find(".jr-title"),n=a.closest("form"),r=a.data("slug"),o=a.data("slugNumbers"),s=a.data("slugAlpha"),d=void 0!==a.data("slugSpace")?a.data("slugSpace"):"-",l=t.val(),c=n.find("."+r);r&&c.length&&""!==l&&(i=jreviews.tools.slug(l,{numbers:o,alpha:s,spaceReplaceChar:d}),c.val(i))}var i=jrPage;e(window).keydown(function(t){if(13===t.keyCode){var i=e(t.target).prop("type");return"textarea"==i||void 0===i?!0:(t.preventDefault(),e(t.target).trigger("blur"),!1)}}),jreviews.search.init(),jreviews.page.pageNav(i),i.on("click","a.jr-insert-ip",function(){e(this).prev("span").find("input").val(jreviews.ipaddress)}),i.on("click","img.jr-edit, a.jr-edit, div.jr-edit, button.jr-edit",function(t){t.preventDefault();var a=e(this),n=a.closest("form"),r=n.data("object-type"),o=a.data("object-type");o&&(r=o),jreviews[r].edit(e(this),i)}),i.on("click","button.jr-save-settings",function(t){t.preventDefault();var a=e(this),n=a.closest("form"),r=jreviews.dispatch({type:"html",form:n});r.done(function(e){""!==e?i.html(e).promise().done(function(){jreviews.tools.statusUpdate(jreviews.__t("SETTINGS_SAVED"))}):jreviews.tools.statusUpdate(jreviews.__t("SETTINGS_SAVED"))})}),i.on("click","button.jr-cancel",function(t){t.preventDefault();var a=i.children("div").eq(0),n=jreviews.getController(a,!0),r=jrAdmin.data("prevPage."+n);a.find(".jr-wysiwyg-editor").RemoveTinyMCE(),r.insertBefore(a).fadeIn("fast"),a.remove(),e.removeData(jrAdmin,"prevPage."+n)}),i.on("click","button.jr-publish",function(t){t.preventDefault(),jreviews.page.publish(e(this))}),i.on("click",".jr-toggle",function(t){t.preventDefault(),jreviews.page.toggle(e(this))}),i.on("click","form#jr-page-form button.jr-delete",function(t){t.preventDefault();var a=e(this),n=a.closest(".jr-layout-outer");i.find(".jr-row-cb").prop("checked",!1),n.find(".jr-row-cb").prop("checked",!0),jreviews.page.del(e(this),i)}),i.on("click","form#jr-page-form button.jr-delete-all",function(t){t.preventDefault(),jreviews.page.del(e(this),i)}),i.on("click","div.jr-moderation button.jr-delete-moderation",function(t){t.preventDefault(),jreviews.moderation.delModeration(e(this))}),i.on("click","a.jr-reorder",function(t){t.preventDefault(),jreviews.page.reorder(e(this),i)}),i.on("update","div.jr-layout-outer",function(t){t.preventDefault(),jreviews.page.update(e(this))}),i.on("click","a.jr-popup-window",function(t){t.preventDefault(),e(this).popUpWindow()}),i.on("click",".jr-preview",function(t){t.preventDefault();var i=e(this),a=i.closest(".jr-layout-outer"),n=a.find(".jr-title a").html()||a.find(".jr-title").html()||"",r=a.find(".jr-preview-html").html(),o={};e.jrDialog(r,{buttons:o,title:n,width:640,height:480})}),i.on("blur","input.jr-title",function(){var t,i=e(this),a=i.closest("form"),n=i.data("slug"),r=i.data("slugNumbers"),o=i.data("slugAlpha"),s=void 0!==i.data("slugSpace")?i.data("slugSpace"):"-",d=i.val(),l=a.find("."+n);if(n&&l.length&&""!==d&&""===l.val()){var c=l.attr("maxlength");t=jreviews.tools.slug(d,{numbers:r,alpha:o,spaceReplaceChar:s}),void 0!==c&&c>0&&(t=t.substring(0,c)),l.val(t)}}),i.on("blur",'input.jr-name:not("[readonly]")',function(){t(i,e(this))}),e("body").on("blur",'div.jr-dialog .jr-name:not("[readonly]")',function(){t(e("div.jr-dialog"),e(this))}),i.on("mousemove",'form:not(".jr-ready-control-field")',function(){jreviews.field.control_setup(e(this)),e(this).addClass("jr-ready-control-field")}),i.on("click","a.jr-edit-inplace",function(t){t.preventDefault(),jreviews.page.editInPlace(e(this),i)}),i.on("change blur",".jr-categories-seo input,.jr-categories-seo textarea",function(t){t.preventDefault();{var i=e(this),a=i.parents(".jr-layout-outer"),n=a.find("input,textarea").serializeArray();jreviews.dispatch({method:"post",controller:"admin/categories",action:"_saveSeo",data:n})}}),i.on("mousemove","div.jr-sortable div.jr-layout-outer",function(){var t=e("div.jr-sortable"),a=e(this).data("group"),n=t.find('[data-group="'+a+'"]').first().data("order");t.data("min_order",n),t.sortable({axis:"y",items:'[data-group="'+a+'"]',containment:"parent",handle:".jr-sort-handle",cursor:"move",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,stop:function(r,o){var s=[];i.find("div.jr-layout-outer").each(function(t){var i=e(this);i.data("group")===a&&i.data("order",t+n),s.push({id:i.data("id"),order:t+n})});{var d=jreviews.getController(o.item);jreviews.dispatch({method:"post",controller:d,action:"reorder",data:{"data[min]":n,"data[order]":s,"data[group]":a}})}t.sortable("destroy")}})}).on("mouseleave","mouseenter","div.jr-sortable div.jr-layout-outer",function(){i.find("div.jr-sortable").sortable("destroy")}),i.on("click",".jr-edit-media",function(){jreviews.media.view(e(this))}),i.on("click",".jr-rebuild-ratings .jr-start",function(t){t.preventDefault(),e(this).attr("disabled",!0),jreviews.review.rebuild(1)})},loadImages:function(){jrPage.find('img:not(".jr-img-ready")').each(function(){var t=e(this).data("src");t&&e(this).attr("src",t).addClass("jr-img-ready")})},publish:function(e){var t=e.data("id"),i=e.find("span").eq(0),a=e.data("states"),n=jreviews.getController(e),r=jreviews.dispatch({method:"get",type:"json",controller:n,action:"_publish",data:{id:t}});r.done(function(e){e.success&&i.attr("class",a[e.state])})},pageNav:function(t){t.on("click","div.jr-pagenav a",function(t){t.preventDefault(),e(this).trigger("jrPageNav")}),t.on("change","div.jr-pagenav select.jr-pagenav-limit, div.jr-filters select",function(t){t.preventDefault(),e(this).trigger("jrPageNav")}),t.on("blur",'div.jr-filters input[type=text]:not(".jr-date")',function(t){t.preventDefault(),e(this).trigger("jrPageNav")}),t.on("change","div.jr-filters .jr-date",function(t){t.preventDefault(),e(this).trigger("jrPageNav")}),t.on("click","button.jr-search",function(t){t.preventDefault(),e(this).trigger("jrPageNav")}),t.on("jrPageNav","div.jr-pagenav a, div.jr-pagenav select.jr-pagenav-limit, div.jr-filters select, div.jr-filters input[type=text], button.jr-search",function(i){i.preventDefault();var a=e(this),n=a.closest("form"),r=t.find("div.jr-pagenav"),o=t.find("div.jr-filters, div.jr-filters-search").find("input,select"),s=Number(e("div.jr-pagenav select.jr-pagenav-limit").first().find(":selected").text()),d=1,l=Number(r.find("a.jr-pagenav-page").last().html());a.hasClass("jr-pagenav-page")?d=Number(a.html()):a.hasClass("jr-pagenav-next")?(d=Number(a.siblings("span.jr-pagenav-current").html())+1,d=d>l?d:d):a.hasClass("jr-pagenav-prev")&&(d=Number(a.siblings("span.jr-pagenav-current").html())-1,d=0>d?1:d);var c=jreviews.getController(a),u=n.find('input[name="data[action]"]').val()||"index",v=o.serializeArray();v.push({name:"page",value:d}),isNaN(s)?v.push({name:"limit",value:"all"}):void 0!==s&&v.push({name:"limit",value:s});var f=jreviews.dispatch({method:"get",type:"html",controller:c,action:u,data:v});f.done(function(e){t.html(e)})})},editInPlace:function(t,i){var a=t.parent("div").first(),n=a.height(),r=t.data("field-id"),o=t.data("type"),s=t.data("column"),d=t.data("label"),l=1===t.data("state")?e.trim(t.html()):"",c=(t.html(),{text:e('<input type="text">').css({width:"95%"}),textarea:e("<textarea>").css({width:"95%",height:"100px"})}),u=e("<label>").html(d),v=e('<button class="jrButton jrSmall jrGreen"><span class="jrIconSave"></span> '+jreviews.__t("SAVE")+"</button>"),f=e('<button class="jrButton jrSmall "><span class="jrIconCancel"></span> '+jreviews.__t("CANCEL")+"</button>"),p=e('<div class="jrRight">').append(v,"&nbsp;",f);i.find("div.jr-eip-form").remove(),a.height(n),t.hide(),v.on("click",function(a){a.preventDefault();var n=jreviews.getController(t);l=e(this).closest(".jr-eip-form").find("input, textarea").val();var o={"data[fieldid]":r,"data[column]":s,"data[value]":l},d=jreviews.dispatch({method:"post",controller:n,action:"saveInPlace",data:o});d.done(function(){i.find("div.jr-eip-form").remove(),""===l&&(l='<span class="jrIconEdit"></span>'+jreviews.__t("EDIT")),t.data("state",1).html(l).show()})}),f.on("click",function(i){i.preventDefault(),e(this).closest("div.jr-eip-form").remove(),t.show()}),l==='<span class="jrIconEdit"></span>'+jreviews.__t("EDIT")&&(l="");var j=e('<div class="jr-eip-form jrRoundedPanel">').css({width:"200px",position:"relative",top:"-5px",left:"-50px","z-index":1e3}).append(u,c[o].val(l).css("margin","5px 0"),p,e('<div class="jrClear">'));j.insertAfter(t).focus()},pageNavData:function(e){var t=e.find("div.jr-pagenav").last(),i=e.find("div.jr-filters").find("input,select"),a=Number(t.find("select.jr-pagenav-limit").find(":selected").text()),n=Number(t.find("span.jr-pagenav-current").html()||1),r=i.serializeArray();return r.push({name:"page",value:n}),void 0!==a&&r.push({name:"limit",value:a}),r},toggle:function(e){var t=e.data("id"),i=e.data("columns"),a=e.find("span").eq(0),n=e.data("states"),r=e.closest("form").data("object-type"),o=e.data("clearRegistry")||0;i.id=t,i.clearRegistry=o,i.object_type=r;var s=jreviews.dispatch({method:"get",type:"json",controller:"admin/common",action:"toggleState",data:i});s.done(function(e){e.success&&a.attr("class",n[e.state])})},reorder:function(e,t){var i,a=e.data(),n=e.data("id"),r=e.closest("div.jr-layout-outer");jreviews.tools.flashRow(r),i=jreviews.getController(e);var o=jreviews.dispatch({method:"get",type:"html",controller:i,action:"reorder",data:a});o.done(function(e){t.html(e).promise().done(function(){var e=t.find('div.jr-layout-outer[data-id="'+n+'"]');jreviews.tools.flashRow(e)})})},update:function(t){var i,a=t.data("id");i=jreviews.getController(t);var n=jreviews.dispatch({method:"get",type:"json",controller:i,action:"update",data:{id:a}});return n.done(function(i){t.find("[data-key]").each(function(){var t,a=e(this),n=a.data("key").split("."),r=a.data("keyType"),o=i[n[0]][n[1]]||null;if(null!==o)if(t=e.isArray(o)?o.join(", "):o,"class"==r){var s=a.data("states"),d=[];e.each(s,function(t,i){-1==e.inArray(i,d)&&d.push(i)}),a.is("button,a")?a.children().first().removeClass(d.join(" ")).addClass(s[o]):a.removeClass(d.join(" ")).addClass(s[o])}else a.is(":input")?a.val(t):a.html(t)}),jreviews.tools.flashRow(t)}),n},del:function(t){var i,a=t.data("lang"),n=e("form#jr-page-form"),r=t.find("span").eq(1),o=n.data("extra-params"),s=t.data("id");i=jreviews.getController(t);var d=new e.Deferred;d.done(function(e){var a=n.find("input.jr-row-cb:checked"),r=a.serializeArray();r.push({name:"extra_params",value:o}),r.push({name:"id",value:s});var d=jreviews.dispatch({method:"get",type:"json",controller:i,action:"_delete",data:r});d.done(function(i){i.success?(e.dialog("close"),jreviews.tools.removeRow(a.closest(".jr-layout-outer")),s&&jreviews.tools.removeRow(t.closest(".jr-layout-outer"))):i.str.length?(e.dialog("option","buttons",[]),e.html(jreviews.__t(i.str))):e.dialog("close")})});var l={};l[jreviews.__t("DELETE")]=function(){d.resolve(e(this))},l[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(a.del_confirm,{buttons:l,title:r.html(),width:640});var c=e(".ui-dialog-buttonpane");c.find("button:contains("+jreviews.__t("DELETE")+")").addClass("jrButton").prepend('<span class="jrIconDelete"></span>'),c.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')}},jreviews.about={init:function(){var t=jrPage;t.on("click","button.jr-fixit",function(t){t.preventDefault();var i=e(this),a=i.data("task"),n=i.closest("form");n.find("input#jr-task").val(a),n.submit()})}},jreviews.installer={init:function(){var t=jrPage;t.on("click",'div.jr-installer button.jr-installer-update[data-status="1"]',function(i){i.preventDefault(),jreviews.installer.update(e(this),t)}),t.on("click","div.jr-installer button.jr-delete-addon",function(i){i.preventDefault(),jreviews.installer.removeAddon(e(this),t)}),t.on("change","div.jr-installer input#jr-betas",function(){var t={updater_betas:e(this).is(":checked")?"1":"0"},i=jreviews.dispatch({method:"get",controller:"admin/admin_updater",action:"betas",data:t});i.done(function(){jreviews.menu.load("admin_updater","index")})}),t.on("click",".jr-discover-addons .jr-install",function(t){t.preventDefault();var i=e(this),a=(i.data("lang"),e("form#jr-page-form")),n=a.find("input.jr-row-cb:checked"),r=n.serializeArray();if(!r.length)return e.jrAlert(jreviews.__t("MAKE_SELECTION_FROM_LIST")),!1;var o=jreviews.dispatch({method:"get",type:"json",controller:"admin/admin_addons",action:"_installDiscovered",data:r});o.done(function(t){t.success?(jreviews.tools.removeRow(n.closest(".jr-layout-outer")),e.jrAlert(jreviews.__t("UPDATER_ADDON_INSTALLED"))):t.str.length&&e.jrAlert(jreviews.__t(t.str))})})},upload:function(){jrPage.find(".jr-manage-addons").not(".jr-ready")&&(jrPage.find(".jr-manage-addons").addClass("jr-ready"),jrPage.on("tabsload",".jr-tabs",function(){if(!jrPage.find("#jr-addon-uploader").length)return!1;var t={element:document.getElementById("jr-addon-uploader"),action:s2AjaxUri,template:e.trim(e("#jr-uploader-template").html()),fileTemplate:e.trim(e("#jr-progress-template").html()),disableCancelForFormUploads:!0,allowedExtensions:["zip"],classes:{multiple:!1,button:"jr-upload-button",drop:"jr-upload-drop-area",dropActive:"jr-upload-drop-area-active",list:"jr-file-list",file:"jr-upload-file",spinner:"jr-upload-spinner",size:"jr-upload-size",cancel:"jr-upload-cancel",progress:"jr-upload-progress",success:"jr-upload-success",fail:"jr-upload-fail"},onSubmit:function(){e(".jr-file-list").html(""),e(".jr-upload-button input").trigger("beginUpload"),this.params={"data[controller]":"admin/admin_addons","data[action]":"_processUpload"}},onComplete:function(t,i,a){void 0!==a.str&&e.jrAlert(jreviews.__t(a.str))}};qq.extend(qq.FileUploader.prototype,{_onProgress:function(t,i,a,n){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var r=this._getItemByFileId(t),o=this._find(r,"size");o.style.display="inline";var s,d=this._find(r,"progress");if(a!=n){var l=Math.round(a/n*100);e(d).progressbar({value:l}),s=l+"% of "+this._formatSize(n)}else e(d).progressbar({value:100}),s=this._formatSize(n);qq.setText(o,s)}});var i=setInterval(function(){if(jrPage.find("#jr-upload-addons")){{new qq.FileUploader(t)}clearInterval(i)}},50)}))},setButtonStates:function(){var e=jrPage;e.find('div.jr-installer button[data-status="1"]').css("color","orange"),e.find('div.jr-installer button[data-status="1"]').css("color","green"),e.find('div.jr-installer button[data-status="0"]').css("color","red").prop("disabled",!0)},update:function(t,i){var a=t.data("title"),n=t.data("type"),r=t.data("name"),o=t.data("version"),s=e('<div class="jrGrid"><div class="jrCol10 jr-update-dialog-html"></div><div class="jrCol2 jr-update-dialog-status"><span class="jrLoadingMedium"></span></div></div>'),d=s.find(".jr-update-dialog-html"),l=s.find(".jr-update-dialog-status");if(d.html(jreviews.__t("UPDATER_PACKAGE_TRANSFERING")),i.find("input#update_overwrite").is(":checked")){var c=new e.Deferred,u=new e.Deferred,v=new e.Deferred;c.done(function(){var i={type:n,name:r,version:o},a=jreviews.dispatch({method:"get",type:"json",controller:"admin/admin_updater",action:"_installPackage",data:i});a.done(function(i){var a=e("<p>"+jreviews.__t(i.str)+"</p>");d.html(a),i.success===!0?(a.css("color","green"),"addon"==n?(t.val(jreviews.__t("UPDATER_INSTALLED")).css("color","red").prop("disabled",!0),l.html("&nbsp;")):"component"==n&&("extract"==i.next?u.resolve():"upgrade"==i.next?v.resolve():(d.append(e("<p>"+jreviews.__t("UPDATER_COMPONENT_SUCCESS")+"<p>").css("color","green")).append(e("<p>"+jreviews.__t("UPDATER_RELOAD_PAGE")+"</p>").css({"font-weight":"bold","font-size":"13px","text-decoration":"underline"})),l.html("&nbsp;"),t.val(jreviews.__t("UPDATER_INSTALLED")).css("color","red").prop("disabled",!0)))):(a.css("color","red"),l.html("&nbsp;"))})}),u.done(function(){var i="jreviews"==r?s2AjaxUri+"&update=1":"index.php?option=com_"+r+"&format=ajax&update=1",a=e.ajax({type:"GET",url:i,dataType:"json"});a.done(function(i){i.success?"s2framework"==r?(d.append(e("<p>"+jreviews.__t("UPDATER_COMPONENT_SUCCESS")+"<p>").css("color","green")).append(e("<p>"+jreviews.__t("UPDATER_RELOAD_PAGE")+"</p>").css({"font-weight":"bold","font-size":"13px","text-decoration":"underline"})),t.val(jreviews.__t("UPDATER_INSTALLED")).css("color","red").prop("disabled",!0),l.html("&nbsp;")):(d.append(e("<p>"+jreviews.__t("UPDATER_PACKAGE_EXTRACT_OK")+"<p>").css("color","green")),v.resolve(r)):(d.append(e("<p>"+jreviews.__t("UPDATER_PACKAGE_EXTRACT_FAIL")+"<p>").css("color","red")),l.html("&nbsp;"))})}),v.done(function(){var i=e.ajax({type:"GET",url:s2AjaxUri+"&url=install",dataType:"json"});i.done(function(i){i.success?(d.append(e("<p>"+jreviews.__t("UPDATER_COMPONENT_SUCCESS")+"<p>").css("color","green")).append(e("<p>"+jreviews.__t("UPDATER_RELOAD_PAGE")+"</p>").css({"font-weight":"bold","font-size":"13px","text-decoration":"underline"})),l.html("&nbsp;"),t.val(jreviews.__t("UPDATER_INSTALLED")).css("color","red").prop("disabled",!0)):(d.append(e("<p>"+jreviews.__t(i.str)+"</p>").css("color","red")),l.html("&nbsp;"))})});var f={},p=function(){c.resolve()};e.jrDialog(s,{title:a,buttons:f,open:p,width:600,height:250})}else e.jrAlert(jreviews.__t("UPDATER_INSTALL_CONFIRM"))},removeAddon:function(t){var i=t.data("name"),a={name:i},n=new e.Deferred;n.done(function(e){var i=jreviews.dispatch({method:"get",controller:"admin/admin_updater",action:"_removeAddon",data:a});i.done(function(i){i.success===!0?(e.dialog("option","buttons",[]),e.html(jreviews.__t("UPDATER_ADDON_REMOVED_OK")),t.val(jreviews.__t("UDPATER_REMOVED")).css("color","red").prop("disabled",!0)):(e.dialog("option","buttons",[]),e.html(jreviews.__t("UPDATER_ADDON_REMOVED_FAIL")))})});var r={};r[jreviews.__t("DELETE")]=function(){n.resolve(e(this))},r[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(jreviews.__t("UPDATER_ADDON_REMOVE_CONFIRM"),{buttons:r,title:"",width:640});var o=e(".ui-dialog-buttonpane");o.find("button:contains("+jreviews.__t("DELETE")+")").addClass("jrButton").prepend('<span class="jrIconDelete"></span>'),o.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')}},jreviews.license={init:function(){var t=jrPage;t.on("click","button#jr-license-submit",function(t){t.preventDefault();var i=e(this),a=i.closest("form");""===e("input#jr-license-number").val()?e.jrAlert(jreviews.__t("LICENSE_VALIDATE")):a.submit()})}},jreviews.config={init:function(){var t=jrPage;t.on("click","div.jr-configuration button.jr-twitter-setup",function(t){t.preventDefault(),jreviews.config.twitterSetup(e(this))}),t.on("change","div.jr-configuration select#jr-site-theme",function(){t.find("div.jr-configuration #jr-site-theme-desc").html(t.find("#theme-"+this.value).html())}),t.on("change","div.jr-configuration select#jr-mobile-theme",function(){t.find("div.jr-configuration #jr-mobile-theme-desc").html(t.find("#theme-"+this.value).html())}),""===t.find("div.jr-configuration select#rss_image").val()&&t.find("img#jr-feed-img").hide(),t.on("change","div.jr-configuration select#rss_image",function(){var i=e(this),a=t.find("img#jr-feed-img"),n=i.val();""!==n?a.attr("src","../images/"+n).show():a.hide()})},twitterSetup:function(t){var i=t.html(),a=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_twitter",action:"form"});a.done(function(t){var a={};a[jreviews.__t("SAVE")]=function(){var t=e(this),i=t.find("form");jreviews.dispatch({form:i}).done(function(){t.dialog("close")})},a[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var n=(e.jrDialog(t,{title:i,buttons:a,width:600}),e(".ui-dialog-buttonpane"));n.find("button:contains("+jreviews.__t("SAVE")+")").addClass("jrButton jrGreen").prepend('<span class="jrIconSave"></span>'),n.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')})}},jreviews.category={edit:function(t,i){var a=t.data("id")||0,n=(t.closest("form"),a>0?"edit":"create"),r=t.html(),o=jreviews.dispatch({method:"get",type:"html",controller:"admin/categories",action:n,data:{id:a}});o.done(function(a){var o={};o[jreviews.__t("SAVE")]=function(){var a=e(this),r=a.find("form"),o=e(".ui-dialog-buttonpane"),s=o.find(".jr-validation"),d=jreviews.dispatch({form:r,data:{"data[task]":n}});s=s.length?s:e('<div class="jr-validation jrError">'),s.hide(),d.done(function(e){e.success?(a.dialog("close"),e.isNew?jreviews.category.save(t,i,r):t.closest("div.jr-layout-outer").trigger("update")):e.str.length&&(o.prepend(s.html(jreviews.__t(e.str))),s.fadeIn())})};var s="edit"===n?500:800;o[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var d=(e.jrDialog(a,{title:r,buttons:o,width:s}),e(".ui-dialog-buttonpane"));d.find("button:contains("+jreviews.__t("SAVE")+")").addClass("jrButton jrGreen").prepend('<span class="jrIconSave"></span>'),d.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')})},save:function(t,i,a){a=a||t.closest("form");var n=a.find("div.jr-validation");n.hide();var r=jreviews.dispatch({form:a});r.done(function(t){t.success?i.html(t.html).fadeIn("fast").promise().done(function(){e.each(t.id,function(e,t){var a=i.find('div.jr-layout-outer[data-id="'+t+'"]');jreviews.tools.flashRow(a)})}):t.str.length&&n.html(jreviews.__t(t.str)).show().delay(5e3).fadeOut()})}},jreviews.directory={edit:function(t,i){var a=t.data("id")||0,n=t.closest("form");if(0===Number(a))return jreviews.directory.save(t,i,n),!1;var r=jreviews.dispatch({method:"get",type:"html",controller:"admin/directories",action:"edit",data:{id:a}});r.done(function(i){var a={};a[jreviews.__t("SAVE")]=function(){var i=e(this),a=i.find("form"),n=jreviews.dispatch({form:a}),r=e(".ui-dialog-buttonpane"),o=r.find(".jr-validation");o=o.length?o:e('<div class="jr-validation jrError">'),o.hide(),n.done(function(e){e.success?(i.dialog("close"),t.closest("div.jr-layout-outer").trigger("update")):e.str.length&&(r.prepend(o.html(jreviews.__t(e.str))),o.fadeIn())})},a[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var n=e.jrDialog(i,{buttons:a,width:700});jreviews.field.control_setup(n.find("form"));
var r=e(".ui-dialog-buttonpane");r.find("button:contains("+jreviews.__t("SAVE")+")").addClass("jrButton jrGreen").prepend('<span class="jrIconSave"></span>'),r.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')})},save:function(e,t,i){i=i||e.closest("form");var a=i.find("div.jr-validation");a.hide();var n=jreviews.dispatch({form:i});n.done(function(e){e.success?t.html(e.html).fadeIn("fast").promise().done(function(){var i=t.find('div.jr-layout-outer[data-id="'+e.id+'"]');i.jrScrollTo({offset:-200,duration:500}),jreviews.tools.flashRow(i)}):e.str.length&&a.html(jreviews.__t(e.str)).show().delay(5e3).fadeOut()})}},jreviews.field={init:function(){var t=jrPage;t.on("click","button.jr-edit-fieldoptions",function(i){i.preventDefault(),jreviews.fieldoption.browse(e(this),t)}),t.on("click","button.jr-field-length",function(i){i.preventDefault(),jreviews.field.changeLength(e(this),t)}),t.on("click","button.jr-field-index",function(t){t.preventDefault();var i=e(this),a=i.data("id"),n=i.find("span").eq(0),r=i.data("states"),o=jreviews.dispatch({method:"get",type:"json",controller:"admin/fields",action:"toggleIndex",data:{id:a}});o.done(function(e){e.success&&n.attr("class",r[e.state])})}),t.on("mousemove",'form:not(".jr-ready-field-suggest")',function(){jreviews.field.suggest(t),e(this).addClass("jr-ready-field-suggest")}),jrPage.on("onAfterFieldAdvancedOptionsLoaded",function(){var t=jrPage.find("[jr-code-editor]");if(t.length){var i=t.prev("textarea").hide(),a=ace.edit(t[0]);a.getSession().setMode(t.data("options")),a.setValue(i.val(),-1),a.on("change",function(){i.val(a.getValue())})}var n=jrPage.find("[jr-formbuilder]"),r=new jreviewsFormBuilder(n,{showModel:!0});r.initialize().addEditor(),n.find("#reloadForm").on("click",function(e){e.preventDefault(),r.reload()}),n.find("#loadSchema").on("click",function(t){t.preventDefault();var i=n.find("#schemaPath").val();""!=i?e.ajax({url:i,dataType:"json",cache:!1}).done(function(e){r.updateSchema(e.schema),jrPage.find("#phpFormatTheme").val(e.theme)}):r.destroy().updateSchema({})})}),jrPage.on("onListingFormLoaded",function(){jrPage.find("[jr-formbuilder]").each(function(){var t=new jreviewsFormBuilder(e(this));t.initialize()})})},edit:function(t,i){var a=t.data("id"),n=t.data("location")||"",r=jreviews.dispatch({method:"get",type:"html",controller:"admin/fields",action:"edit",data:{id:a,location:n}});r.done(function(a){var n=i.children("div").eq(0),r=e("<div>");r.insertBefore(n),jrAdmin.data("prevPage.fields",n.detach()),r.html(a).jrScrollTo();var o=r.find("form"),s=Number(o.data("id")),d=o.data("location");r.on("click","button.jr-save, button.jr-apply",function(i){i.preventDefault(),e(this).hasClass("jr-apply")&&t.data("apply",!0),jreviews.field.save(t,o,r)}),e(".jr-multiselect").multiselect({minWidth:"200",height:"auto",selectedList:3});var l=o.data("jr-box-varchar"),c=["jr-box-varchar","jr-box-banner","jr-box-required","jr-box-controlfield","jr-box-description","jr-box-listsort","jr-box-click2add","jr-box-click2search","jr-box-submitaccess","jr-box-relatedlistings"],u={"default":["jr-box-varchar","jr-box-banner","jr-box-relatedlistings"],banner:["jr-box-varchar","jr-box-required","jr-box-controlfield","jr-box-description","jr-box-listsort","jr-box-click2add","jr-box-click2search","jr-box-submitaccess","jr-box-relatedlistings"],checkboxes:["jr-box-click2add","jr-box-listsort","jr-box-banner","jr-box-relatedlistings"],select:["jr-box-banner","jr-box-relatedlistings"],radiobuttons:["jr-box-click2add","jr-box-banner","jr-box-relatedlistings"],selectmultiple:["jr-box-listsort","jr-box-banner","jr-box-relatedlistings"],email:["jr-box-click2search","jr-box-click2add","jr-box-banner","jr-box-relatedlistings"],website:["jr-box-varchar","jr-box-click2search","jr-box-click2add","jr-box-banner","jr-box-relatedlistings"],integer:["jr-box-varchar","jr-box-click2add","jr-box-banner","jr-box-relatedlistings"],date:["jr-box-varchar","jr-box-click2add","jr-box-banner","jr-box-relatedlistings"],decimal:["jr-box-varchar","jr-box-click2add","jr-box-banner","jr-box-relatedlistings"],textarea:["jr-box-click2search","jr-box-varchar","jr-box-click2add","jr-box-banner","jr-box-relatedlistings"],formbuilder:["jr-box-listsort","jr-box-click2search","jr-box-varchar","jr-box-click2add","jr-box-banner","jr-box-relatedlistings","jr-box-controlfield"],text:["jr-box-click2add","jr-box-banner","jr-box-relatedlistings"],code:["jr-box-click2search","jr-box-varchar","jr-box-click2add","jr-box-banner","jr-box-relatedlistings"],relatedlisting:["jr-box-click2search","jr-box-click2add","jr-box-banner"]};l===!1&&(u.checkboxes.push("jr-box-varchar"),u.select.push("jr-box-varchar"),u.radiobuttons.push("jr-box-varchar"),u.selectmultiple.push("jr-box-varchar")),r.find("#jr-autocomplete-settings").css("display","none"),r.find("#jr-type").on("change",function(){var t=e(this).val();t=""===t?"default":t,r.find("#jr-code-description").toggle("code"===t);var i=u[t];e.each(c,function(t,a){var n=-1===e.inArray(a,i),o=r.find("#"+a);o.length&&(n?o.toggle(!0).find("input,textarea,select").prop("disabled",!1):o.toggle(!1).find("input,textarea,select").prop("disabled",!0))});var a=e.inArray(t,["select","selectmultiple","relatedlisting"])>-1;r.find("#jr-autocomplete").toggle(a).children(":input").prop("disabled",!1),r.find("#jr-autocomplete-settings").toggle(a),"relatedlisting"==t&&(r.find(".jr-autocomplete-enable").hide(),r.find('input[name="data[Field][params][autocomplete]"]').val(1),r.find('input[name="data[Field][params][autocomplete.search]"]').val(1));var n=r.find("#jr-advancedoptions"),o=r.find("#jr-box-advancedoptions");if("default"!==t){var l=jreviews.dispatch({method:"get",type:"html",controller:"admin/fields",action:"checkType",data:{id:s,type:t,location:d}});l.done(function(e){n.html(e),o.toggle(""!==e),jrPage.trigger("onAfterFieldAdvancedOptionsLoaded")})}else n.html(""),o.hide();var v=jreviews.dispatch({method:"get",type:"text",controller:"admin/fieldoptions",action:"_controlledByCheck",data:{id:s}});v.done(function(t){var i=r.find("#jr-fieldoption-count");i.data("count",Number(t)),Number(t)>0?(i.html(t).closest("div").fadeIn("slow"),r.one("click","input#control_field",function(){e.jrAlert(__a("You need to remove the FieldOption relationships first",!0))})):i.fadeOut().closest("div").hide()})}).trigger("change")})},save:function(e,t,i){var a=e.closest("div.jr-layout-outer"),n=t.find(".jr-buttons"),r=e.data("apply")?1:0,o=i.find("div.jr-validation"),s={},d=jrAdmin.data("prevPage.fields");n.find("button").prop("disabled",!0),o.hide(),s.apply=r;var l=jreviews.dispatch({form:t,data:s});l.done(function(t){t.success?r?(jreviews.tools.apply(),e.data("apply",!1)):t.isNew?i.fadeOut().promise().done(function(){d.html(t.html);var e=d.find('div.jr-layout-outer[data-id="'+t.id+'"]');d.insertAfter(i).fadeIn("fast").promise().done(function(){e.jrScrollTo({offset:-200,duration:500}),jreviews.tools.flashRow(e)}),i.remove()}):i.fadeOut("fast").promise().done(function(){d.insertAfter(i).fadeIn("fast").promise().done(function(){a.trigger("update"),a.jrScrollTo({offset:-200,duration:500})}),i.remove()}):t.str.length&&o.html(jreviews.__t(t.str)).show()}),l.always(function(){t.find("button").prop("disabled",!1)})},control_setup:function(t){var i={field_id:"",field_search:"jr-control-field-search",value_search:"jr-control-value-search",value_div:"jr-control-value-div",value_option:"jr-control-value-option",model:"FieldOption",multipleValues:!1},a=t.find("."+i.field_search),n=t.find("."+i.value_search),r=t.find("."+i.value_div),o=t.data("location")||t.find("input.jr-field-location").val(),s=t.data("fieldid");i.model=t.data("model")||i.model,""===a.val()&&n.prop("disabled",!0),a.data("old_val",a.val()),r.on("change addcheckbox","input",function(){var t=e(this);t.not(":checked")&&(n.removeData(t.val()),t.closest("label").remove()),r.toggle(r.find("input:checked").length?!0:!1)}).trigger("change"),a.on("blur",function(){var t=e(this).val();(""===t||t!==a.data("old_val"))&&r.html("").hide(),""===t?n.prop("disabled",!0):n.prop("disabled",!1),a.data("old_val",a.val())}).autocomplete({minLength:1,source:function(e,t){if(a.data("cache."+e.term))return t(a.data("cache."+e.term));var i={"data[limit]":12,"data[field]":e.term,"data[fieldid]":s,"data[location]":o},n=jreviews.dispatch({method:"get",type:"json",controller:"admin/admin_control_fields",action:"_loadFields",data:i});n.done(function(i){a.data("cache."+e.term,i),t(i)})},select:function(e,t){a.data("fieldid",t.item.id),n.val(""),""!==t.item.id?n.prop("disabled",!1).focus():n.prop("disabled",!0),(""===t.item.value||t.item.value!==a.data("old_val"))&&r.html("").hide()}}),n.autocomplete({minLength:1,source:function(t,i){var o=r.find(":input:checked").map(function(){return this.value});if(n.data("cache."+t.term)){var s=n.data("cache."+t.term),d=[];return e(s).each(function(t,i){void 0!==i&&-1===e.inArray(i.value,o)&&d.push(s[t])}),i(d)}var l={"data[limit]":12,"data[field_id]":a.data("fieldid"),"data[value]":t.term},c=jreviews.dispatch({method:"get",type:"json",controller:"admin/admin_control_fields",action:"_loadValues",data:l});c.done(function(a){n.data("cache."+t.term,a);var r=[];e(a).each(function(t,i){void 0!==i&&-1===e.inArray(i.value,o)&&r.push(a[t])}),i(r)})},search:function(){return""===n.data("field_id")?!1:void 0},select:function(t,a){if(""!==a.item.value){var o={"class":i.value_option+"-"+a.item.value,name:"data["+i.model+"][control_value][]",value:a.item.value},s=e('<input type="checkbox" checked="checked" value="'+a.item.value+'" />').attr(o);s.click(function(){n.removeData(a.item.value)});var d=e('<label for="'+i.value_option+"-"+a.item.value+'" />').css("text-align","left");d.append(s).append("<span>"+a.item.label+"</span>"),r.show().append(d)}return n.val("").focus(),!1}}),e(".ui-autocomplete").css("white-space","nowrap")},changeLength:function(t,i){var a=t.data("id"),n=(t.closest("form"),jreviews.dispatch({method:"get",type:"html",controller:"admin/fields",action:"_changeFieldLength",data:{id:a,task:"form"}}));n.done(function(t){var a={};a[jreviews.__t("SAVE")]=function(){var t=e(this),a=t.find("form"),r=n.find(".jr-validation");r=r.length?r:e('<div class="jr-validation jrError">');var o=jreviews.dispatch({form:a});o.done(function(e){e.success?(t.dialog("close"),i.find("#max-length-value").html(e.maxlength)):e.str.length&&(n.prepend(r.html(jreviews.__t(e.str))),r.fadeIn())})},a[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var n=(e.jrDialog(t,{buttons:a,width:800}),e(".ui-dialog-buttonpane"));n.find("button:contains("+jreviews.__t("SAVE")+")").addClass("jrButton jrGreen").prepend('<span class="jrIconSave"></span>'),n.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')})},suggest:function(t){var i=t.find("form"),a=!1;e("body").on("focusin","input.jr-field-suggest:not(.jr-ready)",function(){e(this).addClass("jr-ready").on("blur",function(){var t=e(this);if(!a){var i={field:t.val(),field_location:t.data("fieldLocation")||"listing",field_types:e(this).data("fieldTypes")||""};if(""!==t.val()){var n=jreviews.dispatch({method:"get",type:"json",controller:"admin/fields",action:"validate",data:i});n.done(function(e){t.next("span").next("span").remove(),e.success?t.next("span").after('<span class="jrIconYes"></span>'):t.val("").next("span").after('<span class="jrIconNo"></span>')})}else t.next("span").attr("class","")}}).autocomplete({minLength:1,open:function(){a=!0},close:function(){a=!1,e(this).focus()},create:function(){},source:function(e,t){if(i.data("cache."+e.term))t(i.data("cache."+e.term));else{var a={limit:10,value:e.term,field_types:this.element.data("fieldTypes")||"",field_location:this.element.data("fieldLocation")||"listing"},n=jreviews.dispatch({method:"get",type:"json",controller:"admin/fields",action:"getList",data:a});n.done(function(a){i.data("cache."+e.term,a),t(a)})}},select:function(t,i){""!==i.item.value&&e(this).val(i.item.value)}})})}},jreviews.fieldoption={browse:function(t,i){var a=t.data("id"),n=jreviews.dispatch({method:"get",type:"html",controller:"admin/fieldoptions",action:"index",data:{id:a}}),r=new e.Deferred;r.done(function(t,i){var a=jreviews.dispatch({method:"get",type:"text",controller:"admin/fields",action:"_controlledByCheck",data:{id:i}});a.done(function(i){t.find("#control-field-check").toggle(Number(i)>0),Number(i)>0&&t.find("#control_field_new").one("click",function(){e.jrAlert("You need to remove the Field relation first")})})}),n.done(function(t){var n=jrPage.children("div").eq(0),o=e("<div>");jreviews.field.prevPage=n,o.insertBefore(n),jrAdmin.data("prevPage.fieldoptions",n.detach()),o.html(t),o.on("click","button.jr-clear",function(t){t.preventDefault();var i=e(this).closest("form");i.find("input[type=text]").each(function(){e(this).val("")}),i.find("div.jr-control-value-div").html("").hide()}),r.resolve(i,a)})},edit:function(t,i){var a=t.data("id")||0,n=t.closest("form");if(0===a)return jreviews.fieldoption.save(t,i,n),!1;var r=jreviews.dispatch({method:"get",type:"html",controller:"admin/fieldoptions",action:"edit",data:{id:a}});r.done(function(i){var a={};a[jreviews.__t("SAVE")]=function(){var i=e(this),a=i.find("form"),n=e(".ui-dialog-buttonpane"),r=n.find(".jr-validation"),o=jreviews.dispatch({form:a});r=r.length?r:e('<div class="jr-validation jrError">'),o.done(function(e){e.success?(i.dialog("close"),t.closest("div.jr-layout-outer").trigger("update")):e.str.length&&(n.prepend(r.html(jreviews.__t(e.str))),r.fadeIn())})},a[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var n=e.jrDialog(i,{buttons:a,width:800});jreviews.field.control_setup(n.find("form"));var r=e(".ui-dialog-buttonpane");r.find("button:contains("+jreviews.__t("SAVE")+")").addClass("jrButton jrGreen").prepend('<span class="jrIconSave"></span>'),r.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')})},save:function(e,t,i){i=i||e.closest("form");var a=i.find("div.jr-validation");a.hide();var n=jreviews.dispatch({form:i});n.done(function(e){if(e.success){var n=i.find(".jr-control-field-search").val(),r=i.find(".jr-control-value-div").html(),o=i.find(".jr-control-field-search").data("fieldid");t.html(e.html).fadeIn("fast").promise().done(function(){var i=t.find('div.jr-layout-outer[data-id="'+e.id+'"]');t.find(".jr-control-field-search").val(n),t.find(".jr-control-value-div").html(r),""!==n&&t.find(".jr-control-field-search").data("fieldid",o),i.length&&jreviews.tools.flashRow(i)})}else e.str.length&&a.html(jreviews.__t(e.str)).show().delay(5e3).fadeOut()})}},jreviews.group={init:function(){var t=jrPage;t.on("click","button.jr-clear",function(t){t.preventDefault();var i=e(this).closest("form");i.find("input[type=text]").each(function(){e(this).val("")}),i.find("div.jr-control-value-div").html("").hide()}),t.on("grouplocation change","form select#jr-group-type",function(i){i.preventDefault(),e(this).next("input").val(e(this).val()),t.find("form span#jr-group-type-label").html(e(this).find("option:selected").text()),t.find("form input#jr-group-type-hidden").val(e(this).find("option:selected").val())}).trigger("change")},changeLocation:function(){jrPage.find("form select#jr-group-type").trigger("grouplocation")},edit:function(t,i){var a=t.data("id")||0,n=t.closest("form");if(0===Number(a))return jreviews.group.save(t,i,n),!1;var r=jreviews.dispatch({method:"get",type:"html",controller:"admin/groups",action:"edit",data:{id:a}});r.done(function(i){var a={};a[jreviews.__t("SAVE")]=function(){var i=e(this),a=i.find("form"),n=jreviews.dispatch({form:a}),r=e(".ui-dialog-buttonpane"),o=r.find(".jr-validation");o=o.length?o:e('<div class="jr-validation jrError">'),o.hide(),n.done(function(e){e.success?(i.dialog("close"),t.closest("div.jr-layout-outer").trigger("update")):e.str.length&&(r.prepend(o.html(jreviews.__t(e.str))),o.fadeIn())})},a[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var n=e.jrDialog(i,{buttons:a,width:960});jreviews.field.control_setup(n.find("form"));var r=e(".ui-dialog-buttonpane");r.find("button:contains("+jreviews.__t("SAVE")+")").addClass("jrButton jrGreen").prepend('<span class="jrIconSave"></span>'),r.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')})},save:function(e,t,i){i=i||e.closest("form");var a=i.find("div.jr-validation");a.hide();var n=jreviews.dispatch({form:i});n.done(function(e){e.success?t.html(e.html).fadeIn("fast").promise().done(function(){var i=t.find('div.jr-layout-outer[data-id="'+e.id+'"]');i.jrScrollTo({offset:-200,duration:500}),jreviews.tools.flashRow(i)}):e.str.length&&a.html(jreviews.__t(e.str)).show().delay(5e3).fadeOut()})}},jreviews.media={init:function(){var t=jrPage,i=t.find("div.jr-media-upload");if(i.length){var a=i.find("form#jr-form-media-upload"),n=a.data("file-validation");jreviewsMedia.initUploader("jr-media-uploader",{fileValidation:n})}t.on("click",".jr-upload-test",function(t){t.preventDefault(),xhr=new XMLHttpRequest,xhr.onreadystatechange=function(){4==xhr.readyState&&e.jrAlert(200==xhr.status?'<span class="jrIconYes"></span> It looks like your server accepts PUT requests. You may want to consider using it for more efficient file uploads.':'<span class="jrIconYes"></span> Your server is not accepting PUT requests, use the POST method only.')},xhr.open("PUT",s2AjaxUri,!0),xhr.setRequestHeader("Content-Type","text/plain"),xhr.send(null)}),t.on("click","button.jr-media-download",function(t){t.preventDefault();var i=e(this),a=i.data("media-id");e("#jr-download-"+a).remove();var n=e('<iframe id="jr-download-'+a+'" style="display:none;"></iframe>');n.attr("src",s2AjaxUri+"&url=admin_media/download&"+jreviews.qvars.mc+"="+a).appendTo("body")})},browse:function(){var t=jrPage;t.on("click","a.jr-media-filter, button.jr-media-filter",function(i){i.preventDefault();var a,n=e(this),r=n.data("listing-id")||0,o=n.data("review-id")||0,s=n.data("user-id")||0,d=n.data("extension")||"com_content";a={listing_id:r,review_id:o,user_id:s,extension:d};var l=t.children("div").eq(0),c=e("<div>");c.insertBefore(l),jrAdmin.data("prevPage.admin_media",l.detach()),jreviews.menu.load("admin_media","browse",a)}),t.on("click","button.jr-media-main",function(i){i.preventDefault(),jreviews.media.setMain(e(this),t)})},download:function(t,i,a){e("#jrDownload"+t).remove();var n=e('<iframe id="jrDownload'+t+'" style="display:none;"></iframe>');n.attr("src",s2AjaxUri+"&url=admin_media/download&m="+t+"&"+i+"=1&"+a+"=1").appendTo("body")},edit:function(t){var i=t.data("id")||0,a="",n=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_media",action:"edit",data:{id:i}});n.done(function(i){var n={};n[jreviews.__t("SAVE")]=function(){var i=e(this),a=i.find("form"),n=jreviews.dispatch({form:a});n.done(function(e){e.success&&(i.dialog("close"),t.closest("div.jr-layout-outer").trigger("update")),e.str.length&&(i.dialog("option","buttons",[]),i.html(jreviews.__t(e.str)))})},n[jreviews.__t("CANCEL")]=function(){e(this).dialog("close"),e(this).find("#jr-video-player").trigger("jrVideoDestroy"),e(this).find("#jr-audio-player").remove()};var r=function(){e(this).find("#jr-video-player").trigger("jrVideoDestroy"),e(this).find("#jr-audio-player").remove()},o=function(){var t=e(this),i=t.find("div.jr-video-gallery"),a=t.find("#jr-audio-player"),n=t.find(".jr-thumbnails");n.length&&n.find(".jr-thumb-del").on("click",function(){var t=e(this);if(1==t.data("delete")){t.data("delete",0);var i={id:t.data("id"),size:t.data("size")},a=jreviews.dispatch({method:"get",type:"json",controller:"admin/admin_media",action:"_deleteThumb",data:i});a.done(function(e){e.success&&t.fadeOut(500)})}}).on("mouseenter",function(){var t=(e(this),e('<span class="jrIconDelete jrIconOnly">'));e(this).data("delete",1).data("contents",e(this).html()).html(t)}).on("mouseleave",function(){e(this).data("delete",0).html(e(this).data("contents"))}),i.length&&jreviewsMedia.videoGallery.init(),a.length&&jreviewsMedia.audioPlayer(),jreviews.userAutocomplete(t.find("form"))},s=(e.jrDialog(i,{title:a,open:o,close:r,buttons:n,width:800}),e(".ui-dialog-buttonpane"));s.find("button:contains("+jreviews.__t("SAVE")+")").addClass("jrButton jrGreen").prepend('<span class="jrIconSave"></span>'),s.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')})},setMain:function(t,i){var a=t.find("span").eq(0),n=t.data("listing-id"),r=t.data("id"),o=t.data("states"),s={listing_id:n,media_id:r};t.prop("disabled",!0);var d=jreviews.dispatch({method:"get",type:"json",controller:"admin/admin_media",action:"setMainMedia",data:s});d.done(function(n){if(n.success===!0){var r=function(){i.find("button.jr-media-main").not(t).prop("disabled",!1).each(function(){e(this).find("span").eq(0).attr("class",o[0])})};e.when(r()).done(function(){a.attr("class",o[1])})}})}},jreviews.listing={browse:function(){var t=jrPage;t.on("click","div.jr-listings-list button.jr-feature",function(t){t.preventDefault(),jreviews.listing.feature(e(this))}),t.on("click","div.jr-listings-list button.jr-claim",function(t){t.preventDefault(),jreviews.listing.claimStatus(e(this))}),t.on("click","div.jr-listings-list a.jr-access",function(t){t.preventDefault(),jreviews.listing.access(e(this))})},feature:function(e){var t=e.data("id"),i=e.find("span").eq(0),a=e.data("states"),n=jreviews.dispatch({method:"get",type:"json",controller:"admin/admin_listings",action:"_feature",data:{id:t}});n.done(function(e){e.success&&i.attr("class",a[e.state])})},claimStatus:function(t){var i=t.find("span").eq(1),a=t.data("id"),n=t.data("user-id"),r=t.data("states"),o=t.data("referrer"),s=t.closest("div.jr-layout-outer"),d=[];d=e.map(r,function(e){return e}).join(" ");var l=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_claims",action:"edit",data:{id:a,user_id:n,referrer:o}});l.done(function(a){var n={};n[jreviews.__t("SAVE")]=function(){var i=e(this),a=i.find("form"),n=jreviews.dispatch({form:a});n.done(function(e){i.dialog("close"),t.removeClass(d),1==a.find('select[name="data[Claim][approved]"]').val()&&t.addClass(r[e.state]),s.trigger("update")})},n[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var o=e.jrDialog(a,{buttons:n,title:i.html(),width:640});jreviews.userAutocomplete(o.find("form"));var l=e(".ui-dialog-buttonpane");l.find("button:contains("+jreviews.__t("SAVE")+")").addClass("jrButton jrGreen").prepend('<span class="jrIconSave"></span>'),l.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')})},access:function(e){var t=e.data("id"),i=e.data("states"),a=e.find("span").eq(0),n=e.data("lang"),r=jreviews.dispatch({method:"get",type:"json",controller:"admin/admin_listings",action:"_changeAccess",data:{id:t}});r.done(function(e){e.success&&(a.attr("class",i[e.state]),a.html(n[e.state]))})},edit:function(t,i){var a=t.data("id"),n=t.data("referrer");n=n||"browse";var r=e(".jr-page-spinner").show(),o=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_listings",action:"edit",data:{id:a,referrer:n}});o.done(function(a){var n=i.children("div").eq(0),o=e("<div>");o.insertBefore(n),jrAdmin.data("prevPage.admin_listings",n.detach()),o.html(a).find(".jr-tabs").tabs();var s=o.find("form"),d=s.find("#listing_id").val(),l=s.find("button.jr-save"),c=s.find("button.jr-new");s.find(".jr-title").focus(),s.find(".jr-wysiwyg-editor").tinyMCE(),l.on("click",function(e){e.preventDefault(),jreviews.listing.save(t,s,o)}),c.on("click",function(i){i.preventDefault(),s.append(e('<input name="data[saveAsNew]" value="1">')).data("isNew",!0),jreviews.listing.save(t,s,o)}),jreviews.userAutocomplete(s);var u=s.jreviewsFields({entry_id:d,value:!1,page_setup:!0,referrer:"listing"});u&&u.done(function(){n.fadeOut("fast").promise().done(function(){o.fadeIn("fast"),o.jrScrollTo(),r.hide()}),jrPage.trigger("onListingFormLoaded")})})},save:function(t,i,a){var n=t.closest("div.jr-layout-outer"),r=i.find(".jr-buttons"),o=i.find(".jr-wysiwyg-editor"),s=i.find(".jr-validation"),d=0,l=[],c=jrAdmin.data("prevPage.admin_listings");e("select[id^=cat_id]").each(function(){var t=e(this).val();t>0&&l.push(e(this))}),d=l.length,1===d?i.find("#category").val(l[0].find("option:selected").text().replace(/(- )+/,"")):d>1&&(i.find("#category").val(l[d-1].find("option:selected").text().replace(/(- )+/,"")),i.find("#parent_category").val(l[d-2].find("option:selected").text().replace(/(- )+/,""))),o.RemoveTinyMCE(),i.jrSetValidFields().join(","),r.find("button").prop("disabled",!0),s.hide();var u=jreviews.dispatch({form:i});u.done(function(e){e.success===!0?e.isNew?(c.remove(),a.html(e.html),n=a.find('div.jr-layout-outer[data-id="'+e.id+'"]'),n.jrScrollTo({offset:-200,duration:500}),jreviews.tools.flashRow(n)):a.fadeOut("fast").promise().done(function(){c.insertAfter(a).fadeIn("fast").promise().done(function(){n.trigger("update"),n.jrScrollTo({offset:-200,duration:500})}),a.remove()}):e.str.length&&(s.html(jreviews.__t(e.str)).show(),o.tinyMCE())}),u.always(function(){i.find("button").prop("disabled",!1)})}},jreviews.review={browse:function(){var t=jrPage;t.on("click","div.jr-reviews-list button.jr-review-type",function(t){t.preventDefault(),jreviews.review.reviewType(e(this))}),t.on("click","div.jr-reviews-list button.jr-owner-reply",function(t){t.preventDefault(),jreviews.review.ownerReply(e(this))}),t.on("click",".jr-review-filter",function(t){t.preventDefault();var i,a=e(this),n=a.data("listing-id")||0,r=a.data("review-type")||"",o=a.data("user-id")||0,s=a.data("extension")||"com_content",d=a.data("filter")||"",l=a.data("referrer")||"";i={listing_id:n,type:r,user_id:o,extension:s,filter_order:d,referrer:l},jreviews.menu.load("admin_reviews","browse",i)})},edit:function(t,i){var a=t.data("id"),n=t.data("referrer");n=n||"browse";var r=e(".jr-page-spinner").show(),o=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_reviews",action:"edit",data:{id:a,referrer:n}});o.done(function(n){var o=i.children("div").eq(0),s=e("<div>");s.insertBefore(o),jrAdmin.data("prevPage.admin_reviews",o.detach()),s.html(n);{var d=s.find("form"),l=d.find("button.jr-save");d.find("button.jr-cancel")}d.find(".jr-title").focus(),jreviews.review.starRating(d),l.on("click",function(e){e.preventDefault(),jreviews.review.save(t,d,s)}),jreviews.userAutocomplete(d);var c=d.jreviewsFields({fieldLocation:"Review",entry_id:a,value:!1,page_setup:!0});c&&c.done(function(){o.fadeOut("fast").promise().done(function(){s.fadeIn("fast"),s.jrScrollTo(),r.hide()})})})},save:function(t,i,a){var n=t.closest("div.jr-layout-outer"),r=i.find(".jr-buttons"),o=i.find(".jr-validation"),s=jrAdmin.data("prevPage.admin_reviews");i.jrSetValidFields().join(","),r.find("button").prop("disabled",!0),o.hide();var d=jreviews.dispatch({form:i});d.done(function(t){t.success?a.fadeOut("fast").promise().done(function(){if(t.html){var i=e(t.html);n.html(i.html())}s.insertAfter(a).fadeIn("fast").promise().done(function(){n.trigger("update"),n.jrScrollTo({offset:-200,duration:500})}),a.remove()}):t.str.length&&o.show().html(jreviews.__t(t.str))}),d.always(function(){i.find("button").prop("disabled",!1)})},reviewType:function(t){var i=t.data("id"),a=t.find("span").eq(0),n=t.data("states"),r=t.data("lang"),o=jreviews.dispatch({method:"get",type:"json",controller:"admin/admin_reviews",action:"changeReviewType",data:{id:i}});o.done(function(t){t.success?a.attr("class",n[t.state]):t.msg in r?e.jrAlert(r[t.msg]):t.str.length&&e.jrAlert(jreviews.__t(t.str))})},ownerReply:function(t){var i=t.find("span").eq(1),a=t.data("id"),n=t.data("states"),r=t.data("referrer"),o=[];o=e.map(n,function(e){return e}).join(" ");var s=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_owner_replies",action:"edit",data:{id:a,referrer:r}});s.done(function(a){var r={};r[jreviews.__t("SAVE")]=function(){var i=e(this),a=i.find("form"),r=jreviews.dispatch({form:a});r.done(function(e){i.dialog("close"),t.removeClass(o),""!==a.find('textarea[name="data[OwnerReply][owner_reply_text]"]').val()&&t.addClass(n[e.state]),jreviews.tools.flashRow(t.closest(".jr-layout-outer"))})},r[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(a,{buttons:r,title:i.html(),width:640});var s=e(".ui-dialog-buttonpane");s.find("button:contains("+jreviews.__t("SAVE")+")").addClass("jrButton jrGreen").prepend('<span class="jrIconSave"></span>'),s.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')})},starRating:function(t){t.find(".jr-rating-stars").each(function(){function t(){s.html(o.find("option:selected").text()),o.val()>0&&l.find(".ui-slider-handle").toggleClass("ui-slider-on",!0),u.removeClass("ui-stars-star-on")}function i(){u.addClass("ui-stars-star-on"),o.val("na"),c.css("left","0%").removeClass("ui-slider-on"),s.html(o.find('[value="na"]').text())}var a=e(this),n=a.data("selector"),r=a.data("inc"),o=a.find("select"),s=a.closest(".jrRow").find(".jrRatingCaption");if("stars"==n){var d=1/r;a.stars({split:d,captionEl:a.parent().next()})}else if("slider"==n){var l,c,u,v,o=a.find("select");v=o.find('[value="na"]').length,u=e(v?'<div class="ui-stars-cancel"><a>na</a></div>':'<div class="ui-stars-cancel-placeholder"></div>'),l=e('<div class="jrSliderInput">').slider({min:1,max:o.children("option").last().val(),step:r,value:"na"!==o.val()?o.val():0,start:function(){c.toggleClass("ui-slider-on",!0)},slide:function(e,i){o.val(i.value),t()}}),c=l.find(".ui-slider-handle").on("click mousedown",function(){l.slider("enable"),s.html(o.find("option:selected").text()),u.removeClass("ui-stars-star-on")}),u.on("click",function(e){e.preventDefault(),i()}),"na"!==o.val()?t():i(),a.hide().after(u,l)}})},rebuild:function(e,t){var i=t||{},a=jrPage.find(".jr-rebuild-ratings");a.find(".jr-rebuild-step"+e).show();var n=jreviews.dispatch({method:"get",type:"json",controller:"admin/admin_reviews",action:"rebuildStep"+e,data:i});n.done(function(t){t.success?void 0===t.complete?jreviews.review.rebuild(e+1,t):a.find(".jr-rebuild-complete").show():a.find(".jr-rebuild-error").show()})}},jreviews.listing_type={init:function(){var t=jrPage;t.on("click","button.jr-copy",function(i){i.preventDefault();var a=(e(this),1),n=t.find("input[type=radio]:checked").val(),r=jreviews.dispatch({method:"get",controller:"admin/listing_types",action:"_copy",data:{id:n,copies:a}});r.done(function(i){if(i.success){t.find("div#jr-table").html(i.html);var a=t.find('div.jr-layout-outer[data-id="'+i.id+'"]');a.jrScrollTo({offset:-200,duration:500}),jreviews.tools.flashRow(a)}else i.str.length&&e.jrAlert(jreviews.__t(i.str))})})},edit:function(t,i){var a=t.data("id")||0,n=jreviews.dispatch({method:"get",type:"html",controller:"admin/listing_types",action:"edit",data:{id:a}});return n.done(function(a){var n=i.children("div").eq(0),r=e("<div>");r.insertBefore(n),jrAdmin.data("prevPage.listing_types",n.detach()),r.html(a).jrScrollTo();var o=r.find("form");r.on("click","button.jr-save, button.jr-apply",function(i){i.preventDefault(),e(this).hasClass("jr-apply")&&t.data("apply",!0),jreviews.listing_type.save(t,o,r)}),r.on("change",".jr-field-matches",function(){"diff_field"===e(this).val()?e(this).parents("div:eq(1)").next("div").slideDown():e(this).parents("div:eq(1)").next("div").slideUp()}),r.find(".jr-tabs").tabs(),r.find(".jr-field-matches").trigger("change"),r.find(".jr-multiselect").multiselect({minWidth:200,height:"auto",selectedList:3}),r.find(".multiselectGroup").multiselect({minWidth:300,height:"auto",selectedList:3});var s=r.find("div.jr-ratings");r.on("click","button.jr-add-rating",function(t){t.preventDefault();var i=e(this),a=i.data("listing-type-id"),n=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_criteria_ratings",action:"addCriteria",data:{id:a}});
n.done(function(e){s.append(e).find("div.jr-layout").last().fadeIn()})}),s.on("click","button.jr-remove-rating",function(t){t.preventDefault();var i=e(this),a=i.data("criteria-id"),n=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_criteria_ratings",action:"del",data:{id:a}});n.done(function(){e(this).closest("div.jr-layout").slideUp("fast").promise().done(function(){e(this).remove(),s.find("input.jr-weights").trigger("sumWeights")})})}),s.on("click","input.jr-rating-required",function(){var t=e(this).is(":checked");e(this).prev("input").val(t?1:0)}),s.on("blur sumWeights","input.jr-weights",function(){var t=0,i=r.find("div.jr-sum-weights");s.find("input.jr-weights").each(function(){t+=Number(e(this).val())}),i.html(t.toFixed(0)),i.removeClass("jrRed jrGreen jrOrange").addClass("jrStatusLabel");var a=Number(i.html());a>100?i.addClass("jrRed"):100===a?i.addClass("jrGreen"):a>0&&100>a&&i.addClass("jrOrange")}),s.find("input.jr-weights").trigger("sumWeights"),r.on("click","input.global-cb",function(){jreviews.listing_type.processGlobals(e(this))}),r.find("input.global-cb:checked").each(function(){jreviews.listing_type.processGlobals(e(this))})})},processGlobals:function(t){var i,a=t.closest("label").next(),n=a.find("input,select").eq(0);void 0===t.data("globalSetting")?(i=e('<input type="hidden" value="-1" />').attr("name",n.attr("name")),t.data("globalSetting",i),a.after(i)):i=t.data("globalSetting");var r=a.find("select");t.is(":checked")===!0?(a.find("input,select,button").prop("disabled",!0),r.length&&r.multiselect&&(r.hasClass("jr-multiselect")||r.hasClass("multiselectGroup"))&&(r.multiselect(),r.multiselect("disable")),i.prop("disabled",!1)):(a.find("input,select,button").prop("disabled",!1),r.length&&r.multiselect&&(r.hasClass("jr-multiselect")||r.hasClass("multiselectGroup"))&&(r.multiselect(),r.multiselect("enable")),i.prop("disabled",!0))},save:function(e,t,i){var a=e.closest("div.jr-layout-outer"),n=i.find(".jr-toolbar button").prop("disabled",!0),r=(e.data("id"),e.data("apply")?1:0),o=i.find("div.jr-validation"),s=jrAdmin.data("prevPage.listing_types");o.hide();var d=jreviews.dispatch({form:t,data:{apply:r}});d.done(function(t){if(t.success===!0)if(r)jreviews.tools.apply(),e.data("apply",!1);else if(t.isNew)1==t.state?(i.find("[data-id=0]").data("id",t.id),i.find('[name="data[Criteria][id]"]').val(t.id),i.find(".jr-add-rating").attr("disabled",!1).data("listing-type-id",t.id),i.find(".jr-save-warning").hide()):i.fadeOut().promise().done(function(){s.html(t.html);var e=s.find('div.jr-layout-outer[data-id="'+t.id+'"]');s.insertAfter(i).fadeIn("fast").promise().done(function(){e.jrScrollTo({offset:-200,duration:500}),jreviews.tools.flashRow(e)}),i.remove()});else if(a.length)i.fadeOut("fast").promise().done(function(){s.insertAfter(i).fadeIn("fast").promise().done(function(){a.trigger("update"),a.jrScrollTo({offset:-200,duration:500})}),i.remove()});else{var n=jreviews.menu.load("listing_types","index");n.always(function(){var e=jrPage.find('[data-id="'+t.id+'"]');e.jrScrollTo({offset:-200,duration:500}),jreviews.tools.flashRow(e)})}else t.str.length&&o.html(jreviews.__t(t.str)).show()}),d.always(function(){n.prop("disabled",!1)})}},jreviews.moderation={init:function(){var t=jrPage;t.on("click","div.jr-moderation button.jr-submit",function(t){t.preventDefault(),jreviews.moderation.moderate(e(this))}),t.on("change","div.jr-moderation select.jr-select-reply",function(t){t.preventDefault(),jreviews.moderation.showPredefinedReply(e(this))}),t.on("change","div.jr-moderation .jr-reply input",function(t){t.preventDefault();var i=e(this),a=i.closest(".jr-layout-outer").find(".jr-form-reply");a.slideToggle()}),t.on("click","div.jr-moderation div.jr-load-more",function(t){t.preventDefault(),jreviews.moderation.loadMore(e(this))})},showPredefinedReply:function(t){var i=t.val(),a=t.closest("form"),n=e("div.jr-moderation .jr-predefined-replies");replySubject=a.find("input[name=data\\[Email\\]\\[subject\\]]"),replyBody=a.find(".jr-reply-body"),""!==i?(replyBody.val(n.find("#jr-predefined-reply-"+i).html()),replySubject.val(t.find(":selected").text())):(replyBody.val(""),replySubject.val(""))},delModeration:function(t){var i=t.data("lang"),a=t.closest("div.jr-moderation"),n=a.data("processed")||0,r=t.data("id"),o=t.find("span").eq(1),s=t.closest("form").data("object-type"),d=jreviews.getController(t),l=new e.Deferred;l.done(function(i){var o=jreviews.dispatch({method:"get",type:"json",controller:d,action:"_delete",data:{cid:[r]}});o.done(function(r){if(r.success){i.dialog("close");var o=e("#"+s+"_count"),d=Number(o.html());o.html(--d),a.data("processed",++n),t.closest("div.jr-layout-outer").slideUp(500).promise().done(function(){e(this).remove()})}else r.str.length?(i.dialog("option","buttons",[]),i.html(jreviews.__t(r.str))):i.dialog("close")})});var c={};c[jreviews.__t("DELETE")]=function(){l.resolve(e(this))},c[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(i.del_confirm,{buttons:c,title:o.html(),width:640});var u=e(".ui-dialog-buttonpane");u.find("button:contains("+jreviews.__t("DELETE")+")").addClass("jrButton").prepend('<span class="jrIconDelete"></span>'),u.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')},moderate:function(t){var i,a=t.closest("form"),n=t.closest("div.jr-moderation"),r=a.data("object-type"),o=a.closest(".jr-layout-outer"),s=n.data("processed")||0;a.find(".jr-moderate-state").each(function(){return e(this).is(":checked")?(i=Number(e(this).val()),!1):void 0});var d=jreviews.dispatch({form:a});d.done(function(){if(0===i)a.html('<div class="jrWarning">'+jreviews.__t("MODERATION_HELD")+"</div>");else{o.slideUp(500).promise().done(function(){e(this).remove()});var t=e("#"+r+"_count"),d=parseInt(t.html(),10);t.html(--d),n.data("processed",++s),0===d&&t.closest("li").remove()}})},loadMore:function(t){var i=e('<span class="jrLoadingMedium">'),a=t.closest("div.jr-moderation"),n=a.data("pages"),r=parseInt(a.data("page"),10)||2,o=parseInt(a.data("limit"),10),s=parseInt(a.data("processed"),10),d=t.html(),l=t.data("bind");t.html(i);var c=jreviews.dispatch({method:"get",type:"html",controller:l[0],action:l[1],data:{processed:s,page:r,limit:o}});c.done(function(e){t.before(e),t.html(d),a.data("page",r+1),(r===n||""===e)&&t.remove()})}},jreviews.theme={init:function(){var t=jrPage;t.on("click","button.jr-theme-categories",function(e){e.preventDefault()}),t.on("click","button.jr-save-theme-settings",function(t){t.preventDefault();var i=e(this),a=i.closest("form"),n="saveCategory",r=jreviews.dispatch({method:"post",type:"text",controller:"admin/themes",action:n,data:a.find("div.jr-table :input").serializeArray()});r.done(function(){jreviews.tools.statusUpdate(jreviews.__t("SETTINGS_SAVED"))})})}},jreviews.menu={init:function(){var t=e("div#jr-admin");t.on("click","a.jr-menu, button.jr-menu",function(t){t.preventDefault();var i=e(this).data("action")||"index";jreviews.menu.load(e(this).data("controller"),i)}),t.on("click","a.jr-menu-addon, button.jr-menu-addon",function(i){i.preventDefault(),jreviews.menu.loadAddon(e(this),t)}),t.on("click","a.jr-main-menu, button.jr-main-menu",function(){jreviews.menu.loadMain(e(this),t)}),t.on("click","#rebuild-listing-totals",function(){var t=jreviews.dispatch({method:"get",type:"html",controller:"admin/listing_types",action:"refreshReviewRatings"});t.done(function(t){e.jrAlert(t)})}),t.on("click","a#rebuild-rating-ranks",function(){var t=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_reviews",action:"recalculateRatingRanks"});t.done(function(t){e.jrAlert(t)})}),t.on("click","a#rebuild-reviewer-ranks",function(){var t=jreviews.dispatch({method:"get",type:"html",controller:"admin/common",action:"_rebuildReviewerRanks"});t.done(function(t){e.jrAlert(t)})}),t.on("click","a#rebuild-media-counts",function(){var t=jreviews.dispatch({method:"get",type:"html",controller:"admin/common",action:"_rebuildMediaCounts"});t.done(function(t){e.jrAlert(t)})}),t.on("click","a#jr-clear-cache-registry",function(t){t.preventDefault(),e.post(s2AjaxUri,{"data[controller]":"admin/common","data[action]":"clearCacheRegistry"},function(t){var i=e.jrAlert(t,{buttons:{}});setTimeout(function(){i.dialog("close")},1500)})})},load:function(e,t,i){var a=jrPage;i=i||{};var n=jreviews.dispatch({method:"get",type:"html",controller:"admin/"+e,action:t,data:i});return n.done(function(t){a.html(t).find("div.jr-tabs").tabs().fadeIn("fast"),a.find('select[multiple="multiple"]').multiselect({minWidth:200,height:"auto",selectedList:3}),"admin_updater"==e&&jreviews.installer.setButtonStates()}),n},loadMain:function(){jrPage.jrScrollTo({duration:100}),e("#addon_module").slideUp("slow",function(){e("#main_modules").slideDown("slow")})},loadAddon:function(t){var i=t.attr("id"),a="menu",n=t.data("controller"),r=t.data("action"),o=jreviews.dispatch({method:"get",type:"html",controller:"admin/common",action:"loadView",data:{folder:i,view:a}});o.done(function(t){e("#main_modules").slideUp(function(){e("#addon_module").html(t).slideDown()})}),jreviews.menu.load(n,r)},moderation_counter:function(t){var i=e("#"+t),a=Number(i.html());i.html(--a),0===a&&i.closest("li").remove()}},jreviews.userAutocomplete=function(t){var i=t.find("input.jr-user-autocomplete"),a={target_userid:"jr-user-id-ac",target_name:"jr-user-name-ac",target_username:"jr-user-username-ac",target_email:"jr-user-email-ac"};if(""===i.val()){var n=t.find("."+a.target_userid).val();if(Number(n)>0){var r=jreviews.dispatch({method:"get",type:"text",controller:"users",action:"_getUsername",data:{id:n}});r.done(function(e){i.val(e)})}}i.on("blur",function(){""===i.val()&&t.find("."+a.target_userid+", ."+a.target_email+", ."+a.target_name+", ."+a.target_username).val("")}).autocomplete({source:function(e,t){var a=i.data("cache")||{},n=e.term;if(n in a)return void t(a[n]);var r=jreviews.dispatch({frontend:!0,method:"get",type:"json",controller:"users",action:"_getList",data:{q:n}});r.done(function(e){a[n]=e,i.data("cache",a),t(e)})},select:function(e,i){t.find("."+a.target_userid).val(i.item.id),t.find("."+a.target_email).val(i.item.email),t.find("."+a.target_name).val(i.item.name),t.find("."+a.target_username).val(i.item.username)},minLength:2}),e(".ui-autocomplete").css("white-space","nowrap")},jreviews.listingAutocomplete=function(t,i){var a=i.acfield||t.find("input.jr-listing-autocomplete"),n={target_listingid:"jr-listing-id-ac",target_title:"jr-listing-title-ac",target_alias:"jr-listing-alias-ac",target_url:"jr-listing-url-ac",target_cat:"jr-listing-cat-ac",target_type:"jr-listing-type-ac",target_dir:"jr-listing-dir-ac"};if(""===a.val()){var r=t.find("."+n.target_listingid).val();if(Number(r)>0){var o=jreviews.dispatch({frontend:!0,method:"get",type:"json",controller:"listings",action:"_getList",data:{id:r}});o.done(function(e){i.onSelect?i.onSelect(a,e[0]):a.val(e[0].value)})}}a.on("blur",function(){""===a.val()&&t.find("."+n.target_listingid+", ."+n.target_title+", ."+n.target_alias+", ."+n.target_url).val("")}).autocomplete({source:function(e,i){var r=a.data("cache")||{},o=e.term;if(o in r)return void i(r[o]);var s=t.find("."+n.target_cat).val(),d=t.find("."+n.target_type).val(),l=t.find("."+n.target_dir).val(),c=jreviews.dispatch({frontend:!0,method:"get",type:"json",controller:"listings",action:"_getList",data:{search:o,dir:l,cat:s,type:d}});c.done(function(e){r[o]=e,a.data("cache",r),i(e)})},select:function(e,r){t.find("."+n.target_listingid).val(r.item.id),t.find("."+n.target_title).val(r.item.value),t.find("."+n.target_alias).val(r.item.alias),t.find("."+n.target_url).val(r.item.url),i.onSelect&&i.onSelect(a,r)},minLength:2}),e(".ui-autocomplete").css("white-space","nowrap")},jreviews.getController=function(e,t){var i,a,n=e.data("object-type"),r=e.closest("form").data("object-type"),o=e.find("form").data("object-type");switch(i=n||r||o){case"listing":a="admin_listings";break;case"media":a="admin_media";break;case"review":a="admin_reviews";break;case"inquiry":a="admin_inquiry";break;case"claim":a="admin_claims";break;case"discussion":a="admin_discussions";break;case"reply":a="admin_owner_replies";break;case"report":a="admin_reports";break;case"directory":a="directories";break;case"category":a="categories";break;case"group":a="groups";break;case"field":a="fields";break;case"fieldoption":a="fieldoptions";break;case"listing_type":a="listing_types";break;case"configuration":a="configuration";break;case"access":a="access";break;case"theme":a="themes";break;case"seo":a="seo";break;default:a="admin_"+i}return t?a:"admin/"+a},jreviews.tools={apply:function(){jreviews.tools.statusUpdate("Your changes were applied.")},flashRow:function(t){t="string"==typeof t?e("#"+t):t,t.effect("highlight",{},4e3)},checkAll:function(){var t=jrPage;t.on("change","form#jr-page-form input.jr-cb-all",function(){var i=e(this),a=t.find("form#jr-page-form"),n=a.find("input.jr-row-cb");i.is(":checked")?n.prop("checked",!0):n.prop("checked",!1)})},slug:function(t,i){var a={spaceReplaceChar:"",numbers:1,alpha:1},n=e.extend(a,i),r=t.toLowerCase();return r=r.replace(/[\/\|=!$%^ˆ°&()*;:@#+.,<>]/g,""),n.alpha&&(r=r.replace(/[àáâãäå]/gi,"a"),r=r.replace(/æ/gi,"ae"),r=r.replace(/ç/gi,"c"),r=r.replace(/[èéêë]/gi,"e"),r=r.replace(/[ìíîï]/gi,"i"),r=r.replace(/ñ/gi,"n"),r=r.replace(/[òóôõö]/gi,"o"),r=r.replace(/ß/gi,"ss"),r=r.replace(/œ/gi,"oe"),r=r.replace(/[ùúûü]/gi,"u"),r=r.replace(/[ýÿ]/gi,"y")),n.numbers||(r=r.replace(/[0-9]/g,"")),n.alpha&&(r=r.replace(/[^a-zA-Z0-9-\s]/g,"")),r=r.replace(/_/g,n.spaceReplaceChar),r=r.replace(/\s+/g,n.spaceReplaceChar)},removeRow:function(t){t="string"==typeof t?e("#"+row_id):t,t.effect("highlight",{},500).fadeOut("medium",function(){e(this).remove()})},statusUpdate:function(t){e("#jr-status").html(t).fadeIn("medium").delay(1500).fadeOut("slow")}},jreviews.tabs=function(e){e=e||jrPage,e.find("div.jr-tabs").tabs()},jreviews.popup=function(){jrPage.not(".jr-ready-popup").addClass("jr-ready-popup").on("mouseenter",function(){e(this).find(".jr-more-info").jrPopup({className:"jrPopup",delay:300})})}}(jQuery),function(e){e.jrDialog=function(t,i){e.widget("ui.dialog",e.extend({},e.ui.dialog.prototype,{_title:function(e){e.html(this.options.title?this.options.title:"&#160;")}})),e("div.jr-dialog").dialog("destroy").remove();var a={},n=e('<div class="jr-dialog jrDialogContent jrHidden"></div>');a={title:"",width:640,height:"auto",dialogClass:"jrDialog",resizable:!1,modal:!0,autoOpen:!0},a=e.extend(a,i),n.html(t),n.dialog(a);var r=e(".ui-dialog-buttonpane");return"function"==typeof jQuery().button&&r.find("button").button("destroy"),n},e.jrAlert=function(t,i){var a={dialogClass:"jrDialog",modal:!0,autoOpen:!0,width:"400px",height:"auto",buttons:{OK:function(){e(this).dialog("close")}}},n=e.extend(a,i);e("div.jr-alert").dialog("destroy").remove();var r=e('<div class="jr-alert">'+t+"</div>");return r.dialog(n),r}}(jQuery),function(e){e.fn.popUpWindow=function(){var t=e(this),i="location=0,menubar=0,resizable=1,scrollbars=0,status=0,toolbar=0",a=t.attr("href"),n=t.html(),r=window.open(a,n,i+",width=800,height=640");null!==r&&r.focus()}}(jQuery),function(e){e.getCSS=function(t,i){e(document.createElement("link")).attr({href:t,media:i||"screen",type:"text/css",rel:"stylesheet"}).appendTo("head")}}(jQuery),function(e){e.fn.jrScrollTo=function(t,i){var a=e.extend({},e.fn.jrScrollTo.defaults,t),n=e(this).offset().top+a.offset;return e("html,body").animate({scrollTop:n},a.duration,a.easing,i),e(this)},e.fn.jrScrollTo.defaults={offset:-30,duration:1e3,easing:"swing"}}(jQuery),function(e){e.fn.tinyMCE=function(){var t=this,i=1e3;try{setTimeout(function(){return"object"==typeof tinyMCE?("object"!=typeof tinyMCEPreInit||e.isEmptyObject(tinyMCEPreInit)||tinyMCE.init(tinyMCEPreInit.mceInit["jr-editor"]),"undefined"==typeof WFEditor&&"object"==typeof tinyMCE.settings&&(tinyMCE.settings.height=null),t.each(function(){tinyMCE.execCommand("mceAddEditor",!1,this.id);var t=e(this);e(this).prev(".jr-editor-add-media").find("a").on("click",function(){mceID=t.attr("id"),window.send_to_editor=window.send_to_editor_clone}),window.send_to_editor_clone=function(e){tinyMCE.execInstanceCommand(mceID,"mceInsertContent",!1,e),tb_remove()}})):void 0},i)}catch(a){console(a)}},e.fn.RemoveTinyMCE=function(){var e=this;try{tinyMCE&&(e.each(function(){tinyMCE.execCommand("mceRemoveControl",!0,this.id)}),tinyMCE.remove())}catch(t){}}}(jQuery),function(e){var t=function(t,i){this.elem=t,this.$elem=e(t),this.options=e.extend({},e.fn.jrPopup.options,i),this.init()};t.prototype={init:function(){var t=this;t.popupDiv=t.$elem.next("."+t.options.className),t.popupDiv.length&&""!==e.trim(t.popupDiv.html())&&(t.$popupDiv=e(t.popupDiv),t.$elem.hover(function(){t.show()},function(){t.hide()}),t.$popupDiv.hover(function(){t.show()},function(){t.hide()}))},show:function(){var e=this,t=e.getPosition();e.$popupDiv.stop(!0,!0),e.clearTimeouts(),e.showTimeout=setTimeout(function(){e.$popupDiv.appendTo("body").css({top:t.top,left:t.left}),e.$popupDiv.fadeIn(100)},300)},hide:function(){var t=this;t.clearTimeouts(),t.showTimeout=setTimeout(function(){e(t.popupDiv).fadeOut(100,function(){t.$elem.after(e(this))})},t.options.delay)},clearTimeouts:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0),this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0)},getPosition:function(){{var e=this.$elem.offset().top,t=this.$elem.offset().left,i=this.$elem.outerWidth();this.$elem.outerHeight()}return{left:t+i/2-this.$popupDiv.outerWidth()/2+"px",top:e-this.$popupDiv.outerHeight()-15+"px"}}},e.fn.jrPopup=function(e){return this.each(function(){new t(this,e)})},e.fn.jrPopup.options={className:"jrPopup",delay:300}}(jQuery),function(e){var t=function(e){if("string"!=typeof e)throw"sprintf: The first arguments need to be a valid format string.";for(var t=new RegExp(/%(\+)?([0 ]|'(.))?(-)?([0-9]+)?(\.([0-9]+))?([%bcdfosxX])/g),i=[],a=1;part=t.exec(e);){if(a>=arguments.length)throw"sprintf: At least one argument was missing.";i[i.length]={begin:part.index,end:part.index+part[0].length,sign:"+"==part[1],negative:parseInt(arguments[a])<0?!0:!1,padding:void 0==part[2]?" ":"'"==part[2].substring(0,1)?part[3]:part[2],alignLeft:"-"==part[4],width:void 0!=part[5]?part[5]:!1,precision:void 0!=part[7]?part[7]:!1,type:part[8],data:"%"!=part[8]?String(arguments[a++]):!1}}for(var n="",r=0,o=0;o<i.length;++o){n+=e.substring(r,i[o].begin),r=i[o].end;var s="";switch(i[o].type){case"%":s="%";break;case"b":s=Math.abs(parseInt(i[o].data)).toString(2);break;case"c":s=String.fromCharCode(Math.abs(parseInt(i[o].data)));break;case"d":s=String(Math.abs(parseInt(i[o].data)));break;case"f":s=0==i[o].precision?String(Math.abs(parseFloat(i[o].data))):Math.abs(parseFloat(i[o].data)).toFixed(i[o].precision);break;case"o":s=Math.abs(parseInt(i[o].data)).toString(8);break;case"s":s=i[o].data.substring(0,i[o].precision?i[o].precision:i[o].data.length);break;case"x":s=Math.abs(parseInt(i[o].data)).toString(16).toLowerCase();break;case"X":s=Math.abs(parseInt(i[o].data)).toString(16).toUpperCase();break;default:throw'sprintf: Unknown type "'+i[o].type+'" detected. This should never happen. Maybe the regex is wrong.'}if("%"!=i[o].type){if(0!=i[o].width&&i[o].width>s.length)for(var d=s.length,l=0;l<i[o].width-d;++l)s=1==i[o].alignLeft?s+i[o].padding:i[o].padding+s;("b"==i[o].type||"d"==i[o].type||"o"==i[o].type||"f"==i[o].type||"x"==i[o].type||"X"==i[o].type)&&(1==i[o].negative?s="-"+s:1==i[o].sign&&(s="+"+s)),n+=s}else n+=s}return n+=e.substring(r,e.length)};e.sprintf=t,String.prototype.printf=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(String(this)),t.apply(void 0,e)}}(window),function(e){jreviews.everywhere={init:function(){var e=jrPage;e.on("change","select#jr-everywhere-extension",function(){})},selectExtension:function(e,t){var i=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_everywhere",action:"_loadCategories"});i.done(function(e){t.find("div#jr-everywhere-categories").html(e)})},edit:function(t,i){var a=t.data("id")||0,n=(t.closest("form"),a>0?"edit":"create"),r=t.html(),o=t.data("extension"),s=jreviews.dispatch({method:"get",type:"html",controller:"admin/admin_everywhere",action:n,data:{id:a,extension:o}});s.done(function(t){var a={};a[jreviews.__t("SAVE")]=function(){var t=e(this),a=t.find("form"),r=jreviews.dispatch({form:a,data:{"data[task]":n}}),o=a.find("div.jr-validation");o.hide(),r.done(function(a){a.success?(t.dialog("close"),i.html(a.html).fadeIn("fast").promise().done(function(){e.each(a.id,function(e,t){var a=i.find('div.jr-layout-outer[data-id="'+t+'"]');jreviews.tools.flashRow(a)})})):a.str.length&&o.html(jreviews.__t(a.str)).show()})};var o="edit"===n?500:800;a[jreviews.__t("CANCEL")]=function(){e(this).dialog("close")};var s=(e.jrDialog(t,{title:r,buttons:a,width:o+"px"}),e(".ui-dialog-buttonpane"));s.find("button:contains("+jreviews.__t("SAVE")+")").addClass("jrButton jrGreen").prepend('<span class="jrIconSave"></span>'),s.find("button:contains("+jreviews.__t("CANCEL")+")").addClass("jrButton").prepend('<span class="jrIconCancel"></span>')})}},jreviews.addOnload("everywhere",jreviews.everywhere.init)}(jQuery);