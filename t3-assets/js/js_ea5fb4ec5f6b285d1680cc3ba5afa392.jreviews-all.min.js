
jreviews=jreviews||{},function(e,t,i){var a=e("div.jr-page"),n=e("div.jr-main");e(document).ajaxStop(function(){setTimeout(function(){t.addOnloadAjax("datepicker",t.datepicker),t.addOnloadAjax("popup",t.popup),t.addOnloadAjax("tabs",t.tabs),t.addOnloadAjax("listing-manager",t.listing.manager),t.addOnloadAjax("pagenav-ajax",t.pageNav.disableSelects),e.each(t._onloadFnAjax,function(e,t){t!==i&&t()})},10)}),t=e.extend(t,{lang:t.lang||{},_onloadFn:[],_onloadFnAjax:[],_onloadFnKeys:[],_onloadFnAjaxKeys:[]}),t.addOnload=function(i,a){-1==e.inArray(i,t._onloadFnKeys)&&(t._onloadFn.push(a),t._onloadFnKeys.push(i))},t.addOnloadAjax=function(i,a){-1==e.inArray(i,t._onloadFnAjaxKeys)&&(t._onloadFnAjax.push(a),t._onloadFnAjaxKeys.push(i))},t.onload=function(){a=a.length>0?a:e("div.jr-page"),n=n.length>0?n:e("div.jr-main"),t.addOnload("datepicker",t.datepicker),t.addOnload("popup",t.popup),t.addOnload("showmore",t.showmore),t.addOnload("calendar",t.calendar.init),t.addOnload("lightbox",t.lightbox),t.addOnload("favorite",t.listing.favorite),t.addOnload("tabs",t.tabs),t.addOnload("login",t.login.init),t.addOnload("social-sharing",t.socialSharing),t.addOnload("pagenav",t.pageNav.init),t.addOnload("listing-create",t.listing.formSetup),t.addOnload("listing-manager",t.listing.manager),t.addOnload("listing-widgets",t.listing.widgets),t.addOnload("listing-claim",t.claim.init),t.addOnload("listing-inquiry",t.inquiry.init),t.addOnload("listing-masonry",t.masonry),t.addOnload("review-init",t.review.init),t.addOnload("review-edit",t.review.edit),t.addOnload("review-vote",t.review.vote),t.addOnload("review-reply",t.review.reply),t.addOnload("report",t.report.init),t.addOnload("comment-manager",t.discussion.manager),t.addOnload("comment-new",t.discussion.init),t.addOnload("comment-reply",t.discussion.reply),t.addOnload("comment-earlier",t.discussion.earlierComment),t.addOnload("media-init",t.media.init),t.addOnload("media-thumbs",t.media.generateThumbs),t.addOnload("media-manager",t.media.manager),t.addOnload("media-download",t.media.download),t.addOnload("search-simple",t.search.simple),t.addOnload("search-adv-page",t.search.advancedPage),t.addOnload("search-adv-module",t.search.advancedModule),t.addOnload("fields-module",t.fieldsModule),t.addOnload("directory-tree",t.directoryTree),t.addOnload("facebook",t.facebook.load),t.addOnload("comparison",t.compare),t.addOnload("module-slider",t.module.init),t.addOnload("trix-editor",t.trix),t.addOnload("jreviews-formbuilder",t.formbuilder),e.each(t._onloadFn,function(e,t){t!==i&&t()})},"function"==typeof head?head.ready(function(){t.onload()}):e(function(){t.onload()}),t.getScript=function(t,a){return e.ajax({type:"GET",url:t,success:function(){i!==a&&a()},dataType:"script",cache:!0})},t.__t=function(i,a){var n={add_ul:!0};if(a=e.extend(n,a),"string"==typeof i)return t.lang[i]||i;var r=[];return e.each(i,function(e,i){var a,n,o;"string"==typeof i?a=t.lang[i]||i:(o=i.shift(),n=t.lang[o]||o,i.unshift(n),a=window.sprintf.apply(null,i)),r.push("<li>"+a+"</li>")}),a.add_ul?"<ul>"+r.join("")+"</ul>":r.join("")},t.dispatch=function(t){t=t||{};var a=t.form_id!==i||t.form!==i?"POST":"GET";i!==t.method&&(a=t.method);var n="";t.controller!==i&&(n=e.param("post"==a.toLowerCase()?{"data[controller]":t.controller,"data[action]":t.action}:{url:t.controller+"/"+t.action}));t.type||"json";if(i!==t.form_id||i!==t.form){var r=t.form||e("#"+t.form_id);i!==t.controller&&r.find("input[name=data\\[controller\\]], input[name=data\\[action\\]]").remove(),n=r.serialize()+"&"+n}t.data&&(n=n+"&"+e.param(t.data));var o={type:a,url:s2AjaxUri,data:n,dataType:t.type};return"get"==a.toLowerCase()&&t.cache!==i?o.cache=t.cache:"get"!=a.toLowerCase()&&(o.headers={"Cache-Control":"no-cache"}),e.ajax(o)},t.compare=function(){"undefined"!=typeof jreviewsCompare&&jreviewsCompare.init()},t.datepicker=function(){if(e().datepicker){try{t.datepickerClear()}catch(i){}e.datepicker.setDefaults({showOn:"both",buttonImage:t.calendar_img,showButtonPanel:!0,buttonImageOnly:!0,buttonText:"Calendar",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),e('.jr-date:not(".jr_ready")').addClass("jr-ready").each(function(){e(this).datepicker({yearRange:e(this).data("yearrange"),minDate:e(this).data("mindate"),maxDate:e(this).data("maxdate")})})}},t.datepickerClear=function(){var i=e.datepicker._updateDatepicker;e.datepicker._updateDatepicker=function(a){i.call(this,a);var n=e(this).datepicker("widget").find(".ui-datepicker-buttonpane");0===n.find(".clearDate").length&&e("<button class='clearDate' type='button' class='ui-datepicker-clean ui-state-default ui-priority-primary ui-corner-all'>"+t.__t("CLEAR_DATE")+"</button>").appendTo(n).click(function(){e.datepicker._clearDate(a.input)})}},t.fieldsModule=function(){e(".jr-fields-module").each(function(){var i=e(this),a=i.data("showLimit")||5,n=i.find("li"),r=e('<a href="javascript:;" class="jrFieldsShowAll">'+t.__t("FILTERS_SHOW_ALL")+"</a>").hide(),o=e('<a href="javascript:;" class="jrFieldsShowLess">'+t.__t("FILTERS_SHOW_LESS")+"</a>").hide();1==i.data("showAll")&&n.length>a&&(i.after(r,o),r.on("click",function(t){t.preventDefault(),e(this).hide(),o.show(),n.removeClass("jrOptionHidden")}).show(),o.on("click",function(t){t.preventDefault(),e(this).hide(),i.find("li:gt("+(a-1)+")").addClass("jrOptionHidden"),r.show()}))})},t.directoryTree=function(){e().treeview&&e(".jr-directory-tree").treeview({animated:"fast",unique:!0,collapsed:!1}).each(function(){var t=e(this),i=t.data("cat-id"),a=t.data("dir-id"),n=t.data("show-dir"),r=null;i?r=e(".jr-tree-cat-"+i):a&&n&&(r=e(".jr-tree-dir-"+a)),null!==r&&(r.removeClass("closed").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea").swapClass("lastExpandable","lastCollapsable"),r.parents("ul, li").show().removeClass("closed").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea").swapClass("lastExpandable","lastCollapsable"),r.children("ul, li").show().removeClass("closed"),r.children("div").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea"),r.parents("ul, li").children("div").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea"))})},t.tabs=function(t){if("undefined"!=typeof e().tabs){t=t||e('div.jr-page .jr-tabs:not(".jr-ready")');var a=e("base").attr("href");a!==i&&a.length&&t.find("ul:eq(0) li a").each(function(){e(this).attr("href",e(location).attr("href").split("#")[0]+e(this).attr("href"))}),t.addClass("jr-ready").tabs()}},t.pageNav={init:function(){e(window).on("popstate",function(a){var n=a.originalEvent.state,r=e("form");null!==n&&""!=n.url&&(n.form&&(r=e('form[data-module-id="'+n.form.id+'"]'),e.each(n.form.data,function(t,a){var n=r.find('[name="'+a.name+'"]'),o=e._data(n[0],"events");o!==i&&e._data(n[0],"events").updateFilterNoChange!==i&&n.val(a.value).trigger("updateFilterNoChange")})),t.pageNav.loadUrl(n.url,{scroll:r.data("update-scroll")||0}))}),t.pageNav.disableSelects(),n.on("click",'div.jr-pagenav[data-ajax="1"] a, div.jr-list-layout[data-ajax="1"] a',function(t){t.preventDefault(),e(this).trigger("jrPageNav")}),n.on("change",'div.jr-pagenav[data-ajax="1"] select.jr-pagenav-limit, div.jr-pagenav[data-ajax="1"] select.jr-list-sort',function(t){t.preventDefault(),e(this).trigger("jrPageNav")}),n.on("jrPageNav",'div.jr-pagenav[data-ajax="1"] a, div.jr-pagenav[data-ajax="1"] select, div.jr-list-layout[data-ajax="1"] a',function(i){i.preventDefault();var n=null,r=e(this),o=r.closest("form"),s=a.find("div.jr-pagenav");if(0==o.length){if(r.is("a")?n=r.attr("href"):r.is("select")&&(r.hasClass("jr-pagenav-limit")||r.hasClass("jr-list-sort"))&&(n=r.val()),n){var d=(r.closest(".jr-page"),r.parents(".jrPaginationBottom").length?!0:!1);t.pageNav.loadUrl(n,{push:!0,scroll:d})}}else{var l=Number(e("div.jr-pagenav select.jr-pagenav-limit").first().find(":selected").text()),c=1,u=Number(s.find("a.jr-pagenav-page").last().html()),f=[],p=o.find('input[name="data[controller]"]').val(),m=o.find('input[name="data[action]"]').val()||"index";0===l&&(l=o.find('input[name="data[limit]"]').val()||10),r.hasClass("jr-pagenav-page")?c=Number(r.html()):r.hasClass("jr-pagenav-next")?(c=Number(r.siblings("span.jr-pagenav-current").html())+1,c=c>u?c:c):r.hasClass("jr-pagenav-prev")&&(c=Number(r.siblings("span.jr-pagenav-current").html())-1,c=0>c?1:c),f.push({name:t.qvars.pg,value:c}),f.push({name:"limit",value:l});var h=t.dispatch({method:"get",type:"html",controller:p,action:m,data:f});h.done(function(e){r.closest(".jr-page-inner, .jr-page").first().html(e)})}})},disableSelects:function(){n.find('div.jr-pagenav[data-ajax="1"] select.jr-pagenav-limit, div.jr-pagenav[data-ajax="1"] select.jr-list-sort').removeAttr("onchange")},loadUrl:function(i,a){var a=e.extend({push:!1,scroll:!1},a);a.refUrl=i,i+=-1===i.indexOf("?")?"?":"&",i+="format=raw";var r=e.ajax({type:"get",url:i,dataType:"html"});n.addClass("jrIsLoading"),e(document).trigger("jreviews-onBeforeAjaxUpdate"),r.done(function(e){t.pageNav.updatePage(e,a)})},updatePage:function(a,r){var r=e.extend({push:!1,scroll:!1,form:{}},r);$html=e("<div>"+a+"</div>");var o=$html.find('meta[name="title"]').detach(),s=o.attr("content"),d=$html.find('meta[name="url"]').detach();if(refUrl=d.attr("content"),s!==i?e("title").html(s):s=e("title").html(),r.refUrl==i&&refUrl!==i&&(r.push=!0,r.refUrl=d.attr("content")),n.html($html.html()),r.scroll){var l=n.find(".jr-pagenav");l.length&&l.jrScrollTo({duration:350,offset:-150})}r.push&&r.refUrl&&window.history.pushState({url:r.refUrl,form:r.form},null,r.refUrl),e(document).trigger("jreviews-onAfterAjaxUpdate",[r.refUrl]),0===n.find(".jr-map-canvas").length&&(t.masonry(),n.removeClass("jrIsLoading")),"function"==typeof ga&&(ga("set",{page:r.refUrl.replace(/^.*\/\/[^\/]+/,""),title:s}),ga("send","pageview"))}},t.socialSharing=function(){a.find(".jr-tweet").length&&(window.twttr=function(e,t,i){var a,n=e.getElementsByTagName(t)[0],r=window.twttr||{};return e.getElementById(i)?r:(a=e.createElement(t),a.id=i,a.src="//platform.twitter.com/widgets.js",n.parentNode.insertBefore(a,n),r._e=[],r.ready=function(e){r._e.push(e)},r)}(document,"script","twitter-wjs"));var e=a.find(".jr-gplusone");e.length&&(e.remove(),function(e,t,i){var a,n=e.getElementsByTagName(t)[0];e.getElementById(i)||(a=e.createElement(t),a.id=i,a.src="//apis.google.com/js/plusone.js",n.parentNode.insertBefore(a,n))}(document,"script","google-jssdk"));var t=a.find(".jr-linkedin");t.length&&(t.remove(),function(e,t,i){var a,n=e.getElementsByTagName(t)[0];e.getElementById(i)||(a=e.createElement(t),a.id=i,a.src="//platform.linkedin.com/in.js",n.parentNode.insertBefore(a,n))}(document,"script","linkedin-jssdk")),a.find(".jr-pinterest").length&&!function(e,t,i){var a,n=e.getElementsByTagName(t)[0];e.getElementById(i)||(a=e.createElement(t),a.id=i,a.src="//assets.pinterest.com/js/pinit.js",n.parentNode.insertBefore(a,n))}(document,"script","pinterest-jssdk")},t.login={init:function(){e("body").on("click",".jr-show-login",function(){e("#jr-login-form").toggle()})}},t.discussion={init:function(){var i=e("div.jr-form-comment-outer"),a=i.find('form[id^="jr-form-comment"]'),n=a.attr("id"),r=(a.data("discussion-id"),a.find(".jr-buttons")),o=a.find(".jr-validation"),s=e("button.jr-comment-add");s.on("click",function(t){t.preventDefault();var a=e(this);i.slideDown(),a.fadeOut()}),s.one("click",function(){t.common.initForm(n,!0),t.common.validateUsername(a),t.common.validateEmail(a)}).trigger("click"),a.on("click","button.jr-comment-cancel",function(e){e.preventDefault(),i.slideUp(),s.fadeIn()}),a.on("click","button.jr-comment-submit",function(n){n.preventDefault();var s=e(".jr-review-comments");r.find("button").prop("disabled",!0),r.append('<span class="jrLoadingSmall">'),o.hide();var d=t.dispatch({form:a});d.done(function(e){if(e.success){i.slideUp().remove();var n='<div class="jr-message jrSuccess">'+t.__t(e.moderation?"DISCUSSION_SUBMIT_MODERATED":"DISCUSSION_SUBMIT_NEW")+"</div>";s.prepend('<div class="jr-new-comment jrHidden">'+n+e.html+"</div>").jrScrollTo({duration:500,offset:-50}).delay().find(".jr-new-comment").slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500),t.discussion.manager(),t.discussion.earlierComment()}else e.str.length&&(o.html(t.__t(e.str)).show(),t.captcha.reset(a.find(".g-recaptcha").data("id")))}),d.always(function(){r.find(".jrLoadingSmall").remove(),r.find("button").prop("disabled",!1)})})},reply:function(){e('button.jr-comment-reply:not(".jr-ready")').on("click",function(i){i.preventDefault();var a=e(this),n=a.find("span").eq(1),r=a.data("discussion-id"),o=a.data("review-id"),s=t.dispatch({method:"get",type:"html",controller:"discussions",action:"reply",data:{discussion_id:r,review_id:o}});s.done(function(i){var r={},o=function(){var i=e(this),a=i.find("form").last();t.common.initForm(a.attr("id"),!0),t.common.validateUsername(a),t.common.validateEmail(a),i.on("click",".jr-show-login",function(){i.find(".jr-login-form").toggle()})};r[t.__t("SUBMIT")]=function(){t.discussion.submitReply(a,e(this))},r[t.__t("CANCEL")]=function(){e(this).dialog("close")};var s=e.jrDialog(i,{buttons:r,title:n.html(),open:o,width:"640px"});s.find(".jr-form-comment-outer").show()})}).addClass("jr-ready")},manager:function(){var i=e('ul.jr-comment-manager:not(".jr-ready")').addClass("jr-ready");i.on("click","a.jr-comment-edit",function(){var i=e(this),a=i.find("span").eq(1),n=i.data("discussion-id"),r=t.dispatch({method:"get",type:"html",controller:"discussions",action:"edit",data:{discussion_id:n}});r.done(function(n){var r={};r[t.__t("SUBMIT")]=function(){t.discussion.submitEdit(i,e(this))},r[t.__t("CANCEL")]=function(){e(this).dialog("close")};var o=e.jrDialog(n,{buttons:r,title:a.html(),width:"640px",minHeight:"300"});o.find(".jr-form-comment-outer").show()})}),i.on("click","a.jr-comment-delete",function(){var i=e(this),a=i.data("discussion-id"),n=i.data("token"),r=i.find("span").eq(1),o=new e.Deferred;o.done(function(e){var r={id:a,token:n},o=t.dispatch({method:"get",type:"json",controller:"discussions",action:"_delete",data:r});o.done(function(a){a.success?(e.dialog("close"),i.closest(".jr-layout-outer").html('<div class="jrSuccess">'+t.__t("DISCUSSION_DELETED")+"</div>").jrScrollTo()):(e.dialog("option","buttons",[]),a.str.length&&e.html(t.__t(a.str)))})});var s={};s[r.html()]=function(){o.resolve(e(this))},s[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(t.__t("DISCUSSION_DELETE_CONFIRM"),{buttons:s,title:r.html(),width:"640px"})})},submitReply:function(i,a){var n=a.find("form").last(),r=(n.attr("id"),n.find(".jr-validation"));r.hide();var o=t.dispatch({form:n});o.done(function(n){if(n.success){a.dialog("close");var o='<div class="jr-message jrSuccess">'+t.__t(n.moderation?"DISCUSSION_SUBMIT_MODERATED":"DISCUSSION_SUBMIT_NEW")+"</div>",s=e('<div class="jr-new-comment jrHidden">'+o+n.html+"</div>");i.closest(".jr-layout-outer").after(s),s.jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500)}else n.str.length&&r.html(t.__t(n.str)).show();t.discussion.manager()})},submitEdit:function(i,a){var n=a.find("form"),r=(n.attr("id"),n.find(".jr-validation"));r.hide();var o=t.dispatch({form:n});o.done(function(n){if(n.success){a.dialog("close");var o=e('<div class="jr-message jrSuccess" style="margin-top:10px;">'+t.__t(n.moderation?"DISCUSSION_SUBMIT_MODERATED":"DISCUSSION_SUBMIT_EDIT")+"</div>"),s=e('<div class="jr-new-comment jrClear jrHidden">'+n.html+"</div>"),d=i.closest(".jr-layout-inner");d.html(o).prepend(s),s.jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500)}else n.str.length&&r.html(t.__t(n.str)).show();t.discussion.manager(),t.discussion.earlierComment()})},earlierComment:function(){e(".jr-earlier-comment").each(function(){var i=e(this),a=i.data("post-id"),n=i.next(".jr-earlier-comment-content"),r=e.Deferred();r.done(function(){var e=t.dispatch({method:"get",type:"html",controller:"discussions",action:"getPost",data:{id:a}});e.done(function(e){n.html(e)})}),i.jrPopup({className:"jrPopup",delay:500,onBeforeShow:function(){""===n.html()&&(n.html('<span class="jrLoadingMedium"></span>'),r.resolve())}})})}},t.module={init:function(){e("div.jr-module-slider, div.jr-plugin-slider").not(".jr-ready").addClass("jr-ready").each(function(){var t=e(this),i=t.height(),a=t.find(".jrModuleItems"),n=t.data("options");if(!(n.page_count<2)){i>0&&t.css({"max-height":i+"px",overflow:"hidden"}),t.removeClass("jrSliderSinglePage"),"vertical"==n.orientation&&t.addClass("jrSliderVertical"),"side"==n.nav_position&&t.addClass("jrSliderSideArrows");var r,o,s,d={mode:n.orientation,speed:600,easing:"swing",oneToOneTouch:!0,auto:parseInt(n.slideshow,10),pause:1e3*n.slideshow_interval,autoHover:!0,pager:!0,onSliderLoad:function(){t.css({"max-height":"100%",overflow:"visible"})}},l={},c=t.closest(".jr-tabs"),u=t.closest(".tab-pane"),f=t.closest('[data-ui-object="joms-tabs"]');c.length?(r=c.find("li a").eq(0).attr("href").split("#")[1],s=c.find(".ui-tabs-panel").index(a.closest(".ui-tabs-panel")),r&&a.parents("#"+r).length?a.bxSlider(d):c.find(".ui-tabs-nav > li > a").eq(s).one("click",function(){a.bxSlider(d)})):u.length?setTimeout(function(){if(o=u.parent().prev("ul").find("li a").eq(0).attr("href"),r=o?o.split("#")[1]:null,r&&a.parents("#"+r).length)a.bxSlider(d);else{e('a[data-toggle="tab"]').on("shown.bs.tab",function(){"function"==typeof l.redrawSlider?l.redrawSlider():l=a.bxSlider(d)});var t=u.attr("id").match(/[\d]+$/);t&&e("#cbtabnav"+t+" a").one("click",function(){a.bxSlider(d)})}},550):f.length?(r=f.find(".joms-tab__bar a").eq(0).attr("href").split("#")[1],s=f.find(".joms-tab__content").index(a.closest(".joms-tab__content")),r&&a.parents("#"+r).length?a.bxSlider(d):f.find(".joms-tab__bar a").eq(s).one("click",function(){a.bxSlider(d)})):"function"==typeof a.bxSlider&&a.not(".jr-slider-ready").addClass("jr-slider-ready").bxSlider(d)}})}},t.lightbox=function(){e(".jrPage a.fancyvideo").length>0&&e("a.fancyvideo").magnificPopup({type:"iframe",callbacks:{elementParse:function(e){e.src=e.src+"&lightbox=1&tmpl=component"}}}),e(".jrPage a.fancybox").length>0&&(e(".jrPage").magnificPopup({delegate:'a.fancybox[rel="gallery"]',type:"image",mainClass:"mfp-fade",zoom:{enabled:!0,duration:300},gallery:{enabled:!0,preload:[0,2],navigateByImgClick:!0,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',tCounter:'<span class="mfp-counter">%curr% of %total%</span>'}}),e(".jrReviewContainer .jrMediaContainer").each(function(){e(this).magnificPopup({delegate:"a.fancybox",type:"image",mainClass:"mfp-fade",zoom:{enabled:!0,duration:150},gallery:{enabled:!0,preload:[0,2],navigateByImgClick:!0,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',tCounter:'<span class="mfp-counter">%curr% of %total%</span>'}})}))},t.media={init:function(){if("undefined"==typeof jreviewsMedia)return!1;t.media.formSetup();var i=e("div.jr-listing-media"),n=i.find(".jr-tabs-media"),r=["photo","photo_owner","photo_user","video","video_owner","video_user","audio","attachment"];i.find("div.jr-media-sortable").sortable({axis:"y",containment:"parent",handle:".jr-sort-handle",cursor:"move",stop:jreviewsMedia.reorder}),e(r).each(function(e,t){i.find("div#"+t).length?i.find('a[href="#'+t+'"]').closest("li").show():i.find('a[href="#'+t+'"]').closest("li").remove()}),t.tabs(n),jreviewsMedia.photoFunction(a),jreviewsMedia.videoGallery.init(),jreviewsMedia.photoGallery.init(),jreviewsMedia.audioPlayer()},generateThumbs:function(){e('img[data-thumbnail="1"]').not(".jr-ready").each(function(){var i=e(this);i.addClass("jr-ready");var a={"data[media_id]":e(this).data("media-id"),"data[size]":e(this).data("size"),"data[mode]":e(this).data("mode")},n=t.dispatch({method:"post",type:"json",controller:"media_upload",action:"generateThumb",data:a});n.done(function(e){if(e.success&&""!==e.url){var t=i.closest("div");i.css("none"!=t.css("max-width")?{width:t.css("max-width"),height:"auto"}:{width:e.width+"px",height:e.height+"px"}),i.attr("src",e.url)}})})},formSetup:function(){var i=e("div.jr-media-upload"),a=i.find("#jr-media-uploader"),n=a.data("android");if(i.length){var r=i.find("form#jr-user-info");try{if(t.paid.plan.plan_selected){var o=e('<input type="hidden" name="data[plan_id]">').val(t.paid.plan.plan_selected);i.find("form").append(o)}}catch(s){}t.common.validateUsername(r),t.common.validateEmail(r),t.common.initForm("jr-user-info",!0);var d=i.find("form#jr-form-media-upload"),l=d.data("file-validation");jreviewsMedia.initUploader("jr-media-uploader",{fileValidation:l,multiple:n?!1:!0});var c=i.find(".jr-upload-button"),u=c.find("input"),f=i.find(".jr-upload-mobile-options");f.length&&(c.hide(),f.on("change",function(){var t=e(this).val();u.removeAttr("multiple"),"multiple"==t&&u.attr("multiple","multiple"),""!==t&&u.trigger("click")}).buttongroup())}},manager:function(){var i=n.length?n:a;i.on("click",".jr-media-edit",function(){var i=e(this),a=i.data("media-id"),n=i.find("span").eq(1),r=t.dispatch({method:"get",type:"html",controller:"media",action:"_edit",data:{media_id:a}});r.done(function(a){var r={};r[t.__t("SUBMIT")]=function(){t.media.editSubmit(i,e(this))},r[t.__t("CANCEL")]=function(){e(this).find("#jr-video-player").trigger("jrVideoDestroy"),e(this).find("#jr-audio-player").remove(),e(this).dialog("close")};{var o=function(){e(this).find("#jr-video-player").trigger("jrVideoDestroy"),e(this).find("#jr-audio-player").remove()},s=function(){var i=e(this),a=i.find("div.jr-video-gallery"),n=i.find("#jr-audio-player"),r=i.find(".jr-thumbnails");r.length&&r.find(".jr-thumb-del").on("click",function(){var i=e(this);if(1==i.data("delete")){i.data("delete",0);var a={id:i.data("id"),size:i.data("size")},n=i.data("token");n&&(a[n]=1);var r=t.dispatch({method:"get",type:"json",controller:"media",action:"_deleteThumb",data:a});r.done(function(a){a.success?i.fadeOut(500):a.str.length&&e.jrAlert(t.__t(a.str))})}}).on("mouseenter",function(){var t=(e(this),e('<span class="jrIconDelete jrIconOnly">'));e(this).data("delete",1).data("contents",e(this).html()).html(t)}).on("mouseleave",function(){e(this).data("delete",0).html(e(this).data("contents"))}),a.length&&jreviewsMedia.videoGallery.init(),n.length&&jreviewsMedia.audioPlayer(),t.common.userAutocomplete(i.find("form"))};e.jrDialog(a,{buttons:r,title:n.html(),open:s,close:o,width:"800px"})}})}),i.on("click",".jr-media-delete",function(){var i=e(this),a=i.data("media-id"),n=i.data("token"),r=(i.data("lang"),i.find("span").eq(1)),o={},s=new e.Deferred;s.done(function(r){o[n]=1,o["data[Media][media_id]"]=a;var s=t.dispatch({method:"get",type:"json",controller:"media",action:"_delete",data:o});s.done(function(a){a.success?(r.dialog("close"),i.closest(".jr-layout-outer").css("background-image","none").animate({backgroundColor:"#f7f1ac"},600).promise().done(function(){e(this).slideUp(600,function(){e(this).remove()})})):(r.dialog("option","buttons",[]),r.html(t.__t(a.str)))})});var d={};d[t.__t("DELETE")]=function(){s.resolve(e(this))},d[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(t.__t("MEDIA_DELETE_CONFIRM"),{buttons:d,title:r.html(),width:"640px"})}),i.on("click",".jr-media-publish",function(){var i=e(this),a=i.find("span").eq(0),n=i.data("media-id"),r=i.data("token"),o=i.data("states"),s={on:t.__t("PUBLISHED"),off:t.__t("UNPUBLISHED")},d={media_id:n};d[r]=1;var l=t.dispatch({method:"get",type:"json",controller:"media",action:"_publish",data:d});l.done(function(i){i.success?(a.attr("class",1==i.state?o.on:o.off),a.next().is("span")?a.next().html(1==i.state?s.on:s.off):a.attr("title",1==i.state?s.on:s.off)):e.jrAlert(t.__t(i.str))})}),i.on("click","button.jr-media-main",function(a){a.preventDefault();var n=e(this),r=n.find("span").eq(0),o=n.data("listing-id"),s=n.data("media-id"),d=n.data("token"),l=n.data("states"),c={listing_id:o,media_id:s,state:n.data("mainMedia")};c[d]=1,n.prop("disabled",!0);var u=t.dispatch({method:"get",type:"json",controller:"media",action:"setMainMedia",data:c});u.done(function(t){if(t.success===!0){var a=function(){i.find("button.jr-media-main").not(n).each(function(){e(this).data("mainMedia",0),e(this).find("span").eq(0).attr("class",l.off)})};e.when(a()).done(function(){n.data("mainMedia",1===c.state?0:1),r.attr("class",1===c.state?l.off:l.on),n.prop("disabled",!1)})}})})},editSubmit:function(e,i){var a=i.find("form"),n=t.dispatch({form:a});n.done(function(a){a.success?(i.dialog("close"),e.closest(".jr-layout-inner").find(".jr-media-title a").html(a.title)):(i.dialog("option","buttons",[]),i.html(t.__t(a.str)))})},download:function(){e(".jr-page").on("click",".jr-media-download",function(){var i=e(this),a=i.data("media-id"),n=i.data("token-s"),r=i.data("token-i");if(t.iOS)window.open(s2AjaxUri+"&url=media/download&"+t.qvars.mc+"="+a+"&"+n+"=1&"+r+"=1");else{e("#jr-download-"+a).remove();var o=e('<iframe id="jr-download-'+a+'" style="display:none;"></iframe>');o.attr("src",s2AjaxUri+"&url=media/download&"+t.qvars.mc+"="+a+"&"+n+"=1&"+r+"=1").appendTo("body")}})}},t.inquiry={init:function(){var i=e("button.jr-send-inquiry-embedded,a.jr-send-inquiry-embedded");i.length&&(t.common.initForm("jr-form-inquiry"),i.on("click",function(e){e.preventDefault(),t.inquiry.submit()})),e("body").on("click","button.jr-send-inquiry,a.jr-send-inquiry",function(i){i.preventDefault();var a=e(this),n=a.data("listing-id"),r=a.find("span").eq(1),o=t.dispatch({method:"get",type:"html",controller:"inquiry",action:"create",data:{id:n}});o.done(function(i){var a={};a[t.__t("SUBMIT")]=function(){t.inquiry.submit(e(this))},a[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(i,{buttons:a,title:r.html(),width:"640px"}),t.common.initForm("jr-form-inquiry",!0)})})},submit:function(i){var a,n=e("#jr-form-inquiry-outer"),r=n.find(".jr-validation");a=i?i.find("form"):n.find("form"),n.find(".jr-validation").hide(),r.hide().html("");var o=t.dispatch({form:a});o.done(function(o){o.success?(i&&i.dialog("option","buttons",[]),n.html(t.__t("INQUIRY_SUBMIT"))):(o.str.length&&r.html(t.__t(o.str)).show(),t.captcha.reset(a.find(".g-recaptcha").data("id")),n.find("#jr-form-inquiry").find(".jr-validation-input").hide(),e.each(o.inputs,function(e,t){n.find("#jr-inquiry-"+t).siblings("label").find(".jr-validation-input").show()}),i&&i.trigger("failedValidation"))})}},t.masonry=function(){var t,i,a,r,o,s=function(){t=d.parent().width(),i=Math.floor(l>150?t/l:t/150),a=12*(i-1),r=2*i,o=(t-a-r)/i,d.find(".jrListItem").css({width:o})},d=n.find(".jr-masonry-results"),l=d.find(".jrListItem:first").data("thumbwidth"),c=d.find(".jrListItem:first").data("rtl");d.length&&e().jrMasonry&&(s(),d.jrMasonry({itemSelector:".jrListItem",columnWidth:function(e){return e/i},gutterWidth:0,isFitWidth:!0,isResizable:!0,isRTL:c,isAnimated:!0,animationOptions:{duration:300}}),e(window).on("resize",function(){s(),d.jrMasonry("reload")}))},t.claim={init:function(){e("button.jr-listing-claim,a.jr-listing-claim").on("click",function(i){i.preventDefault();var a=e(this),n=a.data("listing-id"),r=a.data("state"),o=a.find("span").eq(1);if("no-access"==r)e.jrAlert(t.__t("CLAIM_REGISTER"));else{var s=t.dispatch({method:"get",type:"html",controller:"claims",action:"create",data:{listing_id:n}});s.done(function(i){var a={};a[t.__t("SUBMIT")]=function(){t.claim.submit(e(this))},a[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(i,{buttons:a,title:o.html(),width:"640px"})})}})},submit:function(e){var i=e.find("form"),a=i.find(".jr-validation");a.html("").hide();var n=t.dispatch({form:i});n.done(function(n){n.success?(e.dialog("option","buttons",[]),i.html(t.__t("CLAIM_SUBMIT"))):n.str.length?a.html(t.__t(n.str)).show():(e.trigger("failedValidation"),a.html(t.__t("CLAIM_VALIDATE_MESSAGE")).show())})}},t.listing={favorite:function(){e("body").on("click",".jr-listing-favorite",function(i){i.preventDefault();var a=e(this),n=a.find("span").eq(0),r=a.find("span").eq(1),o=a.data("states"),s=a.data("listing-id");switch(a.attr("disabled","disabled"),a.data("state")){case"favored":var d=t.dispatch({method:"get",type:"json",controller:"listings",action:"_favoritesDelete",data:{"data[listing_id]":s}});d.done(function(i){i.success?(a.data("state","not_favored"),n.attr("class",o.not_favored),r.html(t.__t("FAVORITE_ADD")),e(".jr-favorite-"+s).html(i.count).effect("highlight",{},1e3)):e.jrAlert(t.__t(i.str))}),d.always(function(){a.removeAttr("disabled")});break;case"not_favored":var l=t.dispatch({method:"get",type:"json",controller:"listings",action:"_favoritesAdd",data:{"data[listing_id]":s}});l.done(function(i){i.success?(a.data("state","favored"),n.attr("class",o.favored),r.html(t.__t("FAVORITE_REMOVE")),e(".jr-favorite-"+s).html(i.count).effect("highlight",{},1e3)):e.jrAlert(t.__t(i.str))}),l.always(function(){a.removeAttr("disabled")});break;case"no_access":e.jrAlert(t.__t("FAVORITE_REGISTER"))}})},manager:function(){var i=e('ul.jr-listing-manager:not(".jr-ready")').addClass("jr-ready");i.on("click","a.jr-listing-publish,a.jr-listing-feature",function(){var i,a,n=e(this),r=n.find("span").eq(0),o=n.find("span").eq(1),s=n.data("states"),d=n.data("listing-id"),l=n.data("token"),c={id:d};switch(c[l]=1,n.attr("class")){case"jr-listing-publish":i="_publish",a={on:t.__t("PUBLISHED"),off:t.__t("UNPUBLISHED")};break;case"jr-listing-feature":i="_feature",a={on:t.__t("FEATURED"),off:t.__t("NOT_FEATURED")}}var u=t.dispatch({method:"get",type:"json",controller:"listings",action:i,data:c});u.done(function(i){i.success?(r.attr("class",1==i.state?s.on:s.off),o.html(1==i.state?a.on:a.off)):e.jrAlert(t.__t(i.str))})}),i.on("click","a.jr-listing-delete",function(){var i=e(this),a=i.find("span").eq(1),n=i.data("listing-id"),r=i.data("token"),o={id:n};o[r]=1;var s=new e.Deferred;s.done(function(e){var a=t.dispatch({method:"get",type:"json",controller:"listings",action:"_delete",data:o});a.done(function(a){if(a.success){e.dialog("close");try{i.closest(".jr-layout-outer").html('<div class="jrSuccess">'+t.__t("LISTING_DELETED")+"</div>").jrScrollTo()}catch(n){}}else e.dialog("option","buttons",[]),e.html(t.__t(a.str))})});var d={};d[a.html()]=function(){s.resolve(e(this))},d[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(t.__t("LISTING_DELETE_CONFIRM"),{buttons:d,title:a.html(),width:"640px"})})},formSetup:function(){var n=e("#jr-form-listing"),r=n.find(".jr-form-categories-outer"),o=n.find(".jr-form-listing-fields"),s=r.find(".jr-cat-select"),d=n.data("listing-id"),l=parseInt(n.data("cat-id"),10);if(d){var c=e('<span class="jrLoadingSmall">'),u=n.jreviewsFields({entry_id:e("#listing_id","#jr-form-listing").val()||"",value:!1,page_setup:!0,referrer:"listing"});r.append(c),u?u.done(function(){o.show().find(".jr-wysiwyg-editor").tinyMCE(),a.trigger("onListingFormLoaded"),o.jrApplyFieldOptionLayout(),c.remove()}):(o.show().find(".jr-wysiwyg-editor").tinyMCE(),c.remove())}if(t.listing.submitCategory(n),l){{s.last().removeAttr("disabled").trigger("change")}d||s.attr("disabled","disabled")}n.on("change","input#jr-review-optional",function(){a.find(".jr-form-review").slideToggle()}),n.on("click","button.jr-cancel-listing",function(e){e.preventDefault(),history.go(-1)}),n.on("click","button.jr-submit-listing",function(a){a.preventDefault();var o=e(this),s=n.closest(".jr-form-listing-outer"),c=n.find(".jr-buttons"),u=n.find(".jr-wysiwyg-editor"),f=n.find(".jr-validation"),p=0,m=[];e("select[id^=cat_id]").each(function(){var t=e(this).val();t>0&&m.push(e(this))}),p=m.length,1==p?n.find("#category").val(m[0].find("option:selected").text().replace(/(- )+/,"")):p>1&&(n.find("#category").val(m[p-1].find("option:selected").text().replace(/(- )+/,"")),n.find("#parent_category").val(m[p-2].find("option:selected").text().replace(/(- )+/,"")));try{u.SaveTinyMCE()}catch(h){}n.jrSetValidFields().join(","),c.find("button").attr("disabled","disabled"),c.append('<span class="jrLoadingSmall">'),f.hide(),(l||d)&&r.find("select").removeAttr("disabled");var v=t.dispatch({form:n});v.done(function(e){if(e.success===!0){if(e.facebook&&e.moderation===!1){var a={id:e.listing_id};a[e.token]=1,t.facebook.addTokenAndPost("_postListing","html",a)}if(e.plgBeforeRenderListingSave)return o.trigger("plgBeforeRenderListingSave",e),!1;s.jrScrollTo({duration:400,offset:-100},function(){s.html(function(){var t="",a="";return t=e.html,e.mediaForm!==i&&(a=e.mediaForm),t+a}),t.tabs(s.find(".jr-tabs")),t.media.formSetup()})}else e.str&&(e.str.length&&f.html(t.__t(e.str)).show(),t.captcha.reset(n.find(".g-recaptcha").data("id")))}),v.always(function(){(l||d)&&r.find("select").attr("disabled","disabled"),n.find("#valid_fields").remove(),c.find(".jrLoadingSmall").remove(),n.find("button").removeAttr("disabled")})})},submitCategory:function(n){var r=e('<div class="jrRoundedPanel" style="text-align:center;"><span class="jrLoadingMedium" style="display:inline;padding:20px;"></span>'+t.__t("LOADING")+"</div>");n.on("change",".jr-cat-select",function(){var o=e(this);formChooser=n.find(".jr-form-categories-outer"),formFields=n.find(".jr-form-listing-fields"),formCategories=n.find(".jr-form-categories"),listing_id=parseInt(n.data("listing-id"),10)||"",selected_cat_id=parseInt(n.find(".jr-cat-select").last().val(),10),editing=listing_id>0?!0:!1;var s=formCategories.find("select").index(o)+1;if(editing)return!1;n.find(".jr-wysiwyg-editor").RemoveTinyMCE();var d=[];e(".jr-form-categories").find('select[disabled="disabled"]').each(function(){d.push(e(this))});var l=formChooser.find("select,input").removeAttr("disabled").serializeArray();e(d).each(function(){e(this).attr("disabled","disabled")}),l.push({name:"data[level]",value:s}),l.push({name:"data[catid]",value:o.val()});var c=t.dispatch({method:"get",type:"json",controller:"listings",action:"_loadForm",data:l});r.insertAfter(formChooser);var u=new e.Deferred;u.done(function(e,t){try{e.jreviewsFields(t)}catch(i){}}),u.always(function(){a.trigger("onListingFormLoaded")});var f=new e.Deferred;f.done(function(e){formFields.jreviewsFields(e)}),f.always(function(){t.common.initForm(n.attr("id"),!0),t.common.validateUsername(n),t.common.validateEmail(n);var e=n.find("fieldset.jr-form-review");e.length?u.resolve(e,{fieldLocation:"Review",entry_id:0,value:!1,page_setup:!0,referrer:"review"},selected_cat_id,"listingFormReview"):a.trigger("onListingFormLoaded"),r.remove(),formFields.show(),formFields.jrApplyFieldOptionLayout()}),c.done(function(a){if(a.level!==i){var o=formCategories.children("select");o.each(function(t){t>a.level&&e(this).remove()})}switch(a.select!==i&&formCategories.append(a.select),a.action){case"show_form":formFields.html(a.html);try{formFields.find(".jr-wysiwyg-editor").tinyMCE()}catch(s){}f.resolve({entry_id:listing_id,value:!1,page_setup:!0,referrer:"listing",res:a}),t.facebook.init(n),t.review.starRating(n),setTimeout(function(){t.captcha.init(n)},200);var d=n.find(".jr-listing-title");d.length&&t.search.liveSearch(d,{id:"submitListing"});break;case"hide_form":r.remove(),formFields.hide();break;case"no_access":r.remove(),formFields.html(t.__t("LISTING_SUBMIT_DISALLOWED")).show()}})})},widgets:function(){var n=a.filter(".jr-listing-detail"),r=[];n.length&&(n.find(".jr-tabs").find("li>a").each(function(t,i){var a=e(i).attr("href"),n=a.substring(a.indexOf("#")+1);r["#"+n]=e(i).parent("li")}),"undefined"!=typeof jrRelatedWidgets&&jrRelatedWidgets.length&&e(jrRelatedWidgets).each(function(a,n){var o;o=n.favorites?"module_favorite_users":"relatedreviews"==n.type?"module_reviews":"module_listings";var s=t.dispatch({method:"get",type:"html",controller:o,action:"index",data:n});s.done(function(a){var o=""!==n.target_class?n.target_class:n.target_id,s=e(""!==n.target_class?"."+n.target_class:"#"+n.target_id);if(""!==a.trim()){var d=e('<div id="'+o+"Widget"+n.key+'"></div>').addClass("jrWidget");n.title&&d.append('<h3 class="jrHeading">'+n.title+"</h3>"),d.append(a),s.append(d);for(var l=[0,1,2,3,4,5,6,7,8,9],c=0;c<l.length;c++)l[c]=e("#"+o+"Widget"+l[c]);for(var c=0;c<l.length;c++)l[c].length>0&&s.append(l[c]);r["#"+o]!==i&&""!==s.html()&&r["#"+o].show()}else r["#"+o]!==i&&""===s.html()&&r["#"+o].hide();t.module.init(),t.media.generateThumbs()})}))}},t.review={setup:function(n,r){var o=e("form#"+n),s=o.closest("div.jr-form-review-outer");if(o.data("initialized")==i){o.data("initialized",1),t.review.starRating(s),t.common.validateUsername(o),t.common.validateEmail(o),t.common.initForm(n,!0),t.facebook.init(o);var d=o.jreviewsFields({fieldLocation:"Review",entry_id:r,value:!1,page_setup:!0,referrer:"review"});d&&d.done(function(){0===r&&s.slideDown().delay().jrScrollTo({duration:500,offset:-50}),a.trigger("onReviewFormLoaded"),o.jrApplyFieldOptionLayout()})}},init:function(){var i=document.URL;if(e("body").on("click",".jr-page .jr-review-add",function(i){i.preventDefault();var a,n,r=e(this),o=e("#userReviews"),s=e("#editorReviews");if(o.length)a=o.parents(".jr-page"),n=o.find(".jr-login-box");else{if(!s.length)return!1;a=s.parents(".jr-page"),n=s.find(".jr-login-box")}var d=a.find(".jr-tabs"),l=a.find("div.jr-form-review-outer"),c=l.find('form[id^="jr-form-review"]'),u=c.attr("id"),f=c.data("review-id");d.length&&d.tabs("select","#reviewsTab"),c.length&&!n.length?(t.review.setup(u,f),a.find('button.jr-review-add:not(".jr-listing-info")').fadeOut(),l.slideDown("fast").jrScrollTo({duration:500,offset:-50})):o.jrScrollTo(),n.length&&!r.hasClass("jr-listing-info")&&n.slideToggle(100)}),e("body").on("click",'form[id^="jr-form-review"] .jr-review-cancel',function(t){t.preventDefault(),e(this).closest(".jr-form-review-outer").slideUp(),e(this).closest(".jr-page").find('button.jr-review-add:not(".jr-listing-info")').fadeIn().delay().jrScrollTo({duration:500,offset:-50})}),e("body").on("click",'form[id^="jr-form-review"] .jr-review-submit',function(i){i.preventDefault();var a=e(this),n=e(".jr-user-reviews"),r=a.closest("div.jr-form-review-outer"),o=r.find('form[id^="jr-form-review"]'),s=o.find(".jr-buttons"),d=o.find("div.jr-validation");o.jrSetValidFields().join(","),s.find("button").attr("disabled","disabled"),s.append('<span class="jrLoadingSmall">'),d.hide();var l=t.dispatch({form:o});l.done(function(e){if(e.success){if(r.slideUp().remove(),e.facebook&&e.moderation===!1){var i={id:e.review_id};i[e.token]=1,t.facebook.addTokenAndPost("_postReview","html",i)}var a="";e.moderation===!1&&(a='<div class="jr-message jrSuccess">'+t.__t("user"==e.review_type?"REVIEW_SUBMIT_NEW":"REVIEW_SUBMIT_NEW_REFRESH")+"</div>"),n.prepend('<div class="jr-new-review jrHidden">'+a+e.html+"</div>").jrScrollTo({duration:500,offset:-50}).delay().find(".jr-new-review").slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500),t.review.edit(),t.review.vote(),t.popup()}else e.str.length&&(d.html(t.__t(e.str)).show(),t.captcha.reset(o.find(".g-recaptcha").data("id")))}),l.always(function(){o.find("#jr-valid_fields").remove(),s.find(".jrLoadingSmall").remove(),s.find("button").removeAttr("disabled")})}),e("body").on("click",".jr-page .jr-owner-reply-del",function(i){i.preventDefault();var a=e(this),n=a.data("review-id"),r=a.data("token"),o=a.find("span").eq(1),s=new e.Deferred;s.done(function(e){var i={id:n};i[r]=1;var o=t.dispatch({method:"get",type:"json",controller:"owner_replies",action:"_delete",data:i});o.done(function(i){i.success?(e.dialog("close"),a.closest(".jr-owner-reply-outer").replaceWith('<div class="jrSuccess">'+t.__t("OWNER_REPLY_DELETED")+"</div>")):(e.dialog("option","buttons",[]),i.str.length&&e.html(t.__t(i.str)))})});var d={};d[t.__t("DELETE")]=function(){s.resolve(e(this))},d[t.__t("CANCEL")]=function(){e(this).dialog("close")};e.jrDialog(t.__t("OWNER_REPLY_DELETE_CONFIRM"),{buttons:d,title:o.html(),width:"640px"})}),i.match("#reviewForm$")||i.match("#userReviews$")){var n=a.find(".jr-tabs");n.length&&e(".jr-tabs").tabs("select","#reviewsTab").jrScrollTo({duration:500,offset:-100}),i.match("#reviewForm$")&&a.find(".jr-review-add").first().trigger("click")}},edit:function(){e("body").on("click",'.jr-page .jr-review-edit:not(".jr-ready")',function(i){i.preventDefault();var a=e(this),n=a.find("span").eq(1),r=a.data("review-id"),o=a.data("referrer"),s="jr-form-review-"+r,d=e("#jr-form-review-0"),l=e('<div id="jr-form-review-placeholder" class="jrHidden"></div>');d.before(l);var c=d.detach(),u=t.dispatch({method:"get",type:"html",controller:"reviews",action:"_edit",data:{review_id:r}});u.done(function(i){var d={};d[t.__t("SUBMIT")]=function(){t.review.editSubmit(a,e(this),l,c)},d[t.__t("CANCEL")]=function(){l.after(c),l.remove(),e(this).dialog("close")};var u=e.jrDialog(i,{buttons:d,title:n.html(),width:"800px",height:600});u.find("form").append('<input name="data[referrer]" type="hidden" value='+o+">"),t.review.setup(s,r),t.common.userAutocomplete(u)})}).addClass("jr-ready")},editSubmit:function(i,a,n,r){var o=i.closest(".jr-layout-inner"),s=a.find("form"),d=(s.attr("id"),e(".ui-dialog-buttonpane")),l=s.find(".jr-validation").clone();d.find(".jr-validation").fadeOut().remove(),s.jrSetValidFields().join(",");var c=t.dispatch({form:s});c.done(function(e){if(e.success){n.after(r),n.remove(),a.dialog("close");var i="";o.hide(0).html(function(){return e.moderation===!1&&(i='<div class="jr-message jrSuccess">'+t.__t("user"==e.review_type?"REVIEW_SUBMIT_EDIT":"REVIEW_SUBMIT_EDIT_REFRESH")+"</div>"),i+e.html}).jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500)}else e.str.length&&(l.html(t.__t(e.str)),d.prepend(l),l.fadeIn());t.review.edit(),t.review.vote(),t.popup()}),c.always(function(){s.find("#jr-valid_fields").remove()})},starRating:function(t){t.find(".jr-rating-stars").each(function(){function t(){s.html(o.find("option:selected").text()),o.val()>0&&u.find(".ui-slider-handle").toggleClass("ui-slider-on",!0),p.removeClass("ui-stars-star-on")}function i(){p.addClass("ui-stars-star-on"),o.val("na"),f.css("left","0%").removeClass("ui-slider-on"),s.html(o.find('[value="na"]').text())}var a=e(this),n=a.data("selector"),r=a.data("inc"),o=a.find("select"),s=a.closest(".jrRow").find(".jrRatingCaption"),d=o.data("style")||1,l=o.data("color")||"orange";if("stars"==n){var c=1/r;a.stars({starColor:l,starStyle:d,split:c,captionEl:a.parent().next()})}else if("slider"==n){var u,f,p,m;m=o.find('[value="na"]').length,p=e(m?'<div class="ui-stars-cancel"><a>na</a></div>':'<div class="ui-stars-cancel-placeholder"></div>'),e.ui.slider.prototype.widgetEventPrefix="slider",u=e('<div class="jrSliderInput">').slider({min:1,max:o.children("option").last().val(),step:r,value:"na"!==o.val()?o.val():0,start:function(){f.addClass(l).toggleClass("ui-slider-on",!0)},slide:function(e,i){o.val(i.value),t()}}),f=u.find(".ui-slider-handle").on("click mousedown",function(){u.slider("enable"),s.html(o.find("option:selected").text()),p.removeClass("ui-stars-star-on")}),p.on("click",function(e){e.preventDefault(),i()}),"na"!==o.val()?t():i(),a.hide().after(p,u)}})},reply:function(){e("body").on("click",'.jr-page .jr-owner-reply:not(".jr-ready")',function(){var i=e(this),a=i.find("span").eq(1),n=i.data("review-id"),r=t.dispatch({method:"get",type:"html",controller:"owner_replies",action:"create",data:{review_id:n}});r.done(function(n){var r={};r[t.__t("SUBMIT")]=function(){t.review.replySubmit(i,e(this))},r[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(n,{buttons:r,title:a.html(),width:"640"})})})},replySubmit:function(e,i){var a=i.find("form"),n=a.find(".jr-validation"),r=t.dispatch({form:a});n.hide(),r.done(function(a){a.success?(i.html(t.__t(a.str)),i.dialog("option","buttons",[]),e.attr("disabled","disabled")):(i.trigger("failedValidation"),n.html(t.__t(a.str)).show())})},vote:function(){e("body").on("click",'div.jr-review-vote:not(".jr-ready") button',function(i){i.preventDefault();var a=e(this),n=a.data("vote"),r=a.closest(".jr-review-vote"),o=r.data("state"),s=r.data("review-id"),d=(a.find("span").eq(0),a.find("span").eq(1));if(r.unbind("click").find("button").attr("disabled","distabled"),"access"!=o)e.jrAlert(t.__t("register"==o?"REVIEW_VOTE_REGISTER":"ACCESS_DENIED"));else{var l={"data[Vote][review_id]":s,"data[type]":n},c=t.dispatch({method:"get",type:"json",controller:"votes",action:"_save",data:l});c.done(function(i){if(i.success){if(d.html(parseInt(d.html(),10)+1),i.facebook&&"yes"==n){var a={id:s};a[i.token]=1;var r=e.Deferred();r.done(function(){var e=function(e){try{"object"==typeof e&&FB.ui(e)}catch(t){console.log(t)}};t.facebook.addTokenAndPost("_postVote","json",a,e)}),FB.getLoginStatus(function(t){"connected"===t.status?FB.api("/me/permissions",function(t){var i=!1;t&&!t.error&&(e.each(t.data,function(e,t){"publish_actions"==t.permission&&"granted"==t.status&&(i=!0)}),i?r.resolve():FB.login(function(e){e.authResponse&&r.resolve()},{scope:"publish_actions"}))}):FB.login(function(e){e.authResponse&&r.resolve()},{scope:"publish_actions"})})}}else i.str.length&&e.jrAlert(t.__t(i.str))})}}).addClass("jr-ready")}},t.report={init:function(){e("body").off("click",".jr-page button.jr-report").on("click",".jr-page button.jr-report",function(i){i.preventDefault();var a=e(this),n={listing_id:a.data("listing-id"),review_id:a.data("review-id"),post_id:a.data("post-id"),m:a.data("media-id"),extension:a.data("extension")},r=t.dispatch({method:"get",type:"html",controller:"reports",action:"create",data:n});r.done(function(i){var a={};a[t.__t("SUBMIT")]=function(){t.report.submit(e(this))},a[t.__t("CANCEL")]=function(){e(this).dialog("close")},e.jrDialog(i,{buttons:a,title:t.__t("REPORT_INAPPROPRIATE"),width:"640"})})})},submit:function(e){var i=e.find("form"),a=i.find(".jr-validation");a.html("").hide();var n=t.dispatch({form:i});n.done(function(n){n.success?(e.dialog("option","buttons",[]),i.html(t.__t("REPORT_SUBMIT"))):(e.trigger("failedValidation"),a.html(t.__t(n.str)).show())})}},t.facebook={buttons_class:"jr-buttons",enable:!1,permissions:!1,uid:null,load:function(){var i=t.fb.appid||null,n=a.find(".jr-fb-like").length||a.find(".jr-fb-share").length;(t.fb.xfbml||t.fb.post||n)&&(e("#fb-root").length?n&&"object"==typeof FB?FB.XFBML.parse(a.get(0)):n&&"function"!=typeof window.fbAsyncInit&&(window.fbAsyncInit=function(){FB.XFBML.parse(a.get(0))}):(e("body").append('<div class="jrHidden" id="fb-root"></div>'),window.fbAsyncInit=function(){FB.init({appId:i,status:!0,cookie:!0,xfbml:n?!0:!1,version:"v2.3"})}),function(e,i,a){var n,r=e.getElementsByTagName(i)[0];e.getElementById(a)||(n=e.createElement(i),n.id=a,n.async=!0,n.src="//connect.facebook.net/"+t.locale+"/sdk.js",r.parentNode.insertBefore(n,r))}(document,"script","facebook-jssdk"))},init:function(e){t.fb.post&&(t.facebook.form=e,t.facebook.checkPermissions())},login:function(){null!==t.facebook.uid&&t.facebook.permissions||FB.login(function(i){i.authResponse?(t.facebook.uid=i.authResponse.userID,t.facebook.permissions||FB.api("/me/permissions",function(i){i&&!i.error&&e.each(i.data,function(e,i){"publish_actions"==i.permission&&"granted"==i.status&&(t.facebook.permissions=!0)}),t.facebook.permissions||e("#jr-fb-publish").prop("checked",!1)})):e("#jr-fb-publish").prop("checked",!1)},{scope:"publish_actions"})},checkPermissions:function(i){var a={};a=e.extend(a,i),t.facebook.FBInit=setInterval(function(){"object"==typeof FB&&FB.getLoginStatus(function(i){"connected"===i.status?(t.facebook.uid=i.authResponse.userID,FB.api("/me/permissions",function(i){var a=!1;i&&!i.error&&(e.each(i.data,function(e,t){"publish_actions"==t.permission&&"granted"==t.status&&(a=!0)}),t.facebook.addButton(a?!0:!1))})):t.facebook.addButton(!1)})},450)},addButton:function(a){if(clearInterval(t.facebook.FBInit),t.facebook.permissions=a,t.facebook.form===i)return!1;var n=t.facebook.form.find("."+t.facebook.buttons_class);if(a!==!0||t.fb.optout){var r=e('<div class="jrFacebookPublish"><input id="jr-fb-publish" name="data[fb_publish]" value="1" type="checkbox"><div class="jrButton jrBlue"><span class="fb_button_text"><label for="jr-fb-publish">'+t.__t("FACEBOOK_PUBLISH")+"</label></span></div></div>").on("click","input",function(){this.checked&&t.facebook.login()});0===n.find("#jr-fb-publish").length&&n.prepend(r),a&&t.fb.optout&&r.find("input").attr("checked","checked")}else n.prepend('<input id="jr-fb-publish" name="data[fb_publish]" value="1" type="hidden" />')},addTokenAndPost:function(e,i,a,n){FB.getLoginStatus(function(r){if("connected"==r.status){a.accessToken=r.authResponse.accessToken;var o=t.dispatch({method:"get",type:i,controller:"facebook",action:e,data:a});o.done(function(e){"function"==typeof n&&n(e)})}})}},t.captcha={init:function(e){if(e.find(".jr-captcha").length&&"object"==typeof grecaptcha){var i=e.find(".g-recaptcha"),a=grecaptcha.render(i[0],{sitekey:i.data("sitekey"),theme:i.data("theme"),"expired-callback":t.captcha.reset});i.data("id",a)}},reset:function(e){e!==i&&"object"==typeof grecaptcha&&grecaptcha.reset(e)}},t.common={initForm:function(a,n){var r="string"==typeof a?e("#"+a):a,o=r.find("div.jr-captcha");r.on("click",".jr-user-forget",function(i){var a=e(this);i.preventDefault();var n=t.dispatch({cache:!1,method:"get",controller:"users",action:"_clearUserInfo"});n.done(function(){r.find(".jr-user-name, .jr-user-username, .jr-user-email").val("").prop("disabled",!1),a.closest("span").remove()})}),r.one("mouseover",function(){var n=t.dispatch({cache:!1,method:"get",type:"json",controller:"common",action:"_initForm",data:{"data[form_id]":a,"data[captcha]":o.length}});n.done(function(a){r.find("span.jr_token :input").attr("name",a.token),a.captcha&&(o.html(a.captcha),setTimeout(function(){t.captcha.init(r)},750)),r.find("input.jr-user-name").val(a.name);var n=r.find("input.jr-user-username");n.val(a.username).on("focus mouseover",function(){e(this).closest("div").find(".jr-more-info").trigger("mouseover")}).on("blur mouseout",function(){e(this).closest("div").find(".jr-more-info").trigger("mouseout")}),n.data!=i&&1==n.data("replace-placeholder")&&n.attr("placeholder",t.__t("USERNAME_CREATE_ACCOUNT")),r.find("input.jr-user-email").val(a.email),r.find("input.jr-user-name, input.jr-user-username, input.jr-user-email").each(function(){var t=e(this).val();""!==t?e(this).prop("disabled",!0):e(this).prop("disabled",!1)})})}),n===!0&&r.trigger("mouseover")},validateUsername:function(e){t.common.validateUserData(e,"username")},validateEmail:function(e){t.common.validateUserData(e,"email")},validateUserData:function(i,a){var n,r,o,s;switch(a){case"username":emailInput="input.jr-email-check",n="input.jr-user-username",o=e('<input class="jr-valid-username" type="hidden" name="data[valid_username]" value="0" />'),s="_validateUsername";break;case"email":r="input.jr-user-username",n="input.jr-email-check",o=e('<input class="jr-valid-email" type="hidden" name="data[valid_email]" value="0" />'),s="_validateEmail"}var d=i.find(n),l=e('<span class="jrSuccess" style="padding:3px 8px;"></span>'),c=e('<span class="jrError" style="padding:3px 8px;"></span>');""!==d.val()&&d.data("default",d.val()),i.off("focusout",n).on("focusout",n,function(){var n=e(this),d={value:n.val()},u=e('<span class="jrLoadingSmall"></span>');o.remove(),l.remove(),c.remove(),n.next("span").remove(),"email"==a&&i.find(r).length&&""==i.find(r).val()||("username"==a&&i.find(emailInput).length&&""!==i.find(emailInput).val()&&i.find(emailInput).trigger("focusout"),""!==n.val()&&""!==n.data("default")&&n.val()!==n.data("default")&&(n.after(u),t.dispatch({method:"get",type:"json",controller:"users",action:s,data:d}).done(function(e){u.remove(),e.success?(n.after(l.html(e.text)),i.append(o.val(1))):(n.after(c.html(e.text)),i.append(o.val(0)))})))})},userAutocomplete:function(i){var a=i.find("input.jr-user-autocomplete"),n={target_userid:"jr-user-id-ac",target_name:"jr-user-name-ac",target_username:"jr-user-username-ac",target_email:"jr-user-email-ac"};if(""===a.val()){var r=i.find("."+n.target_userid).val();if(Number(r)>0){var o=t.dispatch({method:"get",type:"text",controller:"users",action:"_getUsername",data:{id:r}});o.done(function(e){a.val(e)})}}a.autocomplete({source:function(e,i){var n=a.data("cache")||{},r=e.term;if(r in n)return void i(n[r]);var o=t.dispatch({method:"get",type:"json",controller:"users",action:"_getList",data:{q:r}});o.done(function(e){n[r]=e,a.data("cache",n),i(e)})},select:function(e,t){i.find("."+n.target_userid).val(t.item.id),i.find("."+n.target_email).val(t.item.email),i.find("."+n.target_name).val(t.item.name),i.find("."+n.target_username).val(t.item.username)},minLength:2}),e(".ui-autocomplete").addClass("jrAutoComplete")},listingAutocomplete:function(i,a){var n=a.acfield||i.find("input.jr-listing-autocomplete"),r={target_listingid:"jr-listing-id-ac",target_title:"jr-listing-title-ac",target_alias:"jr-listing-alias-ac",target_url:"jr-listing-url-ac",target_cat:"jr-listing-cat-ac",target_type:"jr-listing-type-ac",target_dir:"jr-listing-dir-ac"},o=i.find("."+r.target_listingid).val(),s=i.find("."+r.target_dir).val(),d=i.find("."+r.target_cat).val(),l=i.find("."+r.target_type).val();if(""===n.val()&&Number(o)>0){var c=t.dispatch({frontend:!0,method:"get",type:"json",controller:"listings",action:"_getList",data:{id:o}});c.done(function(e){a.onSelect?a.onSelect(n,e[0]):n.val(e[0].value)})}n.on("blur",function(){""===n.val()&&i.find("."+r.target_listingid+", ."+r.target_title+", ."+r.target_alias+", ."+r.target_url).val("")}).autocomplete({source:function(e,i){var a=n.data("cache")||{},r=e.term;if(r in a)return void i(a[r]);var o=t.dispatch({frontend:!0,method:"get",type:"json",controller:"listings",action:"_getList",data:{search:r,dir:s,cat:d,type:l}});o.done(function(e){a[r]=e,n.data("cache",a),i(e)})},select:function(e,t){i.find("."+r.target_listingid).val(t.item.id),i.find("."+r.target_title).val(t.item.value),i.find("."+r.target_alias).val(t.item.alias),i.find("."+r.target_url).val(t.item.url),a.onSelect&&a.onSelect(n,t)},minLength:2}),e(".ui-autocomplete").addClass("jrAutoComplete")}},t.search={submit_delay:150,submit_delay_enter:600,liveSearch_timer:null,liveSearch_timeout:200,pageUpdateRequest:null,simple:function(){e("form.jr-simple-search").on("click","button.jr-search",function(){e(this).closest("form").attr("action",s2AjaxUri).submit()})},advancedPage:function(){var i=e("#jr-form-adv-search"),a=i.find(".jr-listing-type-outer"),n=e('<div class="jrRoundedPanel" style="text-align:center;"><span class="jrLoadingMedium" style="display:inline;padding:20px;"></span>'+t.__t("LOADING")+"</div>");i.attr("action",s2AjaxUri).on("click","button.jr-search",function(a){a.preventDefault(),e(this).trigger("jrBeforeSearch"),setTimeout(function(){i.submit()},t.search.submit_delay)}),t.search.searchRange(i),i.on("change","select.jr-listing-type,input.jr-listing-type",function(i){i.preventDefault();var r=e(this),o=r.closest("form"),s=r.val(),d=o.find("div.jr-search-fields");return 0===parseInt(s,10)?(d.fadeOut(),!1):(n.insertAfter(a),submittingAction=t.dispatch({method:"get",type:"html",controller:"search",action:"_loadForm",data:{criteria_id:s}}),void submittingAction.done(function(e){d.html(e);var t=d.jreviewsFields({page_setup:!0,referrer:"adv_search"});t?t.done(function(){n.remove(),o.trigger("jrSearchFormLoaded"),d.show(),d.jrApplyFieldOptionLayout()}):n.remove()}))});var r=i.find("input.jr-listing-type").val();r>0&&i.find("input.jr-listing-type").trigger("change")},requestResults:function(a,n,r){return clearTimeout(t.search.liveSearch_timer),""!==e.jrGetSelected()?!1:void(t.search.liveSearch_timer=setTimeout(function(){if(r&&n.html('<div class="jrLoadingMedium"></div>').show(),t.search.loadingResults!==i&&t.search.loadingResults.abort(),a.is("input")&&""==a.val())n.hide();else{var e=a.is("input")?[{name:"data[keywords]",value:a.val()},{name:"data[referrer]",value:"submitListing"}]:a.find(':not([name="data[controller]"],[name="data[action]"])').serializeArray();t.search.loadingResults=t.dispatch({method:"get",controller:"categories",action:"liveSearch",data:e}),t.search.loadingResults.done(function(e){""!=e?n.html(e).show():n.hide()})}},t.search.liveSearch_timeout))},advancedModule:function(){"function"==typeof e().jrFiltersPanel&&e(".jr-list-show-filters").length>0&&e(".jr-filters-module").jrFiltersPanel(),e("form.jr-form-adv-search-module").each(function(){var a,r=e(this),o=r.data("module-id"),s=1==r.data("filters");t.search.searchRange(r),r.attr("action",s2AjaxUri).on("click","button.jr-search",function(i){i.preventDefault(),e(this).trigger("jrBeforeSearch"),setTimeout(function(){r.submit()},t.search.submit_delay)}).find("input[type=text]").on("keydown",function(i){if(13==i.keyCode&&(i.preventDefault(),1!==r.data("live-search"))){e(this).trigger("jrBeforeSearch");var a=e(this).data("jrGeolocation")===!0?t.search.submit_delay_enter:t.search.submit_delay;setTimeout(function(){r.submit()},a)}});try{var d=r.jreviewsFields({page_setup:!0,recallValues:!1,context:{dir:r.find('[name="data[dir]"]').val()||"",cat:r.find('[name="data[categories]"]').val()||"",listing_type:r.find('[name="data[Search][criteria_id"]').val()||""},referrer:s?"filtering":"adv_search_module",autocomplete:1==s?0:1});d.done(function(){s||r.jrApplyFieldOptionLayout()})}catch(l){console.log("JReviews fields.js not loaded")}if(s){r.find("[data-display-as]").not('[name^="data[Field]"]').jrFilterTransformer(),r.find(".jr-filters-reset").on("click",function(e){e.preventDefault(),r.find('[data-display-as]:not([name="data[categories]"],[name="data[Search][criteria_id]"])').jrFilterTransformer("reset"),r.trigger("onAdvancedFiltering")});var c=!0,u=[];r.on("jrListingFieldsLoaded",function(){r.find(':input:not([type="hidden"])').each(function(){e(this).attr("name")!==i&&u.push({name:e(this).attr("name"),value:r.find('[name="'+e(this).attr("name")+'"]').val()})})}),r.on("onAdvancedFiltering",function(o,s){var d=s!==i&&1==s.data("reload")?!0:!1,l=1==r.data("live-search")&&!d&&e(".jr-page.jrListings").length;c&&(c=!1,window.history.replaceState({url:document.location.href,form:{id:r.data("moduleId"),data:u}},null,document.location.href)),l?(r.find('[name="data[order]"]').val(t.search.getSortValue()),n.addClass("jrIsLoading"),e(this).trigger("jrBeforeSearch"),setTimeout(function(){t.search.pageUpdateRequest&&t.search.pageUpdateRequest.abort(),a=r.find(':not([name="data[controller]"],[name="data[action]"])').serializeArray(),t.search.pageUpdateRequest=t.dispatch({method:"get",controller:"categories",action:"liveFilter",data:a}),t.search.pageUpdateRequest.done(function(a){var n=[];r.find(':input:not([type="hidden"])').each(function(){e(this).attr("name")!==i&&n.push({name:e(this).attr("name"),value:r.find('[name="'+e(this).attr("name")+'"]').val()})}),t.pageNav.updatePage(a,{push:!1,scroll:r.data("update-scroll")||0,form:{id:r.data("moduleId"),data:n}})})},t.search.submit_delay)):(e(this).trigger("jrBeforeSearch"),setTimeout(function(){r.submit()},t.search.submit_delay))}),r.find('select,input[type="text"],input[type="number"]').on("change",function(t){var i=e(t.target);i.data("isControlled")===!0&&i.data("isActive")===!1||r.trigger("onAdvancedFiltering",[i])})}else t.search.liveSearch(r,{id:o})})},getSortValue:function(){for(var e=window.location.search.substring(1),t=e.split("&"),i=0;i<t.length;i++){var a=t[i].split("=");if("order"==a[0])return a[1]}},liveSearch:function(a,n){var r=n.id||"";inputs=a.is("input")?a:a.find("input[type=text]"),SelectsRadiosCheckboxes=a.find("select,input[type=radio],input[type=checkbox]"),beforeDiv=null;var o={enabled:1,auto_hide:1,popup:1,display_event:"keyup",show_loading:!0};e.extend(o,a.data("searchSettings")||{});var s=e(e(".jrAdvSearchSuggest.jr-live-search"+r).length?".jrAdvSearchSuggest.jr-live-search"+r:'<div class="jrAdvSearchSuggest jr-live-search'+r+'"></div>');a.on("onLiveSearch",function(){function n(){var e=c.offset(),t=c.outerWidth();e.top+=c.outerHeight()+1,s.css(e),s.css("width",t)}var r=a.data("live-search")!==i?a.data("live-search"):o.enabled,d=a.data("live-search-hide")!==i?a.data("live-search-hide"):o.auto_hide;if(!r)return!1;var l=e(this),c=l.parent();o.popup?s.appendTo("body"):s.insertAfter(a),o.popup&&(n(),window.onresize=n),t.search.requestResults(l,s,o.show_loading),d&&e(document).on("mousedown",function(e){c.is(e.target)||0!==c.has(e.target).length||s.is(e.target)||0!==s.has(e.target).length||s.hide()}),s.on("click",".jr-close-live-results",function(){s.hide()})}),a.is("input")&&a.on("focusin",function(){s.hide()}),inputs.on(o.display_event,function(){a.trigger("onLiveSearch")}),a.on("change",".jr-date",function(){a.trigger("onLiveSearch")}),SelectsRadiosCheckboxes.on("change",function(){a.trigger("onLiveSearch")})},searchRange:function(t){t.on("change","select.jr-search-range",function(){var t=e(this),i=t.parent().find("span").last();"between"==t.val()?i.show():i.hide().find("input").val("")})}},t.popup=function(){e(".jr-more-info").not("jr-ready").jrPopup({className:"jrPopup",delay:150}).addClass("jr-ready")},t.showmore=function(){e(".jr-show-more").not("jr-ready").jrShowMore().addClass("jr-ready")},t.trix=function(){document.addEventListener("trix-file-accept",function(e){e.preventDefault()})},t.formbuilder=function(){a.on("onListingFormLoaded onReviewFormLoaded",function(){try{console.log("Bootstrapping FormBuilder Field"),a.find("[jr-formbuilder]").each(function(){new jreviewsFormBuilder(e(this)).initialize()})}catch(t){console.log("FormBuilder bootstrapping failed.")}})},t.calendar={init:function(){e(".jr-module-calendar").not(".jr-ready").addClass("jr-ready").each(function(){var i=e(this),a=i.find(".jr-module-calendar-container"),n=i.data("options"),r={start_field:n.start_field,end_field:n.end_field,start_date:n.start_date,end_date:n.end_date,hide_past:n.hide_past};moment.locale(t.locale);var o=t.dispatch({method:"get",type:"json",controller:"module_calendar",action:"_getEvents",data:r});o.done(function(o){if(!o.success||!o.results.length)return!1;var s=[];e.each(o.results,function(e,t){s.push("0000-00-00 00:00:00"!==t.Field[n.end_field]?{start:t.Field[r.start_field],end:t.Field[r.end_field],id:t.Listing.id}:{date:t.Field[r.start_field],id:t.Listing.id})});var d=Hogan.compile(e("#jr-module-calendar-template-"+n.module_id).html());a.clndr({events:s,multiDayEvents:{startDate:"start",endDate:"end",singleDay:"date"},ready:function(){parseInt(n.autoload)&&i.find(".today.event").trigger("click")},clickEvents:{click:function(e){e.events.length&&t.calendar.listings(i,n,e.events)}},render:function(e){return d.render(e)},constraints:{startDate:r.start_date,endDate:r.end_date},adjacentDaysChangeMonth:!1,forceSixRows:!1})})})},listings:function(i,a,n){listing_ids=[],e.each(n,function(e,t){listing_ids.push(t.id)}),listing_ids=listing_ids.join(","),params={module_id:Math.floor(1e4*Math.random()),referrer:"calendar",ajax_init:!0,module:{listing_order:a.listing_order,summary:a.summary,summary_words:a.summary_words,show_category:a.show_category,fields:a.fields,editor_rating:a.editor_rating,user_rating:a.user_rating,columns:a.columns,show_numbers:a.show_numbers,tmpl_suffix:a.listings_tmpl_suffix,tn_show:a.tn_show,tn_position:a.tn_position,tn_mode:a.tn_mode,tn_size:a.tn_size,listing:listing_ids,module_total:50,module_limit:50}};var r=t.dispatch({method:"get",type:"html",controller:"module_listings",action:"index",data:params});r.done(function(e){i.find(".jr-module-calendar-listings").html("").append(e)})}}}(jQuery,jreviews),function(e){e.jrGetSelected=function(){var e="";return window.getSelection?e=window.getSelection().toString():document.getSelection?e=document.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),e}}(jQuery),function(e){e.jrDialog=function(t,i){e("div.jr-dialog").dialog("destroy").remove();var a={},n=e('<div class="jr-dialog jrDialogContent jrHidden"></div>');a={title:"",width:"640px",height:"auto",dialogClass:"jrDialog",resizable:!1,modal:!0,autoOpen:!0,position:"center",lightbox:!1},a=e.extend(a,i),1==jreviews.mobi&&(a.maxWidth=a.width,a.width="95%",a.position="center top"),""===e.trim(t)&&(t=jreviews.__t("PROCESS_REQUEST_ERROR"),a.buttons={}),n.html(t),n.dialog(a),1==a.lightbox&&(n.closest(".ui-dialog").find(".ui-dialog-titlebar").remove(),e("body").on("click",function(t){0==e(t.target).closest(".ui-dialog").length&&e("div.jr-dialog").dialog("destroy").remove()}));var r=e(".ui-dialog-buttonpane");"function"==typeof jQuery().button&&r.find("button").button("destroy"),1==jreviews.mobi&&r.find(".ui-dialog-buttonset").css("float","left");var o=r.find("button:contains("+jreviews.__t("DELETE")+")"),s=r.find("button:contains("+jreviews.__t("SUBMIT")+")"),d=r.find("button:contains("+jreviews.__t("CANCEL")+")");return o.addClass("jr-submit jrButton").prepend('<span class="jrIconDelete"></span>'),s.addClass("jr-submit jrButton").prepend('<span class="jrIconSave"></span>').on("click",function(){e(this).prop("disabled",!0).find("span").removeClass("jrIconSave").addClass("jrButtonSpinner")}),d.addClass("jr-cancel jrButton").prepend('<span class="jrIconCancel"></span>'),n.on("failedValidation",function(){s.prop("disabled",!1).find("span").removeClass("jrButtonSpinner").addClass("jrIconSave")}),n},e.jrAlert=function(t,i){e("div.jr-alert").dialog("destroy").remove();var a=e('<div class="jr-alert">'+t+"</div>"),n={title:"",width:"400px",height:"auto",dialogClass:"jrDialog",resizable:!1,modal:!0,autoOpen:!0,position:"center",buttons:{}};i=e.extend(n,i),i.buttons[jreviews.__t("CLOSE")]=function(){e(this).dialog("close")},1==jreviews.mobi&&(i.maxWidth=i.width,i.width="95%",i.position="center top"),a.dialog(i)}}(jQuery),function(e){e.getCSS=function(t,i){e(document.createElement("link")).attr({href:t,media:i||"screen",type:"text/css",rel:"stylesheet"}).appendTo("head")}}(jQuery),function(e){e.fn.jrScrollTo=function(t,i){var a=e.extend({},e.fn.jrScrollTo.defaults,t),n=e(this).offset().top+a.offset;return e("html,body").animate({scrollTop:n},a.duration,a.easing,i),e(this)},e.fn.jrScrollTo.defaults={offset:-30,duration:1e3,easing:"swing"}}(jQuery),function(e){e.fn.tinyMCE=function(){var t=this,i=1e3;try{setTimeout(function(){if("object"==typeof tinyMCE){if("object"!=typeof tinyMCEPreInit||e.isEmptyObject(tinyMCEPreInit))return"undefined"==typeof WFEditor&&"object"==typeof tinyMCE.settings&&(tinyMCE.settings.height=null),t.each(function(){tinyMCE.execCommand("mceAddEditor",!1,this.id)});var i="mceInit"in tinyMCEPreInit?tinyMCEPreInit.mceInit["jr-editor"]:!1,a="qtInit"in tinyMCEPreInit?tinyMCEPreInit.qtInit["jr-editor"]:!1;e(".jr-wysiwyg-editor").each(function(){var t=e(this).attr("id");if(a){var n=e.extend({},a,{id:t});tinyMCEPreInit.qtInit[t]=n,quicktags(n),QTags._buttonsInit()}if(i){var r=e.extend({},i,{selector:"#"+t});tinyMCEPreInit.mceInit[t]=r,tinyMCE.init(r)}})}},i)}catch(a){console(a)}},e.fn.RemoveTinyMCE=function(){var e=this;try{if("object"==typeof tinyMCE)return e.each(function(){tinyMCE.execCommand("mceRemoveEditor",!0,this.id)})}catch(t){}},e.fn.SaveTinyMCE=function(){var e=this;try{if("object"==typeof tinyMCE)return e.each(function(){tinyMCE.get(this.id).save()})}catch(t){}}}(jQuery),function(e){var t=function(t,i){this.elem=t,this.$elem=e(t),this.options=e.extend({},e.fn.jrShowMore.options,i),this.init()};t.prototype={init:function(){var t=this,i=t.$elem.data("characters"),a=t.$elem.data("separator");void 0!==i&&parseInt(i,10)>0&&(t.options.characters=i),void 0!==a&&(t.options.separator=a),t.elemTextOrig=t.$elem.html().trim(),t.elemText=t.$elem.text().trim(),t.elemLength=t.elemText.length,t.elemLength>t.options.characters+t.options.separator.length&&(t.elemTextMain=t.elemText.substring(0,t.options.characters),t.elemTextMainHTML='<span class="jrShowMain">'+t.elemTextMain+"</span>",t.elemTextSeparatorHTML='<span class="jrShowMoreSeparator">'+t.options.separator+"</span>",t.elemTextMoreHTML='<span class="jrShowMore" style="display: none;">'+t.elemTextOrig+"</span>",t.elemTextMoreLink='<a class="jrShowLink" href="#">'+t.options.showMoreText+"</a>",t.$elem.html(t.elemTextMainHTML+t.elemTextSeparatorHTML+t.elemTextMoreHTML+" "+t.elemTextMoreLink),t.$elem.on("click","a",function(i){i.preventDefault();var a=e(this);a.hasClass("jrShowLink")?a.html(t.options.hideMoreText).removeClass("jrShowLink").addClass("jrHideLink"):a.html(t.options.showMoreText).removeClass("jrHideLink").addClass("jrShowLink"),t.$elem.find(".jrShowMain, .jrShowMoreSeparator, .jrShowMore").toggle()}))}},e.fn.jrShowMore=function(e){return this.each(function(){new t(this,e)})},e.fn.jrShowMore.options={showMoreText:jreviews.__t("SHOW_MORE"),hideMoreText:jreviews.__t("HIDE_MORE"),separator:"...",characters:250}}(jQuery),function(e){var t=function(t,i){this.elem=t,this.$elem=e(t),this.options=e.extend({},e.fn.jrPopup.options,i),this.init()};t.prototype={init:function(){var t=this;t.popupDiv=t.$elem.next("."+t.options.className),t.popupDiv.length&&(""!==e.trim(t.popupDiv.html())||t.popupDiv.hasClass("jr-ajax"))&&(t.$popupDiv=e(t.popupDiv),t.$elem.hover(function(){t.show()},function(){t.hide()}),t.$elem.click(function(){t.hide()}),t.$popupDiv.hover(function(){t.show()},function(){t.hide()}))},show:function(){var e=this;e.options.onBeforeShow&&e.options.onBeforeShow();var t=e.getPosition();e.$popupDiv.stop(!0,!0),e.clearTimeouts(),e.showTimeout=setTimeout(function(){e.$popupDiv.appendTo("body").css({top:t.top,left:t.left}),e.$popupDiv.fadeIn(100)},300)},hide:function(){var t=this;t.clearTimeouts(),t.showTimeout=setTimeout(function(){e(t.popupDiv).fadeOut(100,function(){t.$elem.after(e(this))})},t.options.delay)},clearTimeouts:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0),this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0)},getPosition:function(){{var e=this.$elem.offset().top,t=this.$elem.offset().left,i=this.$elem.outerWidth();this.$elem.outerHeight()}return{left:t+i/2-this.$popupDiv.outerWidth()/2+"px",top:e-this.$popupDiv.outerHeight()-20+"px"}}},e.fn.jrPopup=function(e){return this.each(function(){new t(this,e)})},e.fn.jrPopup.options={className:"jrPopup",delay:300}}(jQuery),function(e){var t=function(e){if("string"!=typeof e)throw"sprintf: The first arguments need to be a valid format string.";for(var t=new RegExp(/%(\+)?([0 ]|'(.))?(-)?([0-9]+)?(\.([0-9]+))?([%bcdfosxX])/g),i=[],a=1;part=t.exec(e);){if(a>=arguments.length)throw"sprintf: At least one argument was missing.";i[i.length]={begin:part.index,end:part.index+part[0].length,sign:"+"==part[1],negative:parseInt(arguments[a])<0?!0:!1,padding:void 0==part[2]?" ":"'"==part[2].substring(0,1)?part[3]:part[2],alignLeft:"-"==part[4],width:void 0!=part[5]?part[5]:!1,precision:void 0!=part[7]?part[7]:!1,type:part[8],data:"%"!=part[8]?String(arguments[a++]):!1}}for(var n="",r=0,o=0;o<i.length;++o){n+=e.substring(r,i[o].begin),r=i[o].end;var s="";switch(i[o].type){case"%":s="%";break;case"b":s=Math.abs(parseInt(i[o].data)).toString(2);break;case"c":s=String.fromCharCode(Math.abs(parseInt(i[o].data)));break;case"d":s=String(Math.abs(parseInt(i[o].data)));break;case"f":s=0==i[o].precision?String(Math.abs(parseFloat(i[o].data))):Math.abs(parseFloat(i[o].data)).toFixed(i[o].precision);break;case"o":s=Math.abs(parseInt(i[o].data)).toString(8);break;case"s":s=i[o].data.substring(0,i[o].precision?i[o].precision:i[o].data.length);break;case"x":s=Math.abs(parseInt(i[o].data)).toString(16).toLowerCase();break;case"X":s=Math.abs(parseInt(i[o].data)).toString(16).toUpperCase();break;default:throw'sprintf: Unknown type "'+i[o].type+'" detected. This should never happen. Maybe the regex is wrong.'}if("%"!=i[o].type){if(0!=i[o].width&&i[o].width>s.length)for(var d=s.length,l=0;l<i[o].width-d;++l)s=1==i[o].alignLeft?s+i[o].padding:i[o].padding+s;("b"==i[o].type||"d"==i[o].type||"o"==i[o].type||"f"==i[o].type||"x"==i[o].type||"X"==i[o].type)&&(1==i[o].negative?s="-"+s:1==i[o].sign&&(s="+"+s)),n+=s}else n+=s}return n+=e.substring(r,e.length)};e.sprintf=t,String.prototype.printf=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(String(this)),t.apply(void 0,e)}}(window),function(e){e.widget("jreviews.buttongroup",{buttons:{},classes:{buttonGroup:"jrButtonGroup",button:"jrButton",selected:"jrBlue"},_create:function(){var t=this,i=t.element,a=t.classes;i.hide();var n=e('<div class="'+a.buttonGroup+'">');i.find("option").each(function(r){var o=e(this),s=e('<div class="'+a.button+'">').html(o.text()).data("index",r),d=o.data("icon");d&&s.prepend('<span class="'+d+'">'),s.on("click",function(){i.find("option:eq("+e(this).data("index")+")").prop("selected",!0),o.trigger("change")}),t.buttons[r]=s,""!==o.val()&&n.append(s)}),i.on("change",function(){n.find("."+a.button).removeClass(a.selected),t.buttons[i.find("option:selected").index()].addClass(a.selected)}),n.insertBefore(i)},_init:function(){var e=this,t=e.element;t.trigger("change")},destroy:function(){e.Widget.prototype.destroy.call(this)}})}(jQuery);!function(e){jreviewsCompare={numberOfListingsPerPage:3,maxNumberOfListings:15,compareURL:"index.php?option=com_jreviews&url=categories/compare/id:listing_ids/",lang:{compare_heading:jreviews.__t("COMPARE_HEADING"),compare_all:jreviews.__t("COMPARE_COMPARE_ALL"),remove_all:jreviews.__t("COMPARE_REMOVE_ALL"),select_more:jreviews.__t("COMPARE_SELECT_MORE"),select_max:jreviews.__t("COMPARE_SELECT_MAX")},listingTypeID:null,init:function(){jreviewsCompare.set({numberOfListingsPerPage:jreviews.comparison.numberOfListingsPerPage,maxNumberOfListings:jreviews.comparison.maxNumberOfListings,compareURL:jreviews.comparison.compareURL}),jreviewsCompare.initComparePage(),jreviewsCompare.initCompareDashboard(),jreviewsCompare.initListingsSelection(),e(document).on("jreviews-onAfterAjaxUpdate",function(e,i){jreviewsCompare.refresh(i)})},refresh:function(i){var r=e(".jrCompareTabs");r.data("ui-tabs")&&r.find("ul.jrTabsNav li a").each(function(){var r=e(this),t=r.attr("href"),a=t.substring(t.indexOf("#"));r.attr("href",i+a)})},set:function(i){void 0!==i&&e.extend(jreviewsCompare,i)},initComparePage:function(){var i,r,t=e(".jr-compareview"),a=e(".jr-compare-slider"),s=a.find(".jr-compare-slider-items"),o=e(".jr-compare-slider-secondary"),n=o.find(".jr-compare-slider-items2"),l=s.find(".jr-compare-slider-item"),p=e(".jrScrollbarArea"),m=e(".jr-compare-slider-item").length;t.width(t.parent().width()),i=m>=jreviewsCompare.numberOfListingsPerPage?a.width()/jreviewsCompare.numberOfListingsPerPage:a.width()/m,r=i*m,l.width(i),s.width(r),n.width(r),a.scroll(function(){o.scrollLeft(a.scrollLeft())}),o.scroll(function(){a.scrollLeft(o.scrollLeft())}),m>jreviewsCompare.numberOfListingsPerPage&&(p.removeClass("jrHidden"),a.removeClass("jrSliderDisabled"),o.removeClass("jrSliderDisabled"),t.hasClass("jrCompareViewMenu")||e(".removeComparedListing").removeClass("jrHidden"),a.find(".jr-compare-slider-item").hover(function(){{var r=e(this),t=r.data("listingid");r.width()}r.on("click","img.removeListing",function(){r.fadeOut("slow",function(){r.remove();var l=i*e("div.jr-compare-slider-item").length,m=e(".jr-compare-slider-item").length;s.width(l),n.width(l),m<=jreviewsCompare.numberOfListingsPerPage&&(p.addClass("jrHidden"),a.addClass("jrSliderDisabled"),o.addClass("jrSliderDisabled"),a.find(".removeComparedListing").addClass("jrHidden")),e("span#removelisting"+t).trigger("click")})})})),jreviewsCompare.fixCompareAlignment()},fixCompareAlignment:function(){function i(i){tallest=0,i.each(function(){thisHeight=e(this).height(),thisHeight>tallest&&(tallest=thisHeight)}),i.height(tallest)}function r(r){r.each(function(){var r=e(this).attr("class").split(" ").slice(0,1);i(e("div."+r))})}var t=e("div.jr-compare-slider-item div.jrCompareField");r(t)},initCompareDashboard:function(){e("body").append('<div class="jrCompareDashboard"><div class="jrCompareHeader"><div class="jrCompareArrow"></div></div><div class="jrCompareTabs"></div></div>'),e(".jrCompareTabs").append('<div class="jrCompareTitle">'+jreviewsCompare.lang.compare_heading+'</div><ul class="jrTabsNav"></ul><div class="jrTabsContainer"></div>'),e(".jrCompareHeader, .jrCompareTitle, ul.jrTabsNav").hover(function(){e(this).css("cursor","pointer")}).click(function(){e(".jrCompareTabs .jrTabsContainer").slideToggle("slow",function(){var i=e(".jrCompareArrow");e(this).is(":visible")?i.addClass("down"):i.removeClass("down")})});var i=e(".jrCompareDashboard"),r=jreviewsCompare.getListingsFromStorage();e.isEmptyObject(r)||(i.slideDown("slow"),e.each(r,function(i){var t=!1,a=i.substring(11);e.each(r[i],function(e,i){t||(jreviewsCompare.insertTab(i),t=!0),jreviewsCompare.insertListingIntoComparison(i),jreviewsCompare.updateCompareAllUrl(i)}),e("#tabLT"+a+" li.ltItem").length>4&&e("#tabLT"+a+" a.compareNext").css("visibility","visible")})),i.on("click","span.removeItem",function(){var i=e(this).attr("id"),r={id:i.substring(13),typeId:e(this).text()};e("input.listing"+r.id).prop("checked",!1),jreviewsCompare.removeListingFromComparison(r)}),i.on("click","a.removeListings",function(i){i.preventDefault();var r=e(this).parent().attr("id"),t=r.substring(9),a=e("#tabLT"+t+" li.ltItem:first-child span.removeItem").attr("id").substring(13),s={id:a,typeId:t},o=e('.jrCheckListing[data-listingtypeid="'+t+'"]');o.prop("checked",!1),jreviewsCompare.removeTab(s)}),i.on("click","a.compareListings",function(i){i.preventDefault();var r=e(this).parent().attr("id").substring(9),t=e("div#tabLT"+r+" ul.ltList li").length;if(2>t)""!==e("p.comparisonMessage."+r).val()&&(e("div#tabLT"+r).append('<p class="comparisonMessage '+r+' jrPopup">'+jreviewsCompare.lang.select_more+"</p>"),e("p.comparisonMessage").hide().fadeIn("slow",function(){setTimeout(function(){e("p.comparisonMessage").fadeOut("slow",function(){e(this).remove()})},3e3)}));else{var a=e(this).attr("href");window.location.href=a}}),e("ul.jrTabsNav").on("click","a",function(i){i.stopPropagation();var r=e(".jrTabsContainer");r.is(":hidden")&&r.slideDown("slow")})},insertTab:function(i){var r=i.typeId,t=i.typeTitle,a=e(".jrCompareTabs");a.data("ui-tabs")&&a.tabs("destroy"),e(".jrCompareTabs ul.jrTabsNav").append('<li><a href="#tabLT'+r+'" class="listingTypeCompare jrCompare'+r+'">'+t+' <span class="numSelected">(0)</span></a></li>'),e(".jrCompareTabs .jrTabsContainer").append('<div id="tabLT'+r+'" class="ui-helper-clearfix"><div class="jrCompareScroll"><ul class="ltList"></ul></div></div>'),compareURL=jreviewsCompare.compareURL.replace("listing_ids",i.id);var s='<a rel="nofollow" href="'+compareURL+'" class="compareListings jrButton jrSmall listingType'+r+'"><span class="jrIconCompare"></span>'+jreviewsCompare.lang.compare_all+"</a>",o='<a href="#" class="removeListings jrButton jrSmall listingType'+r+'"><span class="jrIconRemove"></span>'+jreviewsCompare.lang.remove_all+"</a>";e(".jrTabsContainer #tabLT"+r).append('<div id="jrCompare'+r+'" class="jrCompareButtons">'+s+o+"</div>");var n=e(".jrCompareTabs ul.jrTabsNav li").length,l=e("base").attr("href");void 0!==l&&l.length&&a.find('ul.jrTabsNav li a:not(".jrBaseUpdated")').each(function(){e(this).addClass("jrBaseUpdated").attr("href",e(location).attr("href")+e(this).attr("href"))}),a.tabs({selected:n-1})},removeTab:function(i){var r=e(".jrCompareDashboard"),t=e(".jrCompareTabs"),a=t.tabs("option","selected"),s=t.tabs("length");s>1?(e("ul.jrTabsNav li.ui-tabs-active").fadeOut("slow",function(){t.tabs("remove",a)}),t.tabs("destroy"),t.tabs(a>0?{selected:a-1}:{selected:0})):r.slideUp("slow",function(){t.tabs("remove",a),t.tabs("destroy")}),jreviewsCompare.removeListingTypeFromStorage(i)},insertListingIntoComparison:function(i){i.thumb=i.thumbSrc.length?'<div class="compareThumb"><a href="'+i.url+'"><img src="'+i.thumbSrc+'" /></a></div>':"",i.titleUrl='<a href="'+i.url+'">'+i.title+"</a>",e("div#tabLT"+i.typeId+" ul").append('<li id="listing'+i.id+'" class="ltItem"><span id="removelisting'+i.id+'" data-jricon="&#xe018;" class="removeItem">'+i.typeId+"</span>"+i.thumb+'<span class="compareItemTitle">'+i.titleUrl+"</span></li>"),e("input.listing"+i.id).prop("checked",!0);var r=jreviewsCompare.getNumberOfSelectedListings(i.typeId);r++,e(".jrCompareTabs a.jrCompare"+i.typeId+" span.numSelected").html("("+r+")")},removeListingFromComparison:function(i){e(".jrCompareTabs");e("li#listing"+i.id).siblings().length>0?(e("li#listing"+i.id).fadeOut("slow",function(){e(this).remove()}),jreviewsCompare.updateNumberOfSelectedListings(i.typeId,-1),jreviewsCompare.removeListingFromStorage(i),jreviewsCompare.updateCompareAllUrl(i)):jreviewsCompare.removeTab(i)},initListingsSelection:function(){e("body").on("click","input.jrCheckListing",function(){var i={id:e(this).attr("value"),title:e(this).data("listingtitle"),url:e(this).data("listingurl"),thumbSrc:e(this).data("thumburl"),typeId:e(this).data("listingtypeid"),typeTitle:e(this).data("listingtypetitle"),location:e(this).data("location")};i.thumbSrc.length?i.thumb='<div class="compareThumb"><a href="'+i.url+'"><img src="'+i.thumbSrc+'" /></a></div>':(thumb=e("img[data-listingid='"+i.id+"']"),thumb.length?(thumbSrc=thumb.attr("src"),i.thumbSrc=thumbSrc,i.thumb='<div class="compareThumb"><a href="'+i.url+'"><img src="'+thumbSrc+'" /></a></div>'):i.thumb=""),i.titleUrl='<a href="'+i.url+'">'+i.title+"</a>",i.data='<li id="listing'+i.id+'" class="ltItem">'+i.thumb+'<span class="compareItemTitle">'+i.titleUrl+'</span><span id="removelisting'+i.id+'" data-jricon="&#xe018;" class="removeItem">'+i.typeId+"</span></li>";var r,t=e(".jrCompareDashboard"),a=e(".jrCompareTabs"),s=e(".jrTabsContainer"),o=e(".jrCompareArrow");if(e(this).is(":checked")){if(r=e("input.listing"+i.id+":not(:checked)"),e.each(r,function(){e(this).prop("checked",!0)}),e("div#tabLT"+i.typeId).length>0){s.is(":hidden")&&(s.slideDown("slow"),o.addClass("down"));var n=jreviewsCompare.getNumberOfSelectedListings(i.typeId);if(n>=jreviewsCompare.maxNumberOfListings)return""!==e("p.comparisonMessageMax."+i.id).val()&&(e(this).parent().append('<p class="comparisonMessageMax '+i.id+' jrPopup">'+jreviewsCompare.lang.select_max+"</p>"),e("p.comparisonMessageMax").hide().fadeIn("slow",function(){setTimeout(function(){e("p.comparisonMessageMax").fadeOut("slow",function(){e(this).remove()})},3e3)})),!1;e(i.data).appendTo("div#tabLT"+i.typeId+" ul.ltList").hide().fadeIn("slow"),a.tabs("select","#tabLT"+i.typeId)}else s.is(":hidden")&&(s.show(),o.addClass("down")),jreviewsCompare.insertTab(i),e(i.data).appendTo("div#tabLT"+i.typeId+" ul.ltList").hide().fadeIn("slow"),t.is(":hidden")&&t.slideDown("slow");jreviewsCompare.updateNumberOfSelectedListings(i.typeId,1),jreviewsCompare.saveListingToStorage(i),jreviewsCompare.updateCompareAllUrl(i)}else r=e("input.listing"+i.id+":checked"),e.each(r,function(){e(this).prop("checked",!1)}),a.tabs("select","#tabLT"+i.typeId),jreviewsCompare.removeListingFromComparison(i)})},getNumberOfSelectedListings:function(i){var r=e(".jrCompareTabs a.jrCompare"+i+" span.numSelected").html().slice(1,-1);return parseInt(r,10)},updateNumberOfSelectedListings:function(i,r){var t=jreviewsCompare.getNumberOfSelectedListings(i);t+=r,e(".jrCompareTabs a.jrCompare"+i+" span.numSelected").html("("+t+")")},updateCompareAllUrl:function(i){var r=e("a.compareListings.listingType"+i.typeId),t=(r.attr("href"),jreviewsCompare.getListingsFromStorage(i.typeId)),a=[];e.each(t,function(e,i){a.push(i.id)}),a=a.toString();var s=jreviewsCompare.compareURL.replace("listing_ids",a);r.attr("href",s)},saveListingToStorage:function(i){var r=i.typeId,t=i.id,a={};a["listingType"+r]={},a["listingType"+r]["listing"+t]=i;var s=jreviewsCompare.getListingsFromStorage();if(e.isEmptyObject(s))localStorage.setItem("jrCompare",JSON.stringify(a));else{var o=e.extend({},s);o["listingType"+r]=e.extend({},o["listingType"+r],a["listingType"+r]),localStorage.setItem("jrCompare",JSON.stringify(o))}},getListingsFromStorage:function(e){var i={},r="";return r=localStorage.getItem("jrCompare"),""!==r&&"{}"!==r&&(i=JSON.parse(r),void 0!==e&&(i=i["listingType"+e])),i},removeListingFromStorage:function(e){var i=jreviewsCompare.getListingsFromStorage();delete i["listingType"+e.typeId]["listing"+e.id],localStorage.setItem("jrCompare",JSON.stringify(i))},removeListingTypeFromStorage:function(e){var i=jreviewsCompare.getListingsFromStorage();delete i["listingType"+e.typeId],localStorage.setItem("jrCompare",JSON.stringify(i))}}}(jQuery);!function(e){function t(t){var a,i,n,l=!1,o=this,r=t,s=r.find(':input[class^="jr_"]'),d=r.find('fieldset[id^="group_"]'),c=r.find('li[id^="tab_"]'),p={},u=!1;this.getTabs=function(){return c},this.click2add=function(){r.off("click",".jr-click2add-new").on("click",".jr-click2add-new",function(t){t.preventDefault(),e(this).closest("div.jrFieldDiv").find('div.jr-click2add-option:not(".jr-ready")').addClass("jr-ready").toggle(50,function(){e(this).removeClass("jr-ready")})}),r.off("click",".jr-click2add-submit").on("click",".jr-click2add-submit",function(t){t.preventDefault();var a,i,n=e(this),l=n.parent().siblings("select"),o=n.prev(":input"),r=o.val(),s="";!l.data("controlledBy")||l.data("fieldName")in l.data("controlledBy")||e.each(l.data("controlledBy"),function(e,t){a=e,i=t,s="|"+e+"|"+t});var d=encodeURIComponent(r).replace(/'/g,"&#039;")+"|click2add"+s,c=l.children('option[value="'+d+'"]');""!==r&&0===c.length?(l.append(e("<option></option>").attr({value:d,selected:"selected","data-ordering":99999,"data-controlledBy":a,"data-controlValue":i}).text(r)).data("isActive",!0).trigger("change"),o.val("")):1==c.length&&c.prop("selected",!0),n.siblings(".jr_validation").remove()})},this.loadData=function(t){var l={fieldLocation:"Listing",entry_id:null,context:null,value:[],page_setup:0,recallValues:!0,autocomplete:!0,lang:{select_field:jreviews.__t("FIELD_SELECT_FIELD"),no_results:jreviews.__t("FIELD_NO_RESULTS"),instructions:jreviews.__t("FIELD_AUTOCOMPLETE_HELP")}},c={},p=[];if(t=e.extend(l,t),n=t.entry_id,t.page_setup=t.page_setup?1:0,a=t,a.res=a.res||{},void 0!==jreviews.paid&&"Listing"==a.fieldLocation)try{void 0!==a.res.planList?(u=!0,jreviews.paid.plan.planList=a.res.planList,jreviews.paid.plan.plan_selected=a.res.plan_selected||jreviews.paid.plan.plan_selected,jreviews.paid.plan.plan_selected&&r.find('#jr-paid-plan-list :radio[value="'+jreviews.paid.plan.plan_selected+'"]').prop("checked",!0)):"object"==typeof jreviews.paid.plan.planList&&null!==jreviews.paid.plan.plan_selected&&(u=!0)}catch(h){}if(i=d.map(function(){return this.id.replace(/group_/g,"")}),s.each(function(){if("button"!=e(this).prop("type")){var t=e(this).data("selected"),a=e(this).attr("class").split(" ")[0].replace(/[^a-zA-Z0-9_\s]+/g,"").match(/^jr_[a-z0-9]+/).toString();t&&(c[a]=String(t).search("_")>-1?t.split("_"):[t],e(this).removeAttr("data-selected"),e(this).removeData("selected")),-1==e.inArray(a,p)&&p.push(a)}}),p=e.unique(p),p.length){e.isEmptyObject(p)||(t.value=c);var f=jreviews.dispatch({method:"POST",type:"json",data:{"data[controller]":"fields","data[action]":"_loadFieldData","data[entry_id]":t.entry_id,"data[context]":t.context,"data[fields]":p,"data[value]":c,"data[page_setup]":t.page_setup,"data[fieldLocation]":t.fieldLocation,"data[referrer]":t.referrer,"data[autocomplete]":t.autocomplete}});return f.done(function(i){o.processResponse(t.value,t.page_setup,i),u&&(jreviews.paid.plan.controlFieldClass=o,jreviews.paid.plan.formFilter(r)),o.click2add(),"Listing"==a.fieldLocation&&(r.trigger("jrListingFieldsLoaded"),"function"==typeof e().jrFilterTransformer&&e.inArray(a.referrer,["filtering"])>-1&&r.find('[data-display-as][name^="data[Field]"]').jrFilterTransformer().data("plugin_jrFilterTransformer")),"Review"==a.fieldLocation&&r.trigger("jrReviewFieldsLoaded"),r.jrApplyFieldOptionLayout()}),f}return!1},this.getPaidFields=function(){var e=jreviews.paid.plan.planList,t=(r.find("#jr-paid-plan-list"),jreviews.paid.plan.plan_selected);return"object"==typeof e&&null!==t?void 0!==e["plan"+t]?e["plan"+t].fields:[]:void 0},this.getFieldOptions=function(e,t){var a;switch(t){case"select":case"selectmultiple":a=e.children("option");break;default:a=e}return a},this.getFieldObj=function(e){return e in p?p[e]:!1},this.setValidFields=function(t){var a=[];t=t||r,r.find(":input").filter(function(){e(this).closest("fieldset").data("isActive")!==!1&&e(this).data("isActive")===!0&&a.push(e(this).data("fieldName"))});var i=t.find('[name="data[valid_fields]"]');return i.length?i.val(a.join(",")):t.append(e('<input type="hidden" name="data[valid_fields]" />').val(a.join(","))),e.unique(a)},this.getjQueryObj=function(t,i){if(void 0===t.fields||!(i in t.fields))return!1;var n=!1;if(i in p)return p[i];var l=["selectmultiple","checkboxes","relatedlisting"];if(e.inArray(a.referrer,["adv_search_module","filtering"])>-1){var o,s=r.find("."+i);switch(o=s.prop("type")){case"select-one":t.fields[i].type="select";break;case"select-multiple":t.fields[i].type="selectmultiple"}}e.inArray(a.referrer,["adv_search_module","adv_search","filtering"])>-1&&e.inArray(t.fields[i].type,["integer","decimal","date"])>-1&&(n=!0);var d=e.inArray(t.fields[i].type,l)>-1||n,c=':input[name="data[Field]['+t.location+"]["+i+"]"+(d?'[]"]':'"]');return p[i]=r.find(c),p[i]},this.storeValues=function(t,a){{var i=t.data("fieldOptions")||{},n=t.data("fieldType");o.getFieldOptions(t,n)}a=e.isArray(a)?a:[a],e(a).each(function(n,l){l in i&&(e(i[l].dependent_groups).each(function(n,r){e.each(i[l].fields,function(e,n){if(n.group==r&&void 0!==i[a]){var s=o.getjQueryObj(i[a],n.name),d=o.getFieldValue(s);if(s.data("isControlled")===!1||s.data("isControlled")===!0&&s.data("hasControl")===!0){o.debug("6.1 >--- Store current val of "+s.data("fieldName")+"["+d+"] for "+t.data("fieldName")+"["+l+"]");var c=s.data("parentMemory")||[],p=t.data("fieldName")+"."+l;c[p]=d,s.data("parentMemory",c)}s.data("hasControl")===!0&&(o.debug("6.1 >--- Run recursively for ["+s.attr("class").split(" ")[0]+"["+d+"]"),null!==d&&o.storeValues(s,d))}})}),e(i[l].dependent_fields).each(function(e,a){var n=o.getjQueryObj(i[l],a);if(0===n.length)return!0;var r=i[l].fields[a].type;o.debug("6.2 >--- Store current val of "+r+" "+n.data("fieldName")+"["+n.val()+"] for "+t.data("fieldName")+"["+l+"]");var s=n.data("parentMemory")||[],d=t.data("fieldName")+"."+l,c=o.getFieldValue(n);s[d]=c,n.data("parentMemory",s),null!==c&&(o.debug("6.2 >--- Run recursively"),o.storeValues(n,c))}))})},this.getFieldValue=function(e){var t;switch(e.data("fieldType")){case"checkboxes":case"radiobuttons":t=e.filter(":checked").map(function(){return this.value}).get();break;default:t=e.val()}return t},this.clearFieldValue=function(e){switch(e.data("fieldType")){case"checkboxes":case"radiobuttons":e.prop("checked",!1);break;default:e.val("")}return e},this.recallValue=function(t,a,i){var n=t.data("parentMemory")||[],l=a+"."+i;if(void 0!==n[l]){o.debug("** Recall ParentMemory:"+t.data("fieldName")+" = ["+a+":"+i+"] => "+n[l]);var r=t.data("fieldType");e.inArray(r,["checkboxes","radiobuttons"])>-1?t.each(function(){var t=e(this).val();e(this).prop("checked",e.inArray(t,n[l])>-1)}):t.val(n[l]),t.trigger("change")}},this.clearDependents=function(e,t,a){setTimeout(function(){o.clearDependentsDelayed(e,t,a)},100)},this.clearDependentsDelayed=function(t,a,i){var n=t.data("fieldOptions")||{},l=[],r=t.data("fieldType"),s=o.getFieldOptions(t,r);o.debug("5 >--- Clear dependents of "+t.attr("class").split(" ")[0]+"["+a+"]. Event type is "+t.data("eventType")),l=e.isArray(a)?a:[a],e(l).each(function(t,a){a in n&&(e(n[a].dependent_groups).each(function(t,i){o.debug("Hide dependent group: "+i);var l=!0;if(s.each(function(){var t=e(this);n[t.val()]&&(t.is(":checked")||t.is(":selected"))&&e.inArray(i,n[t.val()].dependent_groups)>-1&&(l=!1)}),l){var r=d.filter("fieldset#group_"+i);r.data("isActive",!1).css("display","none"),e.each(n[a].fields,function(e,t){if(t.group==i&&void 0!==n[a]){var l=o.getjQueryObj(n[a],t.name);o.clearFieldValue(l).data("doNotStore",!0).trigger("change")}}),c.length&&c.filter("li#tab_"+i).hide()}}),e(n[a].dependent_fields).each(function(t,l){var d=o.getjQueryObj(n[a],l);if(0===d.length)return!0;var c=n[a].fields[l].type;o.debug("5.0 >--- Clear dependent ["+l+"]["+a+"]["+c+"]");d.val();if(e.inArray(c,["select","selectmultiple"])>-1){o.debug("5.1 >---",c),e(n[a].fields[l].options).each(function(){var t=this.value;if(o.debug(l+"["+c+"]["+t+"]"),e.inArray(r,["checkboxes","selectmultiple"]>-1)){var a=!0;s.each(function(){var i=e(this);n[i.val()]&&(i.is(":checked")||i.is(":selected"))&&e(n[i.val()].fields[l]).each(function(){e(this.options).each(function(){this.value==t&&(a=!1)})})}),a&&(o.debug("5.1.1 >----- Removing field option ["+t+"]"),d.children('option[value="'+t+'"]').remove())}else o.debug("5.1.2 >-----"),d.children('option[value="'+t+'"]').remove();null!==t&&o.clearDependents(d,t)}),d.data("old_val","");var p=d.children("option").length;if("select"==c&&1==p||"selectmultiple"==c&&0===p){var u=d.data("click2add")||0;(0===u||1==u&&d.data("isControlled"))&&d.data("isActive",!1).val("").closest("div.jrFieldDiv").css("display","none")}}else{o.debug("5.2 >--- "+c),d.data("old_val","");var h=!0;e.inArray(r,["checkboxes","selectmultiple"]>-1)?(s.each(function(){var t=e(this);n[t.val()]&&(t.is(":checked")||t.is(":selected"))&&e.inArray(l,n[t.val()].dependent_fields)>-1&&(h=!1)}),h&&o.clearFieldValue(d)):o.clearFieldValue(d),!h||void 0!==i&&void 0!==n[i]&&n[i].dependent_fields.length>0&&e.inArray(l,n[i].dependent_fields)>-1||(o.debug("   ----- Hiding dependent field "+l),d.data("isActive",!1).closest("div.jrFieldDiv").css("display","none"))}d.trigger("change")}))})},this.processResponse=function(t,i,l){if(0!==l.length){if(void 0!==l.responses&&(e.each(l.responses,function(t,a){var i=o.getjQueryObj(l,t);return i?void e.each(a,function(e,a){o.debug("1 >-- Caching response data for "+t+"["+a.control_value+"]");var n=i.data("fieldOptions")||{};n[a.control_value]=a,i.data("fieldOptions",n)}):!0}),i)){o.populateOptions(l);try{var s=r.find(".jrRelatedListing");s.autocompletefield({lookup:"listings",entry_id:n,optionType:s.data("autocompleteType"),optionDivPosition:s.data("autocompletePos")})}catch(d){}}e.each(l.control_field,function(t,i){var n=o.getjQueryObj(l,i);return void 0===l.fields||"text"==l.fields[i].type?!0:n.data("hasControl")!==!1||n.hasClass("jrAutoComplete")?(n.on("change",function(){o.debug("2 >--- Change event triggered for "+i+", id = "+n.attr("class").split(" ")[0]+", "+l.fields[i].type);var t,r="",s=[],d=[],c=n.data("old_val")||(e.inArray(l.fields[i].type,["selectmultiple"])?[]:null);switch(o.debug("   Old val: "+c),l.fields[i].type){case"selectmultiple":if(n.children("option").not(":selected").each(function(){d.push(e(this).val())}),s=n.val(),null===s&&(s=[]),1==s.length)r=s[0];else if(null!==c)for(var p=0;p<s.length;p++)if(-1==e.inArray(s[p],c)){r=n.children('option[value="'+s[p]+'"]').val();break}null===c&&s.length>0&&(r=s);break;case"radiobuttons":case"checkboxes":s=o.getFieldValue(n),e(this).is(":checked")&&(r=e(this).val()),t=e(this).val();break;default:r=n.val()}o.debug("   Sel val: "+r);var u;switch(l.fields[i].type){case"checkboxes":""===r&&(u=t);break;case"selectmultiple":d.length>0&&(u=d);break;default:u=c}var h=n.data("doNotStore")||!1;a.recallValues&&null!==c&&c.length>0&&h===!1&&o.storeValues(n,c),n.data("old_val",s.length?s:r);var f=n.data("fieldOptions")||{};e.isArray(r)?e.each(r,function(e,t){o.processResponsePopulateDependents(n,l,a,f,i,t,u)}):o.processResponsePopulateDependents(n,l,a,f,i,r,u),n.prop("disabled",!1),n.data("doNotStore",!1)}),void(n.hasClass("jrAutoComplete")&&!n.hasClass("jrRelatedListing")&&e.inArray(n.data("fieldType"),["select","selectmultiple"])>-1&&(o.debug(" -> Activate AutoComplete UI for "+i),n.autocompletefield({lookup:"options",optionType:n.data("autocompleteType"),optionDivPosition:n.data("autocompletePos")})))):!0})}},this.processResponsePopulateDependents=function(t,a,i,n,l,s,d){if(cachedResp=null===s||n=={}?null:n[s],o.debug("   Cached response"),o.debug(void 0===cachedResp?"       Not cached":cachedResp),void 0===cachedResp&&""!==s&&null!==s){o.debug(" -> Change Event AJAX"),t.prop("disabled",!0);var c={"data[fields]":l,"data[value]":s,"data[page_setup]":!1,"data[context]":i.context,"data[fieldLocation]":i.fieldLocation,"data[referrer]":i.referrer,"data[autocomplete]":i.autocomplete},p=jreviews.dispatch({method:"GET",type:"json",controller:"fields",action:"_loadFieldData",data:c});p.done(function(e){o.debug("1 >-- Caching data for "+l+"["+s+"]");var i=t.data("fieldOptions")||{};i[s]=e,t.data("fieldOptions",i),t.data("eventType","ajax"),void 0===e.fields&&(e.fields=[]),o.populateOptions(e,a.fields[l],t,d,s),r.trigger("jrAfterFieldChange")})}else e.isEmptyObject(cachedResp)||""===s?(o.debug(" -> Change Event CLEAR"),t.data("eventType","clear"),o.clearDependents(t,d,s),r.trigger("jrAfterFieldChange")):(o.debug(" -> Change Event CACHED"),t.data("eventType","cached"),o.populateOptions(cachedResp,a.fields[l],t,d,s),r.trigger("jrAfterFieldChange"))},this.populateOptions=function(t,n,l,r,s){if(0!==t.length){n=void 0!==n?n:{type:"",name:""},o.debug("4 >--- Populate options for "+n.name+"["+s+"] and we clear it for ["+r+"]"),t.page_setup&&e.each(i,function(a,i){if(-1==e.inArray(i,t.dependent_groups)){var n=d.filter("fieldset#group_"+i),l=0;n.find(":input").each(function(){"hidden"!=e(this).prop("type")&&l++}),l>0&&(n.show(),c.length&&c.filter("li#tab_"+i).show(10))}}),e.each(t.dependent_groups,function(e,a){var i=d.filter("fieldset#group_"+a);i.data("isControlled",!0),t.page_setup?(i.css("display","none").data("isActive",!1),c.length&&c.filter("li#tab_"+a).hide()):(i.show().data("isActive",!0),c.length&&c.filter("li#tab_"+a).show(10))});var p=[];u&&(p=o.getPaidFields(),o.debug("   --- It is a paid listing!"),o.debug(p)),e.each(t.fields,function(i,n){if(o.debug("   --- Populating field "+n.name+"["+n.title+"]["+s+"]"),e.isArray(n.name))return!0;var l,r=o.getjQueryObj(t,n.name);if(l=r.prop("type"),"relatedlisting"!=n.type)switch(l){case"select-one":n.type="select";break;case"select-multiple":n.type="selectmultiple"}r.data("fieldTitle",n.title),0===t.page_setup&&e.inArray(n.type,["select","selectmultiple"])>-1&&r.val(""),t.page_setup&&(r.data("fieldName",n.name),r.data("fieldType",n.type),r.data("orderBy",n.order_by),r.data("hasControl",n.control),r.data("isControlled",n.controlled),r.data("autocompleteType",n.autocompletetype),r.data("autocompletePos",n.autocompletepos));var c=e.inArray(n.group,t.dependent_groups)>-1,h=d.filter("fieldset#group_"+n.group).data("isActive");if(1==t.control_field.length){var f=r.data("controlledBy")||{};if(f[t.control_field[0]]=t.control_value,c||r.data("controlledBy",f),(0===t.page_setup||void 0===t.page_setup)&&"text"==n.type&&n.controlled===!0&&n.controlgroup===!0)return!0}if(void 0===r.data("isActive")&&t.page_setup&&(e.inArray(n.type,["select","selectmultiple","relatedlisting"])>-1&&(n.control===!0&&n.controlled===!0||n.control===!1&&n.controlled===!0||"0"==n.autocomplete&&void 0===n.options)||e.inArray(n.type,["checkboxes","radiobuttons"])>-1&&(n.control===!0&&n.controlled===!0||n.control===!1&&n.controlled===!0)||!n.control&&n.controlled&&(void 0===n.selected||0===n.selected.length))){if("select"==n.type&&r.html(e("<option></option>").attr("value","").text(a.lang.select_field.replace("%s",r.data("fieldTitle"))).data("ordering",0)).children("option:eq(0)").prop("selected",!0),"function"==typeof r.relatedlisting&&!r.data("isControlled"))return r.data("isActive",!0),!0;o.debug("   ----- Hiding field "+n.name+" on startup");var v=r.data("click2add")||0;return(0===v||1==v&&r.data("isControlled"))&&r.data("isActive",!1).closest("div.jrFieldDiv").css("display","none"),!0}if("select"==n.type&&0===r.children("option").length&&r.html(e("<option></option>").attr("value","").text(a.lang.select_field.replace("%s",r.data("fieldTitle"))).data("ordering",0)),e.inArray(n.type,["select","selectmultiple","relatedlisting"])>-1&&(r.children('option[data-controlledBy="'+t.control_field[0]+'"]').each(function(){var a=e(this);a.data("controlValue")!=t.control_value&&a.remove()}),e(n.options).each(function(){0===r.children('option[value="'+this.value+'"]').length&&r.append(e("<option></option>").attr("value",this.value).text(this.text).attr("data-ordering",this.ordering))})),void 0!==n.selected&&n.selected.length>0&&(-1==e.inArray(n.type,["checkboxes","radiobuttons"])&&r.val(n.selected),r.data("old_val",n.selected),e(n.selected).each(function(e,a){n.name in t.responses&&a in t.responses[n.name]&&(o.debug("  +++++++ Start populateOptions recursion for "+n.name),r.data("eventType","cached"),o.populateOptions(t.responses[n.name][a],n,r,void 0,a))})),"select"==n.type&&0===r.find(":selected").length&&r.children("option:eq(0)").prop("selected",!0),!t.page_setup&&u&&-1==e.inArray(n.name,p))return r.data("isActive",!0),!0;if(o.debug("   ***** Start checks for displaying fields for ["+n.title+"]["+n.type+"]"),c&&h!==!0)r.data("isActive",!1).closest("div.jrFieldDiv").hide();else switch(n.type){case"select":r.children("option").length>1||1==r.data("click2add")&&!c||r.data("hasControl")===!0&&r.data("isControlled")===!1||r.data("hasControl")===!1&&r.data("isControlled")===!1?r.data("isActive",!0).closest("div.jrFieldDiv").show():r.data("isActive",!1).closest("div.jrFieldDiv").hide();break;case"selectmultiple":(r.children("option").length>0||1==r.data("click2add")&&!c||r.data("hasControl")===!0&&r.data("isControlled")===!1||r.data("hasControl")===!1&&r.data("isControlled")===!1)&&r.data("isActive",!0).closest("div.jrFieldDiv").show();break;case"checkboxes":case"radiobuttons":(!c||c&&h&&r.data("hasControl")===!0&&r.data("isControlled")===!1||r.data("hasControl")===!1&&r.data("isControlled")===!1)&&r.data("isActive",!0).closest("div.jrFieldDiv").show();break;default:r.data("isActive",!0).closest("div.jrFieldDiv").show()}r.children("option").length>0&&"ordering"==r.data("orderBy")&&o.sort_by_field(r)}),void 0!==l&&void 0!==r&&o.clearDependents(l,r,s),!t.page_setup&&a.recallValues&&(e(t.dependent_fields).each(function(t,a){o.recallValue(e("."+a),n.name,s)}),e.each(t.dependent_groups,function(t,a){d.filter("fieldset#group_"+a).find(":input").each(function(){var t=e(this).data("hasControl"),a=e(this).data("isControlled");(t||t===!1&&a===!1)&&o.recallValue(e(this),n.name,s)})}))}},this.sort_by_field=function(t){var a,i,n=t.val(),l=t.data("orderBy"),o="ordering"==l?function(e){return parseInt(e,10)}:function(e){return e.toUpperCase()};a=t.prop("type"),"select-one"==a&&(i=t.children('option[value=""]').detach());var r=t.children("option").sort(function(t,a){return t="ordering"==l?e(t).data("ordering"):t.text,a="ordering"==l?e(a).data("ordering"):a.text,"undefined"!=typeof o&&(t=o(t),a=o(a)),a>t?-1:t>a?1:0});void 0!==i?t.html(r).prepend(i).val(n):t.html(r).val(n)},this.debug=function(e){l&&console.log(e)}}e.fn.jreviewsFields=function(e){var a=new t(this);return a.loadData(e)},e.fn.jrSetValidFields=function(){var e=new t(this);return e.setValidFields(this)},e.fn.jrApplyFieldOptionLayout=function(){this.find(".jrFieldDiv:visible:has(.jr-option)").each(function(){var t=e(this),a=t.parents('[role="tabpanel"]');if(a.length){var i=a.css("display");a.css("display","block")}var n=t.find(".jr-option"),l=Math.max.apply(Math,n.map(function(){return e(this).width()}).get());l>0&&n.removeClass("jrOptionMinWidth").css("min-width",l+"px"),a.length&&a.css("display",i)})}}(jQuery),function(e){e.widget("jreviews.autocompletefield",{lookup:"options",options:{entry_id:null,optionType:"link",optionDivPosition:"after",minSearchLength:1,lang:{help:jreviews.__t("FIELD_AUTOCOMPLETE_HELP"),no_results:jreviews.__t("FIELD_NO_RESULTS")},helpClass:"acInstructions",inputClass:"jrAutoSuggest",disabledLinkClass:"ui-disabled",checkboxClass:"ui-option",optionsDivClass:"ui-optionsDiv"},_create:function(t){e.extend(this.options,t);var a=this,i=a.element.hide(),n=a.options,l=a.fname=i.data("fieldName"),o=a.widgetid="text-"+l;a.lookup=n.lookup,i.data("validation",!1);var r=(this.searchInput=e('<input type="text" />')).attr({id:o,name:o}).addClass(n.helpClass+" "+n.inputClass).insertAfter(i);void 0!=i.attr("placeholder")?r.attr("placeholder",i.attr("placeholder")):r.val(n.lang.help);{var s=(this.optionsDiv=e("<div></div")).attr("data-fname",l).addClass(n.optionsDivClass+" jrClearfix");(this.noResults=e("<span></span>")).html(n.lang.no_results).css("margin-left","5px").addClass("jrValidation")}switch(n.optionDivPosition){case"before":s.insertBefore(r);break;case"after":s.insertAfter(r)}this._bindEvents()},_init:function(){var t=this,a=t.element,i=t.options,n=t.optionsDiv,l=a.children("option:selected");switch(l.length&&e.each(l,function(){var a=e(this);if(""===a.val())return!0;switch(i.optionType){case"link":var l=t._createLink({value:a.val(),text:a.text(),checked:!0});break;case"checkbox":l=t._createCheckbox({value:a.val(),text:a.text(),checked:!0})}n.append(l)}),i.optionType){case"link":0===n.find("a").length?n.hide():n.show(5);break;case"checkbox":0===n.find("input").length?n.hide():n.show(5)}},_createCheckbox:function(t){var a=this.fname,i=this.options,n="cb-"+a+"_"+t.value.replace(/ /g,"_"),l=e('<input type="checkbox" />').attr({id:n,name:n}).addClass(i.checkboxClass).val(t.value).prop("checked",t.checked),o=e('<label for="'+n+'" />').css("text-align","left").append(l).append("<span>"+t.text+"</span>");return o},_createLink:function(t){var a=this.options;return e('<a href="javascript:void(0)"></a>').addClass(a.checkboxClass).html(t.text).attr("data-value",t.value).data("active",t.checked?!0:!1)},_getListingData:function(e,t,a){var i=this.element;a=a||"";var n={limit:12,id:a,fname:i.attr("class").split(" ")[0],listingtype:i.data("listingtype")||"",value:e},l=jreviews.dispatch({method:"get",type:"json",controller:"fields",action:"relatedListings",data:n});l.done(function(e){t(e)})},_bindEvents:function(){var t=this,a=t.element,i=t.options,n=t.searchInput,l=t.optionsDiv;switch(void 0==n.attr("placeholder")&&n.on("click focusin",function(){this.value==i.lang.help&&e(this).val("").removeClass(i.helpClass)}).on("blur focusout",function(){""===this.value&&e(this).val(i.lang.help).addClass(i.helpClass)}),this._bindAutoComplete(),l.delegate(":input:checkbox","change",function(){var t=e(this),i=t.val(),n=t.next("span").html(),l=a.children('option[value="'+i+'"]');return t.is(":checked")?l.length>0?l.prop("selected",!0):l.append(e("<option></option>").attr("value",i).text(n)):l.length>0&&l.prop("selected",!1),a.trigger("change"),!1}).delegate("a","click",function(){var t=e(this),n=t.data("value"),l=t.html(),o=a.children('option[value="'+n+'"]');return t.data("active")===!1?(t.data("active",!0).removeClass(i.disabledLinkClass),o.length>0?o.prop("selected",!0):o.append(e("<option></option>").attr("value",n).text(l))):o.length>0&&(t.data("active",!1).addClass(i.disabledLinkClass),o.prop("selected",!1)),a.trigger("change"),!1}),i.optionType){case"link":this._bindForLinks();break;case"checkbox":this._bindForCheckboxes()}this._bindClick2Add()},_bindForCheckboxes:function(){var t=this,a=t.element,i=(t.options,t.optionsDiv);a.on("change",function(){var n=i.find(":input"),l=a.children("option"),o=l.map(function(){return this.value});l.each(function(){var a=e(this),n=a.val();if(""!==n){var l=i.find(':input[value="'+n+'"]');a.is(":selected")===!1?l.length&&l.prop("checked",!1):l.length?l.prop("checked",!0):i.show(5).append(t._createCheckbox({value:n,text:a.text(),checked:!0}))}}),n.each(function(){var t=e(this);-1==e.inArray(t.val(),o)&&t.closest("label").remove()}),0===i.find(":input").length&&i.hide()})},_bindForLinks:function(){var t=this,a=t.element,i=t.options,n=t.optionsDiv;a.on("change",function(){var l=n.find("a"),o=a.children("option"),r=o.map(function(){return this.value});o.each(function(){var a=e(this),l=a.val();if(""!==l){var o=n.find('a[data-value="'+l+'"]');a.is(":selected")===!1?o.length&&o.data("active",!1).addClass(i.disabledLinkClass):o.length?o.data("active",!0).removeClass(i.disabledLinkClass):n.show(5).append(t._createLink({value:l,text:a.text(),checked:!0}))}}),l.each(function(){var t=e(this);-1==e.inArray(String(t.data("value")),r)&&t.remove()}),0===n.find("a").length&&n.hide()})},_bindAutoComplete:function(){var t=this,a=t.element,i=t.options,n=t.searchInput,l=t.optionsDiv,o=void 0!==a.data("field")?a.data("field").id:"",r=(t.fname,jreviews.isRTL?"right top":"left top"),s=jreviews.isRTL?"right bottom":"left bottom";n.autocomplete({position:{my:r,at:s},minLength:i.minSearchLength,source:function(n,r){var s,d=n.term.toLowerCase(),c=[];switch(i.optionType){case"link":s=l.find("a").map(function(){return e(this).data("value")});break;case"checkbox":s=l.find(":input").map(function(){return this.value})}if(a.data("isControlled")&&"listings"!=t.lookup){var p=new RegExp(e.ui.autocomplete.escapeRegex(n.term),"i");c=a.children("option").map(function(){var t=e(this).text();return""===this.value||n.term&&!p.test(t)||-1!=e.inArray(this.value,s)?void 0:{label:t,value:this.value}}),r(c),t._noMatch(c)}else switch(t.lookup){case"listings":t._getListingData(d,function(i){e(i).each(function(t,i){void 0===i||-1!=e.inArray(parseInt(i.value,10),s)&&!e.inArray(i.value,a.val())||c.push(i)}),r(c),t._noMatch(c)},i.entry_id);break;case"options":var u={limit:12,field_id:o,value:d},h=jreviews.dispatch({method:"get",type:"json",controller:"fields",action:"_loadValues",data:u});h.done(function(i){e(i).each(function(t,i){void 0===i||-1!=e.inArray(i.value,s)&&!e.inArray(i.value,a.val())||c.push(i)}),r(c),t._noMatch(c)})}},search:function(){return"options"==this.lookup&&""===o?!1:void 0},focus:function(e,t){return n.val(t.item.label),!1},select:function(t,i){if(""!==i.item.value){n.val("").focus();var l,o=a.val()||[],r=a.children('option[value="'+i.item.value+'"]');a.val(""),0===r.length&&a.append(e("<option></option>").attr({value:i.item.value}).text(i.item.label)),l=a.prop("type"),"select-multiple"==l?(o.push(i.item.value),a.val(o)):a.val(i.item.value),a.trigger("change"),a.trigger("autoCompleteSelect")}return n.val(""),!1}}),e(".ui-autocomplete").addClass("jrAutoComplete")},_bindClick2Add:function(){var t=this.element,a=this.options,i=this.searchInput;1==t.data("click2add")&&e('<button class="jrButton" />').html('<span class="jrIconNew"></span>'+jreviews.__t("FIELD_ADD_OPTION")).on("click",function(n){n.preventDefault();var l,o,r=i.val(),s="";!t.data("controlledBy")||t.data("fieldName")in t.data("controlledBy")||e.each(t.data("controlledBy"),function(e,t){l=e,o=t,s="|"+e+"|"+t});var d=encodeURIComponent(r).replace(/'/g,"&#039;")+"|click2add"+s,c=t.children('option[value="'+d+'"]');""!==r&&r!=a.lang.help&&0===c.length?(t.append(e("<option></option>").attr({value:d,selected:"selected","data-ordering":99999,"data-controlledBy":l,"data-controlValue":o}).text(r)).trigger("change"),i.val("")):1==c.length&&(c.prop("selected",!0),t.trigger("change")),i.focus()}).insertAfter(i)},_noMatch:function(t){var a=this.element,i=this.noResults;0===t.length&&a.data("validation")===!1&&(a.prevAll("label:eq(0)").append(i).data("validation",!0),i.fadeIn(100).delay(3e3).fadeOut(500,function(){e(this).detach(),a.data("validation",!1)}))},_destroy:function(){}})}(jQuery),function(e){jreviewsFormBuilder=function(t,a){this.formbuilder=t,this.settings=e.extend({showModel:!1},a)},jreviewsFormBuilder.prototype={constructor:jreviewsFormBuilder,options:{theme:"jreviews",iconlib:"jreviews",schema:{},ajax:!0,startval:null,disable_collapse:!0,disable_array_delete_all_rows:!0,disable_array_delete_last_row:!0,disable_properties:!0,disable_edit_json:!0,no_additional_properties:!0},form:null,formbuilder:null,schema:null,model:null,editor:null,initialize:function(){function t(t){t.find(".jrFormHeading").each(function(){e(this).parent().hasClass("jrFormBuilderPanel")||a(t)})}function a(t){t.find(".jrButtonGroup").each(function(){e(this).children(".jrButton:visible:last").addClass("jrButtonLast"),e(this).children(".jrButton:visible:first").addClass("jrButtonFirst");var t=e(this).children("button").length;e(this).children("button:hidden").length==t&&0==e(this).find(".json-editor-btn-add").length&&0==e(this).find(".json-editor-btn-delete").length&&e(this).hide()})}var i=this;if(i.formbuilder.data("initialized")===!0)return console.log("FormBuilder already initialized"),i;i.schema=i.formbuilder.find("[jr-schema]").css("display","none"),i.model=i.formbuilder.find("[jr-model]").css("display","none");try{if(i.options.schema=JSON.parse(i.schema.val()||"{}"),JSON.stringify(i.options.schema)==JSON.stringify({}))return i}catch(n){return i}i.formbuilder.data("initialized",!0);try{var l=i.model.val();"{}"!==l&&"[]"!=l&&""!=l?i.options.startval=JSON.parse(l):delete i.options.startval}catch(n){delete i.options.startval}var o=i.formbuilder.find("[jr-form]");return this.settings.showModel&&i.model.css("display","block"),JSONEditor.defaults.editors.select.prototype.setupSelect2=function(){this.select2=null},JSONEditor.prototype._loadExternalRefs=function(t,a){var i,n=this,l=this._getExternalRefs(t),o=0,r=0,s=!1;e.each(l,function(e){if(!n.refs[e]){if(!n.options.ajax)throw"Must set ajax option to true to load external ref "+e;switch(n.refs[e]="loading",r++,jreviews.cms){case 1:i=e.replace("DEFINITIONS_PATH",jreviews.relpath+"/components/com_jreviews/jreviews/views/themes/default/fields_formbuilder/definitions");break;case 2:i=e.replace("DEFINITIONS_PATH",jreviews.relpath+"/wp-content/plugins/jreviews/jreviews/views/themes/default/fields_formbuilder/definitions")}var t=new XMLHttpRequest;t.open("GET",i,!0),t.onreadystatechange=function(){if(4==t.readyState){if(200!==t.status)throw window.console.log(t),"Failed to fetch ref via ajax- "+e;var i;try{i=JSON.parse(t.responseText)}catch(l){throw window.console.log(l),"Failed to parse external ref "+e}if(!i||"object"!=typeof i)throw"External ref does not contain a valid schema - "+e;n.refs[e]=i,n._loadExternalRefs(i,function(){o++,o>=r&&!s&&(s=!0,a())})}},t.send()}}),r||a()},i.form=new JSONEditor(o[0],i.options),i.initializing=!0,i.form.on("ready",function(){t(o)}),i.form.on("change",function(){i.initializing!==!0&&(i.model.val(JSON.stringify(i.form.getValue(),null,2)),a(o));var e=i.form.validate();e.length?console.log("FormBuilder Validation",JSON.stringify(e,null,2)):console.log("FormBuilder Validation: valid"),i.initializing=!1}),i},updateSchema:function(e){this.editor?this.editor.setValue(JSON.stringify(e,null,2),-1):this.schema.val(JSON.stringify(e,null,2)),this.reload()},reload:function(){this.destroy().initialize(this.formbuilder)},destroy:function(){return this.formbuilder.data("initialized",!1),this.form&&this.form.destroy(),this.formbuilder.find("[jr-form]").html(""),this.model.val("[]"),this},addEditor:function(){var e=this,t=e.formbuilder.find("[jr-schema-editor]");return t.length&&null==this.editor&&(e.editor=ace.edit(t[0]),e.editor.getSession().setMode("ace/mode/"+t.data("format")),e.editor.setValue(e.schema.val(),-1),e.editor.on("change",function(){e.schema.val(e.editor.getValue())})),e}}}(jQuery);(function(){!function(t){"use strict";var e;return e=function(){function e(e,i){this.filter={},this.$input=t(e).hide(),this.$container={},this.$form=this.$input.closest("form"),this.$wrapper=this.$input.closest(".jr-filter-wrap"),this.fieldName=this.$input.data("fieldName"),this.filterType="",this.$label=this.$wrapper.find(".jr-filter-label"),this.$selectedFilterPreview=t('<p class="jr-selected-filters-preview jrSelectedFiltersPreview">').appendTo(this.$label),this.$applyLink=t('<a href="javascript:;" class="jr-apply-filter jrApplyFilter jrButton jrSmall jrIconOnly"><span class="jrIconApplyFilter"></span></a>'),this.$filterClear=t('<div class="jr-filter-reset jrHidden"><a href="javascript:;" class="jr-filter-clear jrClearFilter">'+jreviews.__t("FILTERS_CLEAR_SELECTED")+"</a></div>"),this.$showAll=t('<a href="javascript:;" class="jrFilterShowAll jrHidden">'+jreviews.__t("FILTERS_SHOW_ALL")+"</a>"),this.$showLess=t('<a href="javascript:;" class="jrFilterShowLess jrHidden">'+jreviews.__t("FILTERS_SHOW_LESS")+"</a>"),this.displayAs=this.$input.data("display-as"),this.options=this.getOptions(i),this.init()}var i;return i={split_option_limit:10,link_css:{item:"jrLink"},linkboxed_css:{item:"jrLinkBoxed"}},e.prototype.init=function(){var e=this;e.$filter=this.loadFilter(),e.$container=e.$filter.transform();var i=t("<span>").hide();i.appendTo(e.$wrapper),e.$container=e.$container.insertAfter(i),e.updateSelectedOptionsPreview(),e.addFilterClear(),e.addShowAll(),e.$input.data("isControlled")===!1&&e.$wrapper.show(),e.$input.on("change",function(i){e.resetListingTypeInputs(t(i.target))}),e.$label.length>0&&0==e.$label.hasClass("jr-no-slideout")?e.$label.on("click",function(){e.$container.slideToggle(),e.$wrapper.toggleClass("jrIsOpen",0==e.$wrapper.hasClass("jrIsOpen"))}):e.$container.show(),e.$input.on("updateFilter",function(){e.updateSelectedOptionsPreview(),e.contextAwarenessCheck(),e.$input.trigger("change")}),e.$input.on("updateFilterNoChange",function(){e.updateSelectedOptionsPreview(),e.contextAwarenessCheck()}),1==e.$wrapper.data("autoOpen")&&e.$label.trigger("click"),e.contextAwarenessCheck()},e.prototype.updateSelectedOptionsPreview=function(){var e=[],i=0==this.$input.data("preview")?0:1;1==i&&(this.$input.children("option:selected").each(function(){""!==t(this).val()&&null!==t(this).val()&&e.push(t(this).text())}),this.$selectedFilterPreview.html(e.join(", ")))},e.prototype.contextAwarenessCheck=function(){if(t.inArray(this.filterType,["checkbox","select","link","linkboxed"])>-1){var e=this.$input.children("option");if(0===e.length)return void this.$wrapper.addClass("jrHidden");if(1===e.length)return void(""==e.attr("value")&&this.$wrapper.addClass("jrHidden"));this.$wrapper.removeClass("jrHidden")}},e.prototype.resetListingTypeInputs=function(t){var e=t.children("option:selected").eq(0);(""==e.val()||void 0!==e.data("listingType")&&e.data("listingType")!=t.data("oldListingType"))&&this.$form.find('[name^="data[Field]"],[name="data[usematch]"]').val("")},e.prototype.getFieldQuerySwitch=function(){var e,i=this;return 1==i.$input.data("matchSwitch")?(e=t('<div class="jrToggleSwitchRow"><div class="jrToggleLabel">'+jreviews.__t("FILTERS_MATCH_ALL")+'</div><div class="jrToggleSwitch"><input id="toggle-'+i.fieldName+'" class="jrToggle jrToggleRound" type="checkbox" name="data[matchall]['+i.fieldName+']" value="1" '+(1==i.$input.data("match-all")?"checked":"")+'><label for="toggle-'+i.fieldName+'"></label></div></div>'),e.on("click",function(){var e=t(this).find("input");e.prop("checked",!e.prop("checked")).trigger("change")}),e.on("change","input",function(t){t.stopPropagation(),null!==i.$input.val()&&i.$input.val().length>1&&setTimeout(function(){i.$input.trigger("change")},500)})):1==i.$input.data("match-all")&&(e=t('<input type="hidden" name="data[matchall]['+i.fieldName+']" value="1" />')),e},e.prototype.getOptions=function(e){var r={split_option_limit:this.$input.data("splitOptionLimit")};return t.extend({},i,e,r)},e.prototype.getContainer=function(e){var i=t('<div class="jr-filter-container jrFilterContainer '+e+'"><div class="jr-filter-selected jrFilterSelected jrHidden"></div><div class="jr-filter-unselected jrFilterUnselected"></div></div>');return i.hide(),i},e.prototype.getContainerText=function(e){var i=t('<div class="jr-filter-container jrFilterContainer '+e+'">');return i.hide(),i},e.prototype.addFilterClear=function(){var t=this;1==t.$input.data("reset")&&"function"==typeof t.$filter.clear&&(t.$container.prepend(t.$filterClear),t.$filterClear.on("click",".jr-filter-clear",function(){t.$filter.clear(),t.$input.trigger("updateFilter")}))},e.prototype.addShowAll=function(){var e=this,i=e.$input.data("showLimit")||5,r=e.$container.find(".jr-filter-unselected .jr-filter-item");e.$filter.allowShowAll&&1==e.$input.data("showAll")&&r.length>i&&(e.$container.append(e.$showAll.removeClass("jrHidden"),e.$showLess),e.$showAll.on("click",function(i){i.preventDefault(),t(this).hide(),e.$showLess.removeClass("jrHidden").show(),r.show()}),e.$showLess.on("click",function(r){r.preventDefault(),t(this).hide(),e.$container.find(".jr-filter-unselected .jr-filter-item:gt("+(i-1)+")").hide(),e.$showAll.show(),jreviews.mobi||e.$container.jrScrollTo({duration:350,offset:-100})}).trigger("click"))},e.prototype.getApplyLink=function(){return this.$applyLink},e.prototype.loadFilter=function(){var t;switch(this.displayAs){case"linkboxed":t="link";break;default:t=this.displayAs}return this.filterType=t,new this.filters[t](this)},e.prototype.filters={},e.prototype.reset=function(){var t=this;this.$filter.clear(),this.updateSelectedOptionsPreview(),this.$filter.updateFilter(this.$container),t.$input.data("isControlled")===!0&&(t.$wrapper.toggleClass("jrIsOpen",!1),t.$wrapper.hide(),t.$wrapper.find(".jr-filter-container").hide())},e.prototype.submit=function(){this.$input.trigger("change")},e.prototype.filters.checkbox=function(t){this.$transformer=t,this.$input=t.$input,this.splitList=t.$input.data("splitList"),this.allowShowAll=!0},e.prototype.filters.checkbox.prototype={constructor:e.prototype.filters.checkbox,transform:function(){var e,i=this;return e=this.$transformer.getContainer("jrCheckboxFilter"),e.prepend(i.$transformer.getFieldQuerySwitch()),i.init(e),i.watch(e),e.on("click",".jr-filter-item",function(){{var e,r=t(this);r.find("span")}e=i.$transformer.$input.children('[value="'+r.data("value")+'"]'),e.prop("selected",e.is(":selected")?!1:!0),i.$transformer.$input.trigger("updateFilter")})},init:function(t){var e=this;e.setup(t),e.$input.on("updateFilter",function(){e.updateFilter(t)}).trigger("updateFilter"),e.$input.on("updateFilterNoChange",function(){e.updateFilter(t)})},setup:function(e){var i=this,r=e.find(".jr-filter-unselected").html("");e.find(".jr-filter-selected").find(".jr-filter-item").remove(),i.optionCount=i.$input.children("option").length,i.$input.children("option").each(function(){var e,i;e=t(this),""!=e.val()&&(i=t('<a href="javascript:;" class="jr-filter-item jrFilterItem" data-value="'+e.val()+'"><span></span>'+e.text()+"</a>"),r.append(i))})},watch:function(t){var e=this;e.$input.data("isControlled")&&setInterval(function(){e.$input.children("option").length!==e.optionCount&&(e.setup(t),e.updateFilter(t))},100)},clear:function(){var t=this;t.$input.val("")},updateFilter:function(e){var i,r,n,a,l=this,s=l.$transformer.options.split_option_limit;n=this.$transformer.$input,a=n.children("option").length,i=e.find(".jr-filter-selected"),r=e.find(".jr-filter-unselected"),n.children("option").each(function(){var e=t(this),n=r.find('a[data-value="'+e.val()+'"]'),o=i.find('a[data-value="'+e.val()+'"]');""!=e.val()&&(e.is(":selected")?(n.find("span").removeClass("jrIconUnchecked").addClass("jrIconChecked"),a>s&&l.splitList&&(n.after(t('<span class="jrHidden" data-value="'+e.val()+'">')).detach(),i.append(n))):(o.find("span").removeClass("jrIconChecked").addClass("jrIconUnchecked"),n.find("span").removeClass("jrIconChecked").addClass("jrIconUnchecked"),a>s&&o&&l.splitList&&(o.detach(),r.find('span[data-value="'+e.val()+'"]').replaceWith(o))))}),i.toggleClass("jrHidden",""==i.html()),l.$transformer.$filterClear.toggleClass("jrHidden",""==i.html())}},e.prototype.filters.link=function(t){this.options=t.options,this.$transformer=t,this.$input=t.$input,this.splitList=t.$input.data("splitList"),this.css=t.options[t.displayAs+"_css"],this.allowShowAll="linkboxed"!==t.displayAs?!0:!1},e.prototype.filters.link.prototype={constructor:e.prototype.filters.link,transform:function(){var e,i=this;return e=this.$transformer.getContainer("linkboxed"==i.$transformer.displayAs?"jrLinkBoxedFilter":"jrLinkFilter"),"link"==i.$transformer.displayAs&&e.prepend(i.$transformer.getFieldQuerySwitch()),i.init(e),i.watch(e),e.on("click",".jr-filter-item",function(){var e;return 0==i.$input.data("deselect")&&i.$input.val()==t(this).data("value")?!1:(i.$input.data("oldListingType",i.$input.children("option:selected").data("listingType")),e=i.$input.children('[value="'+t(this).data("value")+'"]'),e.prop("selected")?(e.prop("selected",!1),i.$input.prop("multiple")||i.$input.val("")):e.prop("selected",!0),void i.$input.trigger("updateFilter"))})},init:function(e){var i=this,r=e.find(".jr-filter-unselected").html("");e.find(".jr-filter-selected").find(".jr-filter-item").remove(),i.optionCount=i.$input.children("option").length,i.$input.children("option").each(function(){var e,n;e=t(this),""!=e.val()&&(n=t('<a href="javascript:;" class="jr-filter-item jrFilterItem '+i.css.item+'" data-value="'+e.val()+'">'+e.text()+"</a>"),r.append(n))}),i.$input.on("updateFilter",function(){i.updateFilter(e)}).trigger("updateFilter"),i.$input.on("updateFilterNoChange",function(){i.updateFilter(e)})},watch:function(t){var e=this;e.$input.data("isControlled")&&setInterval(function(){e.$input.children("option").length!==e.optionCount&&e.init(t)},100)},clear:function(){var t=this;t.$input.val("")},updateFilter:function(e){var i,r,n,a=this,l=a.$transformer.options.split_option_limit;n=this.$input.children("option").length,i=e.find(".jr-filter-selected"),r=e.find(".jr-filter-unselected"),this.$input.children("option").each(function(){var e=t(this),s=r.find('a[data-value="'+e.val()+'"]').removeClass("jrChecked"),o=i.find('a[data-value="'+e.val()+'"]');""!=e.val()&&(e.prop("selected")?(s.addClass("jrChecked"),n>l&&a.splitList&&s.after(t('<span class="jrHidden" data-value="'+e.val()+'">')).appendTo(i)):n>l&&o&&a.splitList&&(o.detach(),r.find('span[data-value="'+e.val()+'"]').replaceWith(o.removeClass("jrChecked"))))}),i.toggleClass("jrHidden",""==i.html()),a.$transformer.$filterClear.toggleClass("jrHidden",null==a.$input.val())}},e.prototype.filters.select=function(t){this.options=t.options,this.$transformer=t,this.$input=t.$input,this.allowShowAll=!1},e.prototype.filters.select.prototype={constructor:e.prototype.filters.select,transform:function(){var t,e=this;t=this.$transformer.getContainerText("jrSelectFilter");var i=e.$transformer.$input.prop("multiple",!1).removeClass("jrSelectMultiple").addClass("jrSelect").detach();return t.append(i.show()),e.$input.on("updateFilter",function(){e.updateFilter(t)}).trigger("updateFilter"),e.$input.on("updateFilterNoChange",function(){e.updateFilter(t)}),e.$input.on("change",function(){e.$input.trigger("updateFilterNoChange")}),t},clear:function(){this.$input.val("")},updateFilter:function(){this.$transformer.$filterClear.toggleClass("jrHidden",""==this.$input.val())}},e.prototype.filters.text=function(t){this.options=t.options,this.$transformer=t,this.$input=t.$input,this.allowShowAll=!1},e.prototype.filters.text.prototype={constructor:e.prototype.filters.text,transform:function(){var t,e=this;t=this.$transformer.getContainerText("jrTextFilter");var i=e.$input.on("change",function(t){void 0!==t.originalEvent&&t.stopPropagation()}).detach();return t.append(i.addClass("jrText").css("display","inline-block")),e.$transformer.getApplyLink().appendTo(t),i.on("keydown",function(e){13==e.keyCode&&(e.preventDefault(),t.find(".jr-apply-filter").trigger("click"))}),e.$input.on("updateFilter",function(){e.updateFilter(t)}).trigger("updateFilter"),e.$input.on("updateFilterNoChange",function(){e.updateFilter(t)}),t.on("click",".jr-apply-filter",function(){e.$input.trigger("updateFilter")})},clear:function(){var t=this;t.$input.val("")},updateFilter:function(){this.$transformer.$filterClear.toggleClass("jrHidden",""==this.$input.val())}},e.prototype.filters.autosuggest=function(t){this.options=t.options,this.$transformer=t,this.$input=t.$input,this.$autosuggest=t.$wrapper.find(".ui-autocomplete-input").addClass("jrText jrClear").detach(),this.allowShowAll=!1},e.prototype.filters.autosuggest.prototype={constructor:e.prototype.filters.text,transform:function(){var e,i=this;e=this.$transformer.getContainerText("jrTextFilter"),this.$container=e;{var r=i.$transformer.$input.detach(),n=i.$transformer.$wrapper.find(".ui-helper-hidden-accessible").detach();i.$transformer.$wrapper.find(".ui-optionsDiv").detach()}return i.optionCount=i.$input.children("option").length,e.append(r,i.$autosuggest,n),i.init(e),i.watch(e),i.$input.on("updateFilter",function(){i.updateFilter(e)}).trigger("updateFilter"),i.$input.on("updateFilterNoChange",function(){i.updateFilter(e)}),i.$input.on("autoCompleteSelect",function(){i.updateFilter(e),i.$transformer.updateSelectedOptionsPreview(),i.$autosuggest.val("")}),e.on("click",".jr-filter-item",function(){var e,r=t(this);e=i.$transformer.$input.children('[value="'+r.data("value")+'"]'),e.prop("selected",e.is(":selected")?!1:!0),i.$input.trigger("updateFilter")})},init:function(t){{var e=this;t.find(".jr-filter-unselected").html("")}t.find(".jr-filter-item").remove(),e.optionCount=e.$input.children("option").length,this.updateCheckboxes(),e.$input.trigger("updateFilter")},updateCheckboxes:function(){var e=this;this.$input.children("option").each(function(){var i,r;if(i=t(this),""!=i.val()){if(r=e.$container.find('.jr-filter-item[data-value="'+i.val()+'"]'),r.length)i.is(":selected")?r.find("span").switchClass("jrIconUnchecked","jrIconChecked"):r.find("span").switchClass("jrIconChecked","jrIconUnchecked");else{var n=i.is(":selected")?"jrIconChecked":"jrIconUnchecked";r=t('<a href="javascript:;" class="jr-filter-item jrFilterItem" data-value="'+i.val()+'"><span class="'+n+'"></span>'+i.text()+"</a>"),e.$container.append(r)}i.is(":selected")?r.css("display","block"):r.hide()}})},watch:function(t){var e=this;setInterval(function(){e.$input.children("option").length!==e.optionCount&&e.init(t)},100)},clear:function(){this.$input.val("").children("option").remove(),this.$container.find(".jr-filter-item").remove()},updateFilter:function(){var t=this;t.$transformer.$filterClear.toggleClass("jrHidden",""==t.$input.val()||null==t.$input.val()),t.$autosuggest.val(""),this.updateCheckboxes()}},e.prototype.filters.geosearch=function(t){this.options=t.options,this.$transformer=t,this.$input=t.$input,this.$radius=this.$transformer.$wrapper.find('[name="data[Field][Listing][jr_radius]"]'),this.allowShowAll=!1},e.prototype.filters.geosearch.prototype={constructor:e.prototype.filters.geosearch,transform:function(){var e,i=this,r=t();e=this.$transformer.getContainerText("jrGeosearchFilter");var n=i.$input.closest(".jrInputButtonRow"),a=i.$input.show().on("change",function(t){void 0!==t.originalEvent&&t.stopPropagation()}),l=n.length>0?n.detach():a.detach();if(i.$radius.length){var s=t('<div class="jrSliderInputValue">');t.ui.slider.prototype.widgetEventPrefix="slider",r=t('<div class="jrSliderInput">').after(s).slider({min:i.$radius.data("min"),max:i.$radius.data("max"),step:i.$radius.data("step"),value:i.$radius.val(),slide:function(t,e){i.$radius.val(e.value),s.html(i.radiusString())}}),i.$radius.on("change",function(){r.slider("value",t(this).val())}),s.html(i.radiusString())}return i.$transformer.getApplyLink().appendTo(e),e.append(l,r,s),i.$input.on("updateFilter",function(){i.updateFilter(e)}).trigger("updateFilter"),i.$input.on("updateFilterNoChange",function(){i.updateFilter(e)}),e.on("click",".jr-apply-filter",function(){i.$input.trigger("updateFilter")})},radiusString:function(){return this.$radius.val()+' <span class="jrRadiusMetric">'+this.$radius.data("metric")+"</span>"},clear:function(){var t=this;t.$input.val("").trigger("keyup")},updateFilter:function(){this.$transformer.$filterClear.toggleClass("jrHidden",""==this.$input.val())}},e.prototype.filters.numberrange=function(t){this.options=t.options,this.$transformer=t,this.$container=null,this.$input=t.$input,this.$lowrange=t.$input.hide(),this.$highrange=this.$lowrange.next("span").hide().children("input"),this.$operator=this.$lowrange.prev("select").val("between").hide(),this.allowShowAll=!1},e.prototype.filters.numberrange.prototype={constructor:e.prototype.filters.numberrange,transform:function(){var e,i,r,n=this;e=this.$transformer.getContainer("jrRangeFilter"),i='<div class="jrRangeFilterInner">',i+='<label class="jrRangeFilterLabel">'+jreviews.__t("FILTERS_RANGE_MIN")+'</label><input class="jrRangeInput" type="text" placeholder="0">',i+='<span class="jrRangeDelimiter">'+jreviews.__t("FILTERS_RANGE_DELIMITER")+"</span>",i+='<label class="jrRangeFilterLabel">'+jreviews.__t("FILTERS_RANGE_MAX")+'</label><input class="jrRangeInput" type="text" placeholder="100">',i+="</div>";var a=t(i);return n.$transformer.getApplyLink().appendTo(a),e.html(a),e.on("change","input",function(t){t.stopPropagation()}),r=e.find("input"),""!=this.$lowrange.val()&&r.eq(0).val(this.$lowrange.val()),""!=this.$highrange.val()&&r.eq(1).val(this.$highrange.val()),n.$container=e,n.$input.on("updateFilter",function(){n.updateFilter()}).trigger("updateFilter"),n.$input.on("updateFilterNoChange",function(){n.updateFilter(e)}),e.on("click",".jr-apply-filter",function(){var t;t=e.find("input"),n.$lowrange.val(t.eq(0).val()),n.$highrange.val(t.eq(1).val()),n.$lowrange.trigger("updateFilter")})},clear:function(){var t=this;t.$lowrange.val(""),t.$highrange.val(""),t.$container.find("input").val("")},updateFilter:function(){var t=this;this.$transformer.$filterClear.toggleClass("jrHidden",""==t.$lowrange.val()&&""==t.$highrange.val())}},e.prototype.filters.daterange=function(t){this.options=t.options,this.$transformer=t,this.$input=t.$input,this.$lowrange=t.$input.hide(),this.$highrange=this.$lowrange.next("img").hide().next("span").hide().children("input"),this.$operator=t.$input.prev("select").val("between").hide(),this.allowShowAll=!1},e.prototype.filters.daterange.prototype={constructor:e.prototype.filters.daterange,transform:function(){var e,i,r,n=this;e=this.$transformer.getContainer("jrRangeFilter"),i='<div class="jrRangeFilterInner">',i='<input class="jr-date jrDate jrRangeInput" type="text" placeholder="">',i+='<span class="jrRangeDelimiter">'+jreviews.__t("FILTERS_RANGE_DELIMITER")+"</span>",i+='<input class="jr-date jrDate jrRangeInput" type="text" placeholder="">',i+="</div>";var a=t(i);return n.$transformer.getApplyLink().appendTo(a),e.html(a),e.on("change","input",function(t){t.stopPropagation()}),r=e.find("input"),""!=this.$lowrange.val()&&r.eq(0).val(this.$lowrange.val()),""!=this.$highrange.val()&&r.eq(1).val(this.$highrange.val()),n.$container=e,n.$input.on("updateFilter",function(){n.updateFilter()}).trigger("updateFilter"),n.$input.on("updateFilterNoChange",function(){n.updateFilter(e)}),e.on("click",".jr-apply-filter",function(){var t;t=e.find("input"),n.$lowrange.val(t.eq(0).val()),n.$highrange.val(t.eq(1).val()),n.$lowrange.trigger("updateFilter")})},clear:function(){var t=this;t.$lowrange.val(""),t.$highrange.val(""),t.$container.find("input").val("")},updateFilter:function(){var t=this;this.$transformer.$filterClear.toggleClass("jrHidden",""==t.$lowrange.val()&&""==t.$highrange.val())}},e.prototype.filters.rating=function(t){this.$transformer=t,this.$input=t.$input,this.allowShowAll=!1},e.prototype.filters.rating.prototype={constructor:e.prototype.filters.rating,transform:function(){var e,i=this;return e=this.$transformer.getContainerText("jrRatingFilter"),this.$input.children("option").each(function(){var r,n;if(r=t(this),""!=r.val()){var a=r.val()/5*100+"%";n=t('<a href="javascript:;" class="jr-filter-item jrFilterItem jrRatingStar" data-value="'+r.val()+'">'+sprintf(jreviews.__t("FILTERS_RATINGS_AND_UP"),'<div class="'+i.$input.data("class")+'"><div style="width:'+a+'"></div></div>')+"</a>"),e.append(n)}}),this.$input.on("updateFilter",function(){i.updateFilter(e)}).trigger("updateFilter"),i.$input.on("updateFilterNoChange",function(){i.updateFilter(e)}),e.on("click",".jr-filter-item",function(){var e;e=i.$input.children('[value="'+t(this).data("value")+'"]'),e.prop("selected")?i.$input.val(""):e.prop("selected",!0),i.$input.trigger("updateFilter")})},clear:function(){var t=this;t.$input.val("")},updateFilter:function(e){this.$input.children("option").each(function(){var i,r;i=t(this),r=e.find('.jr-filter-item[data-value="'+i.val()+'"]'),r.toggleClass("jrChecked",i.is(":selected"))}),this.$transformer.$filterClear.toggleClass("jrHidden",""==this.$input.val())}},e}(),jQuery.fn.jrFilterTransformer=function(i){var r=arguments;if(void 0===i||"object"==typeof i)return this.each(function(){t.data(this,"plugin_jrFilterTransformer")||t.data(this,"plugin_jrFilterTransformer",new e(this,i))});if("string"==typeof i&&"_"!==i[0]&&"init"!==i){var n;return this.each(function(){var a=t.data(this,"plugin_jrFilterTransformer");a instanceof e&&"function"==typeof a[i]&&(n=a[i].apply(a,Array.prototype.slice.call(r,1))),"destroy"===i&&t.data(this,"plugin_jrFilterTransformer",null)}),void 0!==n?n:this}}}(jQuery),function(t){"use strict";var e;return e=function(){function e(e,i){var r=this;this.$module=t(e),this.options=this.getOptions(i);var n='<div class="jrFiltersPanel"><div class="jrFiltersPanelHead"><h3 class="jrFilterPanelTitle"></h3><a href="#" class="jr-filters-panel-close jrFiltersPanelclose" onclick="javascript:;"><span class="jrIconClose"></span></a></div><div class="jr-filters-panel-scrollable jrFiltersPanelScrollable"></div></div><div class="jr-filters-panel-overlay jrFiltersPanelOverlay"></div>';this.$moduleContainer=this.options.container_class?this.$module.closest("."+this.options.container_class):[],this.$panel=t(n).hide(),this.$overlay=this.$panel.find(".jr-filters-panel-overlay"),this.$modulePlaceholder=t('<span class="jr-module-placeholder">').css("visibility","hidden"),this.$filtersPlaceholder=t('<span class="jr-filters-placeholder">').hide(),1===this.$module.length&&this.$moduleContainer.length&&(this.init(),t(document).on("jreviews-onAfterAjaxUpdate",function(){r.refresh()}))}var i;return i={resizeDelay:250,container_class:"mod-container",title_class:"mod-title",desktop_width:992},e.prototype.init=function(){this.$modulePlaceholder.insertBefore(this.$moduleContainer),this.bindCloseEvents(),this.bindFiltersButton(),this.$filtersPlaceholder.insertBefore(this.$module),this.moduleOffsetTop=this.$modulePlaceholder.offset().top,this.options.title_class&&this.$panel.find("h3").html(this.$moduleContainer.find("."+this.options.title_class).text()),this.bindResizeEvent()},e.prototype.refresh=function(){this.bindFiltersButton(),this.desktopView()?(this.$moduleContainer.hide(),this.displayMobileFilters()):(this.$moduleContainer.show(),this.displayDesktopFilters())},e.prototype.bindCloseEvents=function(){var e=this;this.$panel.on("click",".jr-filters-panel-close",function(i){i.preventDefault(),e.$panel.hide(),t("html").removeClass("jrFiltersNoScroll")}).on("click",function(i){i.preventDefault(),i.stopPropagation(),t(this).hasClass("jr-filters-panel-overlay")&&(e.$panel.hide(),t("html").removeClass("jrFiltersNoScroll"))}).appendTo(t("body"))},e.prototype.bindFiltersButton=function(){var e=this;this.$toggleButton=t(".jr-list-show-filters"),this.$toggleButton.on("click",function(i){i.preventDefault(),e.$panel.toggle(),t("html").toggleClass("jrFiltersNoScroll",e.$panel.is(":visible"))})},e.prototype.desktopView=function(){return t("body").width()<this.options.desktop_width||0==this.options.desktop_width},e.prototype.bindResizeEvent=function(){function e(){new Date-i<a?setTimeout(e,a):(n=!1,r.desktopView()?(r.$moduleContainer.hide(),r.displayMobileFilters()):(r.$moduleContainer.show(),r.displayDesktopFilters()))}var i,r=this,n=!1,a=this.options.resizeDelay;0===jreviews.mobi&&t(window).resize(function(){i=new Date,n===!1&&(n=!0,setTimeout(e,a))}),e()},e.prototype.displayMobileFilters=function(){t.contains(this.$panel,this.$module)===!1&&this.$module.appendTo(this.$panel.find(".jr-filters-panel-scrollable")),this.$toggleButton.show()},e.prototype.displayDesktopFilters=function(){t("html").removeClass("jrFiltersNoScroll"),this.$panel.hide(),this.$toggleButton.hide(),this.$filtersPlaceholder.after(this.$module)},e.prototype.getOptions=function(e){return t.extend({},i,this.$module.find("form").data("options")||{},e)},e}(),jQuery.fn.jrFiltersPanel=function(t){return null==t&&(t=null),1==this.length?this.each(function(){return new e(this,t)}):this}}(jQuery)}).call(this);var jreviewsMedia=jreviewsMedia||{};jreviewsMedia._options={galleryId:"mediaGallery",uploader:{},mediaDiv:{},polling_period:2e4},function(e,i,t){e.fn.serializeObject=function(){var i={},a=this.serializeArray();return e.each(a,function(){i[this.name]!==t?(i[this.name].push||(i[this.name]=[i[this.name]]),i[this.name].push(this.value||"")):i[this.name]=this.value||""}),i},i.upload_valid=!0,i.addElement=function(e,i){this._el=this._el||[],this._el[e]=i},i.getElement=function(e){return this._el[e]},i.initUploader=function(a,d){e("#jr-terms-checkbox-upload, #jr-terms-checkbox-link").prop("checked",!1);var r=e("#jr-embed-submit");r.on("click",function(t){if(r.trigger("beginUpload"),t.stopImmediatePropagation(),i.upload_valid===!0){var a=e(this),d=e("input#jr-embed-url"),o=e('<span class="jrLoadingSmall"></span>');if(""!==d.val()){a.prop("disabled",!0).after(o);var n=i.embed();n.done(function(){o.remove(),a.prop("disabled",!1)})}}});var o=e("#jr-upload-url-submit");o.on("click",function(t){if(o.trigger("beginUpload"),t.stopImmediatePropagation(),i.upload_valid===!0){var a=e(this),d=e("input#jr-upload-url"),r=e('<span class="jrLoadingSmall"></span>');if(""!==d.val()){a.prop("disabled",!0).after(r);var n=i.uploadFromUrl();n.done(function(){r.remove(),a.prop("disabled",!1)})}}}),e("div.jr-tabs").find("div[id$='-tab']").on("delete",function(){var i=e(".media-file-list"),t=e(".media-file-list-url"),a=e(".media-linked-videos");0===i.children("div").length&&(i.closest("fieldset").hide(),e(".jr-upload-complete-actions").slideUp()),0===t.children("div").length&&(t.closest("fieldset").hide(),e(".jr-upload-url-complete-actions").slideUp()),0===a.children("div").length&&(a.hide(),e(".jr-embed-complete-actions").slideUp())});var n=this,s=e("#jr-form-media-upload");this._options.uploader={element:document.getElementById(uploader_id=a||"jr-media-uploader"),action:s2AjaxUri,params:e("#jr-uploaded-media").serializeObject(),template:e.trim(e("#jr-uploader-template").html()),fileTemplate:e.trim(e("#jr-progress-template").html()),disableCancelForFormUploads:!0,protocol:s.attr("method"),classes:{button:"jr-upload-button",drop:"jr-upload-drop-area",dropActive:"jr-upload-drop-area-active",list:"jr-file-list",file:"jr-upload-file",spinner:"jr-upload-spinner",size:"jr-upload-size",cancel:"jr-upload-cancel",progress:"jr-upload-progress",success:"jr-upload-success",fail:"jr-upload-fail"},messages:{typeError:jreviews.__t("MEDIA_UPLOAD_TYPE_ERROR"),sizeError:jreviews.__t("MEDIA_UPLOAD_SIZE_ERROR"),emptyError:jreviews.__t("MEDIA_UPLOAD_EMPTY_ERROR"),noFilesError:jreviews.__t("MEDIA_UPLOAD_NOFILE_ERROR"),onLeave:jreviews.__t("MEDIA_UPLOAD_ONLEAVE")},showMessage:function(i){e(".jr-media-message").show().prepend("<li>"+i+"</li>")},onSubmit:function(){if(i.upload_valid=!0,e(".jr-upload-button input").trigger("beginUpload"),!i.upload_valid)return!1;this.params=s.serializeObject();var t=e("#jr-user-info");if(t.length>0){var a=t.serializeObject();e.extend(this.params,a)}var d=e(".jr-file-list").detach();e(".media-file-list").show().append(d),e(".jr-upload-complete-actions").slideUp()},onComplete:function(i,a,d){return d.id=i,d.success||d.str===t?(d.success===!0&&n.addMediaDiv(d,a),"finished"==d.state&&""!==d.thumb_url&&n.updateThumb(d),d.success&&d.encoding_job!==t&&n.checkEncodingJobStatus(d),void(0===n.jrUploader._filesInProgress&&e(".jr-upload-complete-actions").slideDown())):(e(".jr-media-message").append(jreviews.__t(d.str,{add_ul:!1})).show(),!1)}},qq.extend(qq.FileUploader.prototype,{_addToList:function(e,i){var t=qq.toElement(this._options.fileTemplate);t.qqFileId=e;var a=this._find(t,"file");qq.setText(a,this._formatFileName(i)),this._find(t,"size").style.display="none",this._listElement.appendChild(t),this._listElement.insertBefore(t,this._listElement.childNodes[0])},_bindCancelEvent:function(){var i=this,t=this._listElement;qq.attach(t,"click",function(t){t=t||window.event;var a=t.target||t.srcElement;if(qq.hasClass(a,i._classes.cancel)){qq.preventDefault(t);var d=a.parentNode.parentNode;i._handler.cancel(d.qqFileId),qq.remove(d),e("div.jr-tabs").find("div[id$='-tab']").trigger("delete")}})},_onProgress:function(i,t,a,d){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var r=this._getItemByFileId(i),o=this._find(r,"size");o.style.display="inline";var n,s=this._find(r,"progress");if(a!=d){var l=Math.round(a/d*100);e(s).progressbar({value:l}),n=l+"% of "+this._formatSize(d)}else e(s).progressbar({value:100}),n=this._formatSize(d);qq.setText(o,n)},_uploadFileList:function(e){for(var i=[],t=0;t<e.length;t++)this._validateFile(e[t])&&i.push(e[t]);for(var a=0;a<i.length;a++)this._uploadFile(i[a])},_validateFile:function(i){var a,d;if(i.value?a=i.value.replace(/.*(\/|\\)/,""):(a=i.fileName!==t?i.fileName:i.name,d=i.fileSize!==t?i.fileSize:i.size),this._options.allowedExtensions=[],this._options.fileValidation===t)return!0;for(var r=-1!==a.indexOf(".")?a.replace(/.*[.]/,"").toLowerCase():"",o=0;o<this._options.fileValidation.length;o++)e.merge(this._options.allowedExtensions,this._options.fileValidation[o].allowedExtensions),e.inArray(r,this._options.fileValidation[o].allowedExtensions)>-1&&(this._options.sizeLimit=this._options.fileValidation[o].sizeLimit);return this._isAllowedExtension(a)?0===d?(this._error("emptyError",a),!1):d&&this._options.sizeLimit&&d>this._options.sizeLimit?(this._error("sizeError",a),!1):d&&d<this._options.minSizeLimit?(this._error("minSizeError",a),!1):!0:(this._error("typeError",a),!1)}}),e("#jr-media-uploader").length&&(qq.extend(this._options.uploader,d),this.jrUploader=new qq.FileUploader(this._options.uploader)),i.uploadValidation()},i.uploadValidation=function(){var a=e("#jr-user-info"),d=e("#jr-terms-checkbox-upload, #jr-terms-checkbox-url, #jr-terms-checkbox-link");d.on("change",function(){var i=e(this);i.is(":checked")?d.prop("checked",!0):d.prop("checked",!1)}),e(".jr-upload-button input, #jr-upload-url-submit, #jr-embed-submit").on("click beginUpload",function(r){var o=a.serializeObject()||{},n=o["data[Media][name]"],s=o["data[Media][email]"],l=e(".jr-media-message"),c=a.find(".jr-user-name").data("required")||!1,p=a.find(".jr-user-email").data("required")||!1;l.html(""),i.upload_valid=!0,a.length>0&&(s!==t&&p&&""===s||n!==t&&c&&""===n?(p&&""===s&&l.show().prepend('<li class="jr-user-validation">'+jreviews.__t("VALIDATE_EMAIL")+"</li>"),c&&""===n&&l.show().prepend('<li class="jr-user-validation">'+jreviews.__t("VALIDATE_NAME")+"</li>"),i.upload_valid=!1,r.preventDefault()):i.upload_valid=!0),d.length&&!d.is(":checked")?(l.show().prepend('<li class="jr-user-validation">'+jreviews.__t("VALIDATE_TOS")+"</li>"),i.upload_valid=!1,r.preventDefault()):i.upload_valid=i.upload_valid&&!0,0===l.find("li").length&&l.slideUp()})},i.addMediaDiv=function(i,t){var a,d=(i.embed||!1,e(e.trim(e("#jr-media-template").html())).addClass("jr-"+i.media_type).attr("id","mediaForm"+i.media_id)),r="mediaForm"+i.media_id;a=i.embed===!0||i.upload_url===!0?d.wrap('<div class="jr-upload-success jrMediaDiv" />').parent():d;var o=a.find(".jr-media-spinner");if("photo"==i.media_type&&a.find(".jr-media-input-description").closest(".jrFieldDiv").remove(),a.find(".jr-media-update").on("click",function(e){e.preventDefault(),o.show(),jreviews.dispatch({controller:"media",action:"_saveEdit",method:"post",form_id:r}).done(function(){o.hide()})}),a.find(".jr-media-delete-upload").on("click",function(i){var t=a.is("form")?a.attr("id"):a.find("form").attr("id");i.preventDefault(),o.removeClass("jrHidden");var d=jreviews.dispatch({controller:"media",action:"_delete",method:"post",form_id:t});d.done(function(){var i=a.hasClass("jr-upload-success")?a:a.closest(".jr-upload-success");i.slideUp(300,function(){e(this).remove(),e("div.jr-tabs").find("div[id$='-tab']").trigger("delete")})})}),"photo"==i.media_type||"video"==i.media_type){var n=a.find(".jr-media-main"),s=a.find(".jr-photo-function");n.length&&(n.closest("div").removeClass("jrHidden"),n.data("mediaId",i.media_id),n.data("listingId",i.listing_id),n.data("token",i.token),n.data("mainMedia",i.main_media),n.find("span").addClass(i.main_media?n.data("states").on:n.data("states").off),n.data("main_media",i.main_media)),"photo"==i.media_type&&s.length&&(s.closest("div").removeClass("jrHidden"),s.data("mediaId",i.media_id),s.data("token",i.token))}if(a.find(".jr-media-filename").html(t),1==i.approved?a.find(".jr-media-approved").css("display","inline-block"):a.find(".jr-media-pending").css("display","inline-block"),a.find(".jr-media-input-title").val(i.title?i.title:t),a.find(".jr-media-input-description").html(i.description?i.description:""),a.find(".jr-media-media-id").val(i.media_id),a.find(".jr-media-token").attr("name",i.token),this.addElement(i.media_id,a),i.embed)e(".media-linked-videos").show().prepend(a);else{var l=this.jrUploader._getItemByFileId(i.id);("video"==i.media_type||"audio"==i.media_type)&&a.find(".jr-encoding-progress, .jr-encoding-info").show(),l?e(l).html(a):e(".media-file-list-url").append(a).show()}},i.updateThumb=function(i){if(i.thumb_url!==t&&""!==i.thumb_url){var a=this.getElement(i.media_id),d=e("<img />").attr("src",i.thumb_url).css({width:"75px",height:"auto"});a.find("div.jr-media-thumb").html(d)}},i.checkEncodingJobStatus=function(t){if(null!==t.encoding_job){var a=this,d=t.encoding_job.id,r=t.media_id,o=jreviews.dispatch({method:"get",type:"json",controller:"media_upload",action:"checkJobStatus",data:{job_id:d,media_id:r}});o.done(function(d){var o=a.getElement(r);"processing"==d.state?setTimeout(function(){a.checkEncodingJobStatus(t)},i._options.polling_period):"failed"==d.state?o.find(".jr-media-encoding-failed").css("display","inline-block"):"cancelled"==d.state?o.find(".jr-media-encoding-cancelled").css("display","inline-block"):(e(".jr-encoding-progress, .jr-encoding-info").remove(),a.updateThumb(d))})}},i.embed=function(){var i=this,t=jreviews.admin?"admin/admin_media_upload":"media_upload",a=jreviews.dispatch({controller:t,action:"_embedVideo",form_id:"jr-form-media-embed",type:"json"});return e(".jr-media-message").html(""),a.done(function(t){return t.success?(e("input#jr-embed-url").val(""),i.addMediaDiv(t,t.service),i.updateThumb(t),e(".jr-embed-complete-actions").slideDown()):e(".jr-media-message").html(jreviews.__t(t.str)).show(),t}),a},i.uploadFromUrl=function(){var i=this,a=jreviews.admin?"admin/admin_media_upload":"media_upload",d=jreviews.dispatch({controller:a,action:"_uploadUrl",form_id:"jr-form-media-upload-url",type:"json"});return e(".jr-media-message").html(""),d.done(function(a){return e("input#jr-upload-url").val(""),a.success===!0?(i.addMediaDiv(a,a.filename),"finished"==a.state&&""!==a.thumb_url&&i.updateThumb(a),a.success&&a.encoding_job!==t&&i.checkEncodingJobStatus(a),e(".jr-upload-url-complete-actions").slideDown()):e(".jr-media-message").html(jreviews.__t(a.str)).show(),a}),d},i.initActions=function(i){var a=e("."+i),d=a.find(".jr-media-actions"),r=d.data("listing-id"),o=d.data("review-id"),n=d.data("media-id"),s=d.data("media-extension");d.data("media-id",n).data("listing-id",r).data("review-id",o).data("extension",s);var l=d.find(".jr-media-like-dislike button"),c=d.find(".jr-media-like"),p=d.find(".jr-media-dislike");if(a.hasClass("jr-video-gallery"))sliderItem=a.find("#jr-video-slider").find('[data-media-id="'+n+'"]'),sliderItem.length>0&&(t===sliderItem.attr("data-voted")?l.prop("disabled",!1):l.prop("disabled",!0));else if(a.hasClass("jr-photo-gallery"))if(t===a.data("voted-"+n))l.prop("disabled",!1);else{var m=a.data("media"+n)||{};m.likes&&c.find(".jr-count").html(m.likes),m.dislikes&&p.find(".jr-count").html(m.dislikes),l.prop("disabled",!0)}a.off("click",".jr-media-like-dislike button").on("click",".jr-media-like-dislike button",function(){var i=e(this),t=i.data("like-action"),d=i.find(".jr-count"),r={};r[jreviews.qvars.mc]=n;var o=jreviews.dispatch({controller:"media",action:t,type:"json",data:r});o.done(function(e){if(c.off("click"),p.off("click"),voteCount=parseInt(d.html(),10)+1,e.success&&d.html(voteCount),a.hasClass("jr-video-gallery")&&sliderItem.length>0)sliderItem.attr("data-"+("_like"==t?"likes":"dislikes"),voteCount),sliderItem.attr("data-voted",1);else if(a.hasClass("jr-photo-gallery")){if(e.success){var i=a.data("media"+n)||{};"_like"==t?(i.likes=voteCount,i.dislikes=parseInt(p.find(".jr-count").html(),10)):(i.likes=parseInt(c.find(".jr-count").html(),10),i.dislikes=voteCount),a.data("media"+n,i)}a.data("voted-"+n,1)}l.prop("disabled",!0)})})},i.videoGallery={init:function(){var t=e("div.jr-video-gallery"),a=t.find("#jr-video-slider");if(t.length&&a.length){var d=t.closest(".jr-tabs");d.length?d.bind("tabsshow",function(e,a){a.panel.id==t.closest(".ui-tabs-panel").attr("id")&&i.videoGallery.slider(t)}):i.videoGallery.slider(t)}else if(t.length){i.initActions("jr-video-gallery");var r=t.find(".video-embed-box");if(r.length)t.fitVids();else{var o=t.find("#jr-video-player");videojs("jr-video-player",{},function(){function e(){var e=document.getElementById(i.b.id).parentElement.offsetWidth;i.width(e).height(e*d)}var i=this,t=o.data("width"),a=o.data("height"),d=a/t;window.onresize=e}),window.onresize()}}},slider:function(a){var d=a.find("#jr-video-slider"),r=d.find(".jr-slider-item"),o=r.length,n=d.data("media-id"),s=a.width(),l=function(){if(s=a.width(),d.addClass("jrSliderSideArrows"),2>o&&d.hide(),maxNumVideos=Math.floor(s/130),o>maxNumVideos){var e=d.not(".jr-ready").addClass("jr-ready").find(".jrVideoList").bxSlider({infiniteLoop:!1,pager:!1,controls:!0,minSlides:2,maxSlides:10,moveSlides:1,slideMargin:0,slideWidth:122}),i=d.closest(".jr-tabs");i.length&&i.bind("tabsshow",function(i,t){t.panel.id==d.closest(".ui-tabs-panel").attr("id")&&e.reloadSlider()})}};l(),e(window).resize(function(){l(),"undefined"!=typeof sliderWrapper&&sliderWrapper.reloadSlider()}),i.initActions("jr-video-gallery"),d.on("click","a.mediaVideo",function(d){d.preventDefault();var r,o=e(this).closest("div.jr-slider-item").clone(),n=e(this).data("path"),s=e(".jr-video-embed-player"),l=e(".video-js-box"),c=o.find("a"),p=o.find("a"),m=e(".jr-media-actions"),h=p.data("media-id"),u=a.find("div#jr-video-current-info");if(m.data({"listing-id":p.data("listing-id"),"review-id":p.data("review-id"),"media-id":h,"media-extension":p.data("media-extension"),likes:p.data("likes"),dislikes:p.data("dislikes")}),i.initActions("jr-video-gallery"),e(this).data("views")===t){var f={};f[jreviews.qvars.mc]=h,jreviews.dispatch({controller:"media",action:"_increaseView",data:f}),e(this).data("views",!0)}if(o.find(".jr-media-info").removeClass("jrHidden"),u.html(o.html()).on("click","a",function(e){e.preventDefault()}),a.find(".jr-media-actions .jr-media-like .jr-count").html(p.data("likes")),a.find(".jr-media-actions .jr-media-dislike .jr-count").html(p.data("dislikes")),a.find(".jr-media-info .jr-media-created").html(p.data("created")),a.find(".jr-media-info .jr-media-duration").html(p.data("duration")),a.find(".jr-media-info .jr-media-views-count").html(p.data("views")),""!==c.data("embed"))r=0===s.find("iframe").length?e("<iframe></iframe>"):s.find("iframe"),e.each(c.data("embedAttr"),function(e,i){r.attr(e,i)}),0===s.find("iframe").length&&r.appendTo(s),l.hide(),s.show();else{var v=a.find("#jr-video-player"),j=[{type:"video/mp4",src:n+".mp4"},{type:"video/webm",src:n+".webm"}];if(s.hide().html(""),l.show(),"jr-video-player"in videojs.players){var g=videojs.players["jr-video-player"];g.pause().src(j).load(),a.find(".vjs-poster").css({"background-image":"url("+n+".jpg)",display:"block"}),a.find(".vjs-big-play-button").show()}else videojs("jr-video-player",{poster:n+".jpg"},function(){function e(){var e=document.getElementById(i.b.id).parentElement.offsetWidth;i.width(e).height(e*d)}var i=this,t=v.data("width"),a=v.data("height"),d=a/t;i.src(j),window.onresize=e});window.onresize()}a.fitVids()}),n?d.find('[data-media-id="'+n+'"]').trigger("click"):d.first().trigger("click")}},i.reorder=function(e,i){var t=i.item.closest(".ui-sortable");listing_id=t.data("listing-id"),extension=t.data("extension"),media_type=t.data("media-type"),tokens=t.data("token-s"),tokeni=t.data("token-i"),ordering=t.sortable("toArray");var a={"data[listing_id]":listing_id,"data[extension]":extension,"data[ordering]":ordering,"data[media_type]":media_type};a[tokens]=1,a[tokeni]=1;var d=jreviews.dispatch({method:"get",controller:"media",action:"reorder",data:a});d.done(function(e){e.success||jreviews.dialog.alert(jreviews.__t("PROCESS_REQUEST_ERROR"))})},i.photoFunction=function(i){i.on("click",".jr-photo-function button",function(t){t.preventDefault();var a=e(this),d=a.closest(".jr-photo-function"),r=a.data("function"),o={id:d.data("mediaId"),"function":r};o[d.data("token")]=1;var n=jreviews.dispatch({method:"get",type:"json",controller:"media",action:"_setPhotoFunction",data:o});n.done(function(t){if(t.success){var o=d.data("stateClass");d.find("button").removeClass(o.gallery+" "+o.logo+" "+o.cover),a.addClass(o[r]),("cover"==r||"logo"==r)&&i.find(".jr-photo-function").not(d).each(function(){var i=e(this);i.find("button").each(function(){var t=e(this);t.data("function")==r&&t.hasClass(o[r])&&(t.removeClass(o[r]),i.find('button[data-function="gallery"]').addClass(o.gallery))})})}})})},i.photoGallery={init:function(){var t=e("div.jr-photo-gallery");if(0===t.length)return!1;var a=t.closest(".jr-tabs");a.length?(firstTabID=a.find("li a").eq(0).attr("href").split("#")[1],currTabIndex=a.find(".ui-tabs-panel").index(t.closest(".ui-tabs-panel")),firstTabID&&t.parents("#"+firstTabID).length?i.photoGallery.render(t):a.bind("tabsshow",function(e,a){a.panel.id==t.closest(".ui-tabs-panel").attr("id")&&setTimeout(function(){i.photoGallery.render(t)},100)})):i.photoGallery.render(t)},render:function(a){var d,r=a.closest(".jr-listing-detail"),o=a.find("#jr-photo-slideshow"),n=o.data("media-id"),s=o.data("height"),l=[];e("#jr-photo-slideshow li").each(function(i,t){var a={};a[jreviews.qvars.mc]=e(t).data(jreviews.qvars.mc),a.views=e(t).data("views"),l.push(a)}),n!==t&&e.each(l,function(e,i){return i[jreviews.qvars.mc]==n?(d=e,!1):void 0}),o.galleria({debug:!0,responsive:!0,height:s,initialTransition:o.data("initialTransition"),transition:o.data("transition"),lightbox:o.parent().hasClass("jrPhotoGalleryCompact"),layerFollow:!1,imagePosition:o.data("imagePosition"),show:d,dataConfig:function(i){return{title:e(i).attr("title"),layer:e(i).closest("a").next(".jrPhotoLayer").html()}},extend:function(){var a=this;if(1==a.getDataLength()){a.$("image-nav").hide();var d=a.$("thumbnails-container"),n=d.height(),s=a.$("container"),c=s.height()-n;a.$("thumbnails-container").hide(),e("#jr-photo-slideshow").height(c)}window.history.replaceState&&a.bind("loadstart",function(){var d=a.getIndex();e.each(l,function(a,o){if(d==a){if(!r.length){var n={};n[jreviews.qvars.mc]=o[jreviews.qvars.mc];var s=i.makeNewQueryString(n),l=window.location.pathname.replace(new RegExp("/"+jreviews.qvars.mc+":[a-z0-9]+/","i"),"/");window.history.replaceState(n,"",l+s)}if(e(this).data("views")===t){var c={};c[jreviews.qvars.mc]=o[jreviews.qvars.mc],jreviews.dispatch({controller:"media",action:"_increaseView",data:c}),e(this).data("views",!0)}}})}),o.not("jrPhotoOverlay")&&a.bind("image",function(i){e("#jr-gallery-description").html(i.galleriaData.layer)}),a.bind("image",function(){i.initActions("jr-photo-gallery")})}}),o.hasClass("jrPhotoOverlay")&&o.hover(function(){o.find(".jr-photo-info, .jr-photo-caption").hide().slideDown(200)},function(){o.find(".jr-photo-info, .jr-photo-caption").show().slideUp(200)})}},i.audioPlayer=function(){var i=e("div.jr-audio-player");i.each(function(){var i=e(this),t=i.siblings(".jr-audio-tracks"),a=i.data("tracks"),d=i.data("swpath");new jPlayerPlaylist({jPlayer:"#"+i.attr("id"),cssSelectorAncestor:"#"+t.attr("id")},a,{swfPath:d,supplied:"oga, m4a, mp3",playlistOptions:{freeItemClass:"jrButton jrSmall",downloadText:'<span class="jrIconArrowDown"></span>'+jreviews.__t("DOWNLOAD")}})});var t=jQuery(".jp-playlist");t.each(function(){var e=jQuery(this),i=e.closest(".jr-audio-tracks").siblings(".jr-audio-player"),t=i.data("tracks");jQuery(t).each(function(i){var t=e.find("li").eq(i).find("div"),a='<span style="float:right"><a href="" class="jrButton jrSmall"><span class="jrIconArrowDown"></span>Download</a></span>';t.append(a)})})},i.getUrlParams=function(){var e=window.location.search;e=e.replace("?","");for(var i=e.split("&"),a={},d=0;d<i.length;d++){var r=i[d].split("=");r[1]!==t&&(a[r[0]]=r[1])}return a},i.makeNewQueryString=function(t){var a=i.getUrlParams(),d=[];return e.each(t,function(e,i){a[e]=i}),e.each(a,function(e,i){d.push(e+"="+i)}),"?"+d.join("&")}}(jQuery,jreviewsMedia),function(e){e.fn.fitVids=function(i){var t={customSelector:null},a=document.createElement("div"),d=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0];return a.className="fit-vids-style",a.innerHTML="&shy;<style>            .fluid-width-video-wrapper {           width: 100%;                        position: relative;                 padding: 0;                         }                                                  .fluid-width-video-wrapper iframe,     .fluid-width-video-wrapper object,     .fluid-width-video-wrapper embed {     position: absolute;                 top: 0;                             left: 0;                            width: 100%;                        height: 100%;                       }                                    </style>",d.parentNode.insertBefore(a,d),i&&e.extend(t,i),this.each(function(){var i=["iframe[src*='player.vimeo.com']","iframe[src*='www.youtube.com']","iframe[src*='www.youtube-nocookie.com']","iframe[src*='www.dailymotion.com']","object","embed"];t.customSelector&&i.push(t.customSelector);var a=e(this).find(i.join(","));a.each(function(){var i=e(this);if(!("embed"===this.tagName.toLowerCase()&&i.parent("object").length||i.parent(".fluid-width-video-wrapper").length)){var t="object"===this.tagName.toLowerCase()||i.attr("height")&&!isNaN(parseInt(i.attr("height"),10))?parseInt(i.attr("height"),10):i.height(),a=isNaN(parseInt(i.attr("width"),10))?i.width():parseInt(i.attr("width"),10),d=t/a;if(!i.attr("id")){var r="fitvid"+Math.floor(999999*Math.random());i.attr("id",r)}i.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*d+"%"),i.removeAttr("height").removeAttr("width")}})})}}(jQuery);;